/*
 RequireJS text 0.27.0 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/

/*!
 * Autolinker.js
 * 0.12.2
 *
 * Copyright(c) 2014 Gregory Jacobs <greg@greg-jacobs.com>
 * MIT Licensed. http://www.opensource.org/licenses/mit-license.php
 *
 * https://github.com/gregjacobs/Autolinker.js
 */

(function(){define("lodash",[],function(){return window._}),define("bs/util/pubsub",["lodash"],function(e){var t=function(){this.channelHandlers={}};return t.prototype={channels:{scores_update:"story_scores:update",scores_update_error:"story_scores:error",user_auth:"user_auth:success",scrolltop:"scrolltop",popular_stories_rendered:"popular_stories_rendered",new_stories_rendered:"new_stories_rendered"},on:function(e,t,n,r){var i=this.channelHandlers[t];return i||(i=this.channelHandlers[t]=[]),n&&typeof n=="function"&&(n._scope=r||null,i.push(n)),this},one:function(t,n,r){var i=this,s=function(){var o=e.toArray(arguments);r.apply(this,o),i.off(t,n,s)};return this.on(t,n,s),this},off:function(t,n,r){var i=this.channelHandlers[n];return i&&(this.channelHandlers[n]=e.reject(i,function(e){return e===r})),this},fire:function(t){var n=this.channelHandlers[t],r=e.toArray(arguments).slice(1);return n&&e.each(n,function(e){e.apply(e._scope,r)},this),this}},new t}),define("bs/util/cookies",[],function(){var e={set:function(e){var t=[];typeof e=="object"&&(typeof e.name=="string"&&e.name.length>0&&(typeof e.value=="string"||typeof e.value=="number"||typeof e.value=="boolean")&&t.push($.trim(e.name)+"="+encodeURIComponent(e.value)),e.expires instanceof Date&&t.push("expires="+e.expires.toGMTString()),typeof e.path=="string"&&t.push("path="+e.path),typeof e.domain=="string"&&t.push("domain="+e.domain),typeof e.secure=="boolean"&&e.secure&&t.push("secure"),document.cookie=t.join(";"))},get:function(t){var n=e.getAll();return typeof n[t]!="undefined"?n[t]:null},getAll:function(){var e={},t=document.cookie;if(t){var n=null,r=null,i=null,s=t.split(";"),o=s.length-1;if(o>=0)do i=s[o].split("="),n=$.trim(i[0]),r=i[1],n!=="expires"&&typeof r!="undefined"&&(e[n]=decodeURIComponent(r));while(o--)}return e},remove:function(t){var n={};typeof t=="string"?n.name=t:typeof t=="object"&&$.extend(n,t),n.value="",n.expires=new Date(0),e.set(n)},expires:{oneYear:function(){var e=31536e6;return new Date((new Date).valueOf()+e)}}};return e}),define("bs/util/validation",[],function(){return{isURL:function(e){return/^https?:\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e)},isEmail:function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\ ".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA -Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}}}),define("jquery",[],function(){return jQuery}),define("bs/util/xhr",["bs/util/cookies","jquery","lodash"],function(e,t,n){var r={dataType:"digg",converters:{"text digg":function(e){var n=t.parseJSON(e);if(n.status!=="ok")throw new Error("Bad Digg API Response: "+n.mesg);return n}},traditional:!0};return{config:n.clone(r),dataProvider:function(){var i=function(e){this.config=n.extend(n.clone(r),e)};return i.prototype={isPolling:function(){return!!this.pollingRef},request:function(r){var i=n.extend(n.clone(this.config),r);return i.type==="POST"&&(i.data=i.data||{},i.data._xsrf=e.get("_xsrf")),t.ajax(i)},startPolling:function(e,n){var r=n.delayStart||!1;t.proxy(function(){r?r=!1:this.request(n),this.pollingRef=setTimeout(t.proxy(arguments.callee,this),e)},this)()},stopPolling:function(){this.pollingRef&&(clearTimeout(this.pollingRef),this.pollingRef=null)}},i}()}}),define("bs/util/helpers",[],function(){var e=["You've got a lot of work to do, slacker.","C'mon!",'Just "Mark as Read". You know you want to.'];return{transitionEndEventNames:{WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",msTransition:"MSTransitionEnd",transition:"transitionend"},popWin:function(e,t,n){return n.width&&n.height&&(n.left=window.screen.width/2-n.width/2,n.top=window.screen.height/2-n.height/2),n=$.param(n).replace(/&/g,","),window.open(e,t,n)},createGlobalCallback:function(e){var t="cb"+(new Date).valueOf();return window[t]=function(){e.apply(this,arguments);try{delete window[t]}catch(n){window[t]=null}},t},listen:function(e,t,n){if(t.addEventListener)t.addEventListener(e,n,!1);else if(t.attachEvent){var r=t.attachEvent("on"+e,n);return r}},unlisten:function(e,t,n){if(t.addEventListener)t.removeEventListener(e,n,!1);else if(t.detachEvent){var r=t.detachEvent("on"+e,n);return r}},throttle:function(t,n){var r=null;return function(){var e=this,i=arguments;clearTimeout(r),r=setTimeout(function(){t.apply(e,i)},n)}},deparam:function(e){var t,n={};return e[0]==="?"&&(e=e.substring(1)),t=e.split("&"),$.each(t,function(e,t){var r=t.split("=");n[r[0]]=decodeURIComponent(r[1])}),n},param:function(e){return $.param(e,!0)},makeExpandingArea:function(e){var t=e.querySelector("textarea"),n=e.querySelector("span");t.addEventListener?(t.addEventListener("input",function(){n.textContent=t.value},!1),n.textContent=t.value):t.attachEvent&&(t.attachEvent("onpropertychange",function(){n.innerText=t.value}),n.innerText=t.value),e.className+=" active"},enforceRangeLimits:function(e,t,n){return e<t?t:e>n?n:e},getMaxUnreadMessage:function(){var t=Math.floor(Math.random()*e.length);return e[t]},isElementInViewport:function(e){var t=e[0].getBoundingClientRect(),n=e.parents(".scrollable"),r;r=n[0]&&n[0].getBoundingClientRect();if(!r)return;return t.bottom>=r.bottom?"bottom":t.top<=r.top?"top":!0},chunkString:function(e,t){var n=[],r=0,i=t;if(e.length%t!==0)throw new Error("chunkString(): cannot chunk str argument based on chunkLen");while(i<e.length)n.push(e.substr(r,t)),r+=t,i+=t;return n},getTweetStoryLink:function(e){var t;e=e||{};if(!e.content_id&&!e.url)throw new Error("Missing content_id and url arguments. One is required.");if(!e.title)throw new Error("Missing title argument");return t=e.content_id?"http://on.digg.com/"+e.content_id:e.url,["https://twitter.com/intent/tweet?url=",encodeURIComponent(t),"&via=Digg&text=",encodeURIComponent(e.title)].join("")},getFacebookStoryShareLink:function(e){var t;e=e||{};if(!e.app_id)throw new Error("Missing Facebook App ID argument");if(!e.content_id&&!e.url)throw new Error("Missing content_id and url arguments. One is required.");return t=e.content_id?"http://on.digg.com/"+e.content_id:e.url,["https://www.facebook.com/dialog/feed?display=popup&app_id=",e.app_id,"&link=",encodeURIComponent(t),"&redirect_uri=http://digg.com/fbshare"].join("")},getTweetURL:function(e){e=e||{};if(!e.twitter_screen_name)throw new Error("Missing Twitter screen name argument");if(!e.tweet_id)throw new Error("Missing tweet_id argument");return["http://www.twitter.com/",e.twitter_screen_name,"/status/",e.tweet_id].join("")}}}),define("bs/util/i18n",[],function(){var e={Jan:"Jan",Feb:"Feb",Mar:"Mar",Apr:"Apr",May:"May",Jun:"Jun",Jul:"Jul",Aug:"Aug",Sep:"Sep",Oct:"Oct",Nov:"Nov",Dec:"Dec"};return{__:function(t,n){return e[t]?e[t]:t}}}),define("bs/util/format",["bs/util/i18n"],function(e){function t(e,t){return t||(t=1),e?e:t}function n(t){var n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return e.__(n[t])}function r(e){var t=e.getHours(),n=e.getMinutes(),r=t>=12?"pm":"am";t%=12,t=t?t:12,n=n<10?"0"+n:n;var i=t+":"+n+" "+r;return i}return{secondsToFuzzyTime:function(e,r){var i=6e4,s=60*i,o=24*s,u=7*o,a=o*3652425/1e4,f=new Date(e*1e3),l=new Date,c=l-f,h,p=r?"":" ago";return c<i?h="just now":c/i<=45?h=t(Math.floor(c/i),1)+"m"+p:c/s<=16?h=t(Math.floor(c/s),1)+"h"+p:c/o<=6?h=t(Math.floor(c/o),1)+"d"+p:c/u<=6?h=t(Math.floor(c/u),1)+"w"+p:c/a<=1?h=[f.getDate(),n(f.getMonth())].join(" "):h=[f.getDate(),n(f.getMonth()),f.getFullYear()].join(" "),h},secondsToDiggReaderTime:function(e){var t,i=new Date(e*1e3),s=i.getDate(),o=i.getMonth(),u=i.getFullYear(),a=new Date,f=a.getDate(),l=(new Date(new Date(a.getFullYear(),a.getMonth(),a.getDate()-1))).getDate(),c=a.getMonth(),h=a.getFullYear();return s===f&&o===c&&u===h?t=r(i):s===l&&o===c&&u===h?t="Yesterday":u===h?t=n(o)+" "+s:t=n(o)+" "+s+" "+u,t},intWithCommas:function(e,t){var n=(e+"").split("").reverse(),r=[],i,s,o=0,u;for(i=1,s=n.length;i<=s;i++)i%3===0?(r.push(n[i-1]),i!==s&&(r.push(","),o++)):r.push(n[i-1]);return t&&s>4?(u=r.reverse().join("").split(",")[0],o===1?u+="k":o===2&&(u+="m")):u=r.reverse().join(""),u},truncate:function(e,t,n,r){if(!e||e.length<=t)return e;typeof r=="undefined"&&(r="…");var i;if(n){i=e.substr(0,t-3).lastIndexOf(" ");var s=e.substr(i-1,1);while([",",";",":","(","-","–","—"," "].indexOf(s)!==-1){i--;if(i===-1)break;s=e.substr(i-1,1)}}if(!n||i===-1)i=t-3;return e.substr(0,i)+r},slugify:function(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}}}),define("bs/widgets/dailydiggsub",["bs/core","bs/util/xhr","jquery"],function(e,t,n){function u(e){var o=n(e.target).find(".form-dailydigg-input"),u=n.trim(o.val()),l=require("bs/core").user.isLoggedIn()?"/api/settings/email.json":"/api/dailydiggemail.json",c=new t.dataProvider({url:l,type:"POST",data:{email:u},success:a,error:f},e),h;return i=e,r=n(e.target),s||(h=document.createElement("div"),h.className="response",r.append(h),s=!0),c.request(),e.stopPropagation(),e.preventDefault(),!1}function a(e){r.removeClass("error").addClass("success").find(".response").html("Thanks for subscribing!"),require("bs/core").pubsub.fire("dailydigg_subscribe_success",i)}function f(e){r.addClass("error").find(".response").html("There was a problem submitting your email. Please try again.")}var r,i,s=!1,o=!1;return{init:function(){if(o)return;o=!0,n(document).on("submit",".form-dailydigg-sub",u)}}}),function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],t=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,n=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,r=typeof location!="undefined"&&location.href,i=r&&location.protocol&&location.protocol.replace(/\:/,""),s=r&&location.hostname,o=r&&(location.port||void 0),u=[];define("text",[],function(){var a,f,l;return typeof window!="undefined"&&window.navigator&&window.document?f=function(e,t){var n=a.createXhr();n.open("GET",e,!0),n.onreadystatechange=function(){n.readyState===4&&t(n.responseText)},n.send(null)}:typeof process!="undefined"&&process.versions&&process.versions.node?(l=require.nodeRequire("fs"),f=function(e,t){t(l.readFileSync(e,"utf8"))}):typeof Packages!="undefined"&&(f=function(e,t){var n=new java.io.File(e),r=java.lang.System.getProperty("line.separator"),n=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(n),"utf-8")),i,s,o="";try{i=new java.lang.StringBuffer,(s=n.readLine())&&s.length()&&s.charAt(0)===65279&&(s=s.substring(1));for(i.append(s);(s=n.readLine())!==null;)i.append(r),i.append(s);o=String(i.toString())}finally{n.close()}t(o)}),a={version:"0.27.0",strip:function(e){if(e){var e=e.replace(t,""),r=e.match(n);r&&(e=r[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var t,n,r;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;for(n=0;n<3;n++){r=e[n];try{t=new ActiveXObject(r)}catch(i){}if(t){e=[r];break}}if(!t)throw Error("createXhr(): XMLHttpRequest not available");return t},get:f,parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),e=e.substring(n+1,e.length),n=e.indexOf("!");return n!==-1&&(t=e.substring(n+1,e.length),t=t==="strip",e=e.substring(0,n)),{moduleName:r,ext:e,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,n,r){var i=a.xdRegExp.exec(e),s;return i?(e=i[2],i=i[3],i=i.split(":"),s=i[1],i=i[0],(!e||e===t)&&(!i||i===n)&&(!s&&!i||s===r)):!0},finishLoad:function(e,t,n,r,i){n=t?a.strip(n):n,i.isBuild&&i.inlineText&&(u[e]=n),r(n)},load:function(e,t,n,u){var f=a.parseName(e),l=f.moduleName+"."+f.ext,c=t.toUrl(l),h=u&&u.text&&u.text.useXhr||a.useXhr;!r||h(c,i,s,o)?a.get(c,function(t){a.finishLoad(e,f.strip,t,n,u)}):t([l],function(e){a.finishLoad(f.moduleName+"."+f.ext,f.strip,e,n,u)})},write:function(e,t,n){if(t in u){var r=a.jsEscape(u[t]);n.asModule(e+"!"+t,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,t,n,r,i){var t=a.parseName(t),s=t.moduleName+"."+t.ext,o=n.toUrl(t.moduleName+"."+t.ext)+".js";a.load(s,n,function(){var t=function(e){return r(o,e)};t.asModule=function(e,t){return r.asModule(e,o,t)},a.write(e,s,t,i)},i)}}})}(),define("text!bs/templates/popover.html",[],function(){return'<div class="popover" role="dialog" aria-hidden="true">\n    <div class="arrow"></div>\n    <div class="btn-close">&#x2716;</div>\n    <div class="popover-content"><%= popoverContent %></div>\n</div>'}),define("text!bs/templates/onboard_firstdigg.html",[],function(){return'<div id="first-digg" class="first-digg">\n<% if (facebook && facebook.username && fb_enable_og) { %>\n    <div class="facebook">\n        <h5 class="hed">Success!</h5>\n        <p>Your diggs will appear in your Facebook timeline.<br/>\n           <a href="/settings">Go to Settings</a> to change this preference.</p>\n    </div>\n<% } else { %>\n    <div class="twitter">\n        <h5 class="hed">You dugg this story!</h5>\n        <p>Thanks for that.</p>\n    </div>\n<% } %>\n</div>\n'}),define("text!bs/templates/onboard_firstsave.html",[],function(){return'<h5 class="hed">Saved!</h5>\n<p>Saved stories are also synced to your<br/>iPhone, iPad, and/or Android device.</p>\n'}),define("text!bs/templates/modal_dailydigg.html",[],function(){return'<div id="modal-dailydiggsub" class="modal-dailydiggsub modal fade hide" role="dialog" aria-hidden="true">\n    <header class="modal-header">\n        <span class="modal-header-text">Subscribe to <b>The Daily Digg</b></span>\n        <div id="btn-savedstories-modal-close" class="btn-modal-close">✖</div>\n    </header>\n    <section class="modal-body">\n    \n        <p class="pitch">Welcome to Digg! Every day we send an email with a handful of our <b>top stories</b> and <b>videos</b> and none of the clutter, noise, or cats that usually distract you.</p>\n    <% if (campaignVersion < 4) { %>\n        <div class="kudos">\n        <% if (campaignVersion == 0) { %>\n            <blockquote class="tweet" cite="https://twitter.com/stevekovach/status/408209270900260864"><p>The @digg newsletter is the best email newsletter I get. It\'s also the only one.</p><footer><b>Steve Kovach</b>&nbsp;<a href="https://twitter.com/stevekovach/status/408209270900260864" target="_blank">@stevekovach&nbsp;&nbsp;Dec 4, 2013, 7:20am</a></footer></blockquote>\n        \n        <% } else if (campaignVersion == 1) { %>\n            <blockquote class="tweet" cite="https://twitter.com/mccarthyryanj/status/345188184633769984"><p>You should really sign up for the @digg email newsletter. It\'s great.</p><footer><b>Ryan McCarthy</b>&nbsp;<a href="https://twitter.com/mccarthyryanj/status/345188184633769984" target="_blank">@mccarthyryanj&nbsp;&nbsp;June 13, 2013, 7:37am</a></footer></blockquote>\n        \n        <% } else if (campaignVersion == 2) { %>\n            <blockquote class="tweet" cite="https://twitter.com/travors/status/393001208841252864"><p>The @digg newsletter is really good, in fact it\'s the only newsletter that always engages me.</p><footer><b>Dan Walsh</b>&nbsp;<a href="https://twitter.com/travors/status/393001208841252864" target="_blank">@travors&nbsp;&nbsp;Oct 13, 2013, 6:09am</a></footer></blockquote>\n            \n        <% } else if (campaignVersion == 3) { %>\n            <blockquote class="tweet" cite="https://twitter.com/BrianMueller333/status/350593250521919488"><p>Never thought I\'d look forward to receiving a daily newsletter from Digg, but here we are.</p><footer><b>Brian Mueller</b>&nbsp;<a href="https://twitter.com/BrianMueller333/status/350593250521919488" target="_blank">@BrianMueller333&nbsp;&nbsp;June 28, 2013, 5:35am</a></footer></blockquote>\n        \n        <% } %>\n        </div>\n    <% } %>\n        <form class="form-dailydigg-sub">\n            <label class="form-dailydigg-lbl">\n                <span class="lbl">Enter your email address</span>\n                <input class="form-dailydigg-input" type="email" placeholder="Enter your email address" value="<%= inputValue %>" required />\n            </label>\n            <button class="form-dailydigg-submit" type="submit">Subscribe</button>\n            <p class="calltoaction"><% if (email) { %>Hit the subscribe button<% } else { %>Enter your email, hit subscribe <% } %> and pat yourself on the back for making a great decision.</p>\n        </form>\n    </section>'}),define("bootstrap_modal",[],function(){}),define("bs/widgets/onboarding",["require","bs/core","bs/util/cookies","bs/util/xhr","bs/util/format","bs/util/helpers","bs/widgets/dailydiggsub","text!bs/templates/popover.html","text!bs/templates/onboard_firstdigg.html","text!bs/templates/onboard_firstsave.html","text!bs/templates/modal_dailydigg.html","bootstrap_modal","lodash"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){function E(e,t){return Math.floor(Math.random()*(t-e+1))+e}function S(e){var t=$(e.target).closest(".modal"),n=$(e.target).hasClass("btn-modal-close"),r=$(e.target).hasClass("form-dailydigg-cancel"),i=$(e.target).is(".form-dailydigg-sub.success");if(t.length===0||n||r||i)i?setTimeout(function(){g.modal("hide").remove()},1500):g.modal("hide").remove(),C.optOut(),$(document).off("click touchend",S),window.location.hash="_"}function x(t){var n=typeof t!="undefined"?$(t.target).closest(".popover"):$("body").closest(".popover"),r=typeof t!="undefined"?$(t.target).hasClass("btn-close"):!1,i=typeof t!="undefined"?$(t.target).hasClass("modal"):!1,s=typeof t!="undefined"?$(t.target).hasClass("modal-backdrop"):!1;if(i||s)return;if(n.length===0||r)$(y).removeClass("show-story-actions"),$(".popover:not(.nav-user .popover)").remove(),$(document).off("click touchend",x),e("bs/core").pubsub.off("story_actions","sitenav_auth_displayed",x),e("bs/core").pubsub.off("story_actions","savedstories_modal_displayed",x)}function T(t){S(t),e("bs/core").pubsub.fire("dailydigg_tweet_campaign_success",w[b]),e("bs/core").pubsub.off("modal_dailydigg","dailydigg_subscribe_success",T)}function N(){window.location.hash="_",g.off("hidden.bs.modal")}var p=h.template(u),d=h.template(a),v=h.template(f),m=h.template(l),g,y=".story-container",b,w=["@stevekovach","@mccarthyryanj","@travors","@BrianMueller333","noTweet"],C={dailyDiggModal:function(t){var n=e("bs/core").user.isLoggedIn()?e("bs/core").user.get("email"):!1,r={email:n?n:!1,inputValue:n?n:"",campaignVersion:E(0,5)},i=m(r);return t&&t.preventDefault&&t.preventDefault(),g=$(i).appendTo("body").modal({keyboard:!0,show:!0}),g.on("hidden.bs.modal",N),b=r.campaignVersion,o.init(),setTimeout(function(){$(".form-dailydigg-input").focus()},10),$(document).on("click touchend",S),g.on("click",".btn-modal-close",S),e("bs/core").pubsub.fire("dailydigg_tweet_campaign_view",w[b]),e("bs/core").pubsub.on("modal_dailydigg","dailydigg_subscribe_success",T),!1},dailyDiggModalHash:function(t){var n=C.dailyDiggModal,r;window.location.hash==="#dailydigg"&&(r=e("bs/core"),r.user.isLoggedIn()?C.dailyDiggModal(t):(r.pubsub.one("daily_digg_modal",r.pubsub.channels.user_auth,n),$(function(){C.dailyDiggModal(t)})))},firstDigg:function(t){var n=e("bs/core").user.getUser(),r=$("<div></div>"),i=p({popoverContent:d(n)});x(),r.replaceWith(i).appendTo(t.parents(".story-action")).fadeIn(160).parents(y).addClass("show-story-actions"),$(document).on("click touchend",x),e("bs/core").pubsub.on("story_actions","sitenav_auth_displayed",x),e("bs/core").pubsub.on("story_actions","savedstories_modal_displayed",x)},firstSave:function(t){var n=$("<div></div>"),r=p({popoverContent:v()});x(),n.replaceWith(r).appendTo("#nav-saved").fadeIn(160),t.parents(y).addClass("show-story-actions"),$(document).on("click touchend",x),e("bs/core").pubsub.on("story_actions","sitenav_auth_displayed",x),e("bs/core").pubsub.on("story_actions","savedstories_modal_displayed",x),e("bs/core").pubsub.fire("onboarding_firstsave")},optOut:function(){n.set({name:"digg_onboarding_dailydiggsub",value:1,expires:n.expires.oneYear()})}};return C}),define("text!bs/templates/storyaction_auth.html",[],function(){return'<div class="arrow"></div>\n<div class="btn-close">&#x2716;</div>\n<div class="popover-content">\n    <strong>Sign in</strong>\n    <p>Please sign in to <span id="auth-story-action"><%= action %></span> a story.</p>\n    \n    <a id="btn-facebook-auth" class="btn-service-auth btn-facebook-auth" href="#fb"><div class="auth-ico"></div>Sign in</a>\n    <a id="btn-twitter-auth" class="btn-service-auth btn-twitter-auth" href="#twitter"><div class="auth-ico"></div>Sign in</a>\n    <a id="btn-google-auth" class="btn-service-auth btn-google-auth" href="#google"><div class="auth-ico"></div>Sign in</a>\n</div>'}),define("bs/util/user",["require","bs/core","bs/util/cookies","bs/util/validation","bs/util/xhr","bs/util/helpers","bs/widgets/onboarding","text!bs/templates/storyaction_auth.html","lodash"],function(e,t,n,r,i,s,o,u,a){function g(){p||(p=!0,FB.init({appId:e("bs/core").config.FB_APP_ID,status:!0,cookie:!0,oauth:!0,xfbml:!0,version:"v2.0"}))}function y(e,t){var n=t?{url:"/session",type:"POST",data:{action:"refresh"}}:{};c||(c=!0,v.request(n).success(function(t){c=!1,e&&typeof e=="function"&&e(f)}).error(function(e){c=!1}))}function b(e){var t=typeof e!="undefined"?$(e.target).closest(".popover"):$("body").closest(".popover"),n=typeof e!="undefined"?$(e.target).hasClass("btn-close"):!1;if(t.length===0||n)h.$loginEl.fadeOut(160),$(document).off("click",b),$(".story-container").removeClass("show-story-actions")}function w(){e("bs/core").pubsub.one("site_nav_user_widget",e("bs/core").pubsub.channels.user_auth,function(e){var t=(new Date).valueOf()/1e3-~~h.get("date_signup")<900,r=n.get("digg_onboarding_dailydiggsub"),i=document.location.hash;(i.match("test-onboarding")||t&&r!=="1"&&!h.get("email_subscriber"))&&o.dailyDiggModal()}),$(document).off("click",".btn-facebook-auth",_).off("click",".btn-twitter-auth",D).off("click",".btn-google-auth",P),E()}function E(){var e=!!n.get("frontend.user");return e&&!f&&y(),e}function S(t,n){var r=s.createGlobalCallback(function(r){t&&typeof t=="function"?t=s.createGlobalCallback(t):n!=="link"&&n!=="login"&&(t||(t=s.createGlobalCallback(w)),n==="digg_deeper"&&o.optOut()),O(r,t),e("bs/core").pubsub.fire("twitter_auth_success",n)});return s.popWin("/session/twitter?cb="+r,"twitterSignin",{width:590,height:460}),!1}function x(t,n){var r=s.createGlobalCallback(function(r){t&&typeof t=="function"?t=s.createGlobalCallback(t):n!=="link"&&n!=="login"&&(t||(t=s.createGlobalCallback(w))),T(r,t),e("bs/core").pubsub.fire("google_auth_success",n)});return s.popWin("/session/google?cb="+r,"googleSignin",{width:590,height:560}),!1}function T(e,t){e.oauth_refresh_token&&(document.getElementById("oauth_refresh_token").value=e.oauth_refresh_token),document.getElementById("oauth_access_token").value=e.oauth_access_token,document.getElementById("google_uid").value=e.google_uid,document.getElementById("google_name").value=e.google_name,document.getElementById("google_email").value=e.google_email,document.getElementById("google_expiration_date").value=e.expiration_date,t&&(document.getElementById("google_callback").value=t),document.getElementById("session_google").submit()}function N(t,n){var r=s.createGlobalCallback(function(r){t&&typeof t=="function"&&(t=s.createGlobalCallback(t)),C(r,t),e("bs/core").pubsub.fire("pocket_auth_success",n)});return s.popWin("/session/pocket?cb="+r,"pocketAuth",{width:960,height:640}),!1}function C(e,t){document.getElementById("pocket_token").value=e.pocket_token,document.getElementById("pocket_user_name").value=e.pocket_user_name,t&&(document.getElementById("pocket_callback").value=t),document.getElementById("session_pocket").submit()}function k(t,n){var r=s.createGlobalCallback(function(r){t&&typeof t=="function"&&(t=s.createGlobalCallback(t)),L(r,t),e("bs/core").pubsub.fire("readability_auth_success",n)});return s.popWin("/session/readability?cb="+r,"readabilityAuth",{width:960,height:640}),!1}function L(e,t){document.getElementById("readability_token").value=e.readability_token,document.getElementById("readability_secret").value=e.readability_secret,document.getElementById("readability_username").value=e.readability_username,t&&(document.getElementById("readability_callback").value=t),document.getElementById("session_readability").submit()}function A(e,t){document.getElementById("instapaper_token").value=e.token,document.getElementById("instapaper_secret").value=e.secret,document.getElementById("instapaper_username").value=e.username,t&&(document.getElementById("instapaper_callback").value=t),document.getElementById("session_instapaper").submit()}function O(e,t){document.getElementById("twitter_key").value=e.key,document.getElementById("twitter_secret").value=e.secret,document.getElementById("twitter_screen_name").value=e.screen_name,document.getElementById("twitter_user_id").value=e.user_id,document.getElementById("twitter_callback").value=t,document.getElementById("session_twitter").submit()}function M(e,t){var n=e.authResponse;document.getElementById("fb_access_token").value=n.accessToken,document.getElementById("fb_expires").value=n.expiresIn,t!=null&&(document.getElementById("facebook_callback").value=t),document.getElementById("session_facebook").submit()}function _(t){var n="Sign In";return t&&(t.stopPropagation(),t.preventDefault()),e("bs/core").pubsub.fire("fb_auth_click",n),g(),FB.getLoginStatus(function(t){t.authResponse?(h.loginFacebook(t,s.createGlobalCallback(w)),e("bs/core").pubsub.fire("fb_auth_success",n)):FB.login(function(t){t.authResponse&&(h.loginFacebook(t,s.createGlobalCallback(w)),e("bs/core").pubsub.fire("fb_auth_success",n))},{scope:"email,publish_actions,publish_stream"})}),!1}function D(t){var n="Sign In";return t&&(t.stopPropagation(),t.preventDefault()),e("bs/core").pubsub.fire("twitter_auth_click",n),h.initTwitterLogin(null,n),!1}function P(t){var n="Sign In";return t&&(t.stopPropagation(),t.preventDefault()),e("bs/core").pubsub.fire("google_auth_click",n),h.initGoogleLogin(null,n),!1}var f=null,l=null,c=!1,h,p=!1,d=function(t){c=!1,f=t.user,e("bs/core").pubsub.fire(e("bs/core").pubsub.channels.user_auth,f)},v=new i.dataProvider({url:"/api/user.json",cache:!1,success:d}),m=a.template(u);return h={loginEl:null,isLoggedIn:E,get:function(e){return f&&e in f?f[e]:null},deepGet:function(e){if(!f)return null;var t=f,n=!0;return a.each(e.split("."),function(e){if(!(e in t))return n=!1,!1;t=t[e]}),n?t:null},refresh:function(e){E()&&y(e)},getUser:function(t){if(t&&typeof t=="function"){E()?f?t(f):e("bs/core").pubsub.one("bs.user",e("bs/core").pubsub.channels.user_auth,t):t(f);return}return f},updateAccessToken:function(e){l=e},initFacebookLogin:function(){g(),h.isLoggedIn()&&FB.getLoginStatus(function(e){var t;e.authResponse&&(t=new i.dataProvider({url:"/api/user/token/update.json",type:"POST",data:{access_token:e.authResponse.accessToken}}),h.updateAccessToken(e.authResponse.accessToken),t.request())})},loginFacebook:M,initTwitterLogin:S,initGoogleLogin:x,initPocketAuth:N,initReadabilityAuth:k,authenticateInstapaper:A,authorized:function(t,n,r){return n=n||"Sign In",r=r||{},r.storyActionEl=r.storyActionEl||".story-action",r.twitterOnly?function(){var i=function(e){f.twitter&&f.twitter.screen_name?e.call(this,f):s.call(this,e)},s=function(t){E()?h.initTwitterLogin(a.bind(t,this),n):(e("bs/core").pubsub.one("user",e("bs/core").pubsub.channels.user_auth,a.bind(function(){y(a.bind(t,this))},this)),h.initTwitterLogin(null,n))};r.async&&$("#session_twitter").attr("target","session_iframe"),E()?f?i(t):y(a.bind(i,this,t)):s.call(this,t)}:(h.$loginEl?h.$loginEl.empty().detach():h.$loginEl=$('<div id="story-action-auth" class="popover story-action-auth" style="display:none"></div>'),function(){var i=$(this),s=i.closest(r.storyActionEl),o=s.closest(".story-container");return E()?f?t.call(this,f):y(a.bind(t,this)):(e("bs/core").pubsub.fire("signin_tooltip_displayed",n),e("bs/core").pubsub.fire("auth_tooltip_displayed"),e("bs/core").pubsub.one("savedstories",e("bs/core").pubsub.channels.user_auth,a.bind(function(){$(document).off("click",b),h.$loginEl.fadeOut(160),y(a.bind(t,this))},this)),h.$loginEl.html(m({action:n})).appendTo(s).fadeIn(160),o.addClass("show-story-actions"),$(document).on("click",b),e("bs/core").pubsub.on("storyaction","sitenav_auth_displayed",b)),!1})}},window.fbAsyncInit=h.initFacebookLogin,h.isLoggedIn()||$(document).on("click",".btn-facebook-auth",_).on("click",".btn-twitter-auth",D).on("click",".btn-google-auth",P),$(function(){$("#session-forms").load("/session/forms")}),h}),define("bs/util/media_queries_monitor",["lodash"],function(e){function t(t){this.query=t.query,this.listeners=[],window.matchMedia?(this.mql=window.matchMedia(this.query),this.mql.addListener(e.bind(this.checkMatches,this))):this.mql={matches:!1}}function n(e){this.mediaQueries={}}return t.prototype={addListener:function(e){this.listeners.push(e)},removeListener:function(t){this.listeners=e.reject(this.listeners,function(e){return e===t})},checkMatches:function(t){var n=t||this.mql;n.matches&&e.each(this.listeners,function(e){e()})}},n.prototype={addQuery:function(n,r){this.mediaQueries[n]||(this.mediaQueries[n]=new t({query:n})),r&&typeof r=="function"&&this.mediaQueries[n].addListener(r),e.invoke(this.mediaQueries,"checkMatches")},removeQuery:function(e,t){if(!this.mediaQueries[e])throw new Error('"'+e+'" is not a currently monitored media query');this.mediaQueries[e].removeListener(t)}},{factory:function(e){return new n(e)}}}),define("modernizr",[],function(){return Modernizr}),define("bs/core",["require","bs/util/pubsub","bs/util/user","bs/util/media_queries_monitor","jquery","lodash","modernizr"],function(e,t,n,r,i,s,o){var u=window.BS||{};return u.extend=i.extend,u.STATIC_BASE_URL="/static/fe/6e7942/",u.ENVIRONMENT="production",u.ENVIRONMENT==="staging"?u.STATIC_BASE_URL="//static.notouching.me"+u.STATIC_BASE_URL:u.ENVIRONMENT==="production"&&(u.STATIC_BASE_URL="//static.digg.com"+u.STATIC_BASE_URL),u.pubsub||u.extend(u,{pubsub:t}),u.user||(u.extend(u,{user:e("bs/util/user")}),window.fbAsyncInit||(window.fbAsyncInit=e("bs/util/user").initFacebookLogin)),u.mediaQueriesMonitor||u.extend(u,{mediaQueriesMonitor:r.factory()}),o.addTest("ipad",function(){return!!navigator.userAgent.match(/iPad/i)}),o.addTest("iphone",function(){return!!navigator.userAgent.match(/iPhone/i)}),o.addTest("ipod",function(){return!!navigator.userAgent.match(/iPod/i)}),o.addTest("appleios",function(){return o.ipad||o.ipod||o.iphone}),o.ipad&&(u.support={ipad_version_ready:new i.Deferred},window.ondevicemotion=function(e){if(navigator.platform.indexOf("iPad")!=-1){var t=1;e.acceleration&&(t+=window.devicePixelRatio),document.documentElement.className+=" ipad-v"+t,u.support.ipad_version_ready.resolve()}window.ondevicemotion=null}),o.addTest("positionfixed",function(){var e=document.createElement("div"),t=e.cloneNode(!1),n=!1,r=document.body||function(){return n=!0,document.documentElement.appendChild(document.createElement("body"))}(),i=r.style.cssText;r.style.cssText="padding:0;margin:0",e.style.cssText="position:fixed;top:42px",r.appendChild(e),r.appendChild(t);var s=e.offsetTop!==t.offsetTop;return r.removeChild(e),r.removeChild(t),r.style.cssText=i,n&&document.documentElement.removeChild(r),navigator.userAgent.match(/OS (\d)/i),s&&(!o.appleios||o.appleios&&RegExp.$1>=5)}),o.addTest("lastchild",function(){var e,t=["#modernizr-last-child li{display:block;width:100px;height:100px;}","#modernizr-last-child li:last-child{width:200px;}"],n=document.getElementsByTagName("head")[0]||function(){return document.documentElement.appendChild(document.createElement("head"))}(),r=document.body||function(){return document.documentElement.appendChild(document.createElement("body"))}(),i=document.createElement("ul"),s=document.createElement("li"),o=document.createElement("li"),u=document.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=t.join(""):u.appendChild(document.createTextNode(t.join(""))),n.appendChild(u),i.id="modernizr-last-child",i.appendChild(s),i.appendChild(o),r.appendChild(i),e=o.offsetWidth>s.offsetWidth,n.removeChild(u),r.removeChild(i),e}),function(e,t){t.support.touch="ontouchstart"in e}(this,this.jQuery),i.fn.k=function(e,t){return t===undefined&&(t="38,38,40,40,37,39,37,39,66,65"),this.each(function(){var n=[];i(this).keydown(function(r){n.push(r.keyCode),n.toString().indexOf(t)>=0&&(i(this).unbind("keydown",arguments.callee),e(r))})})},u}),define("bs/util/interface",[],function(){function e(e){this.members=e}return{factory:function(t){return new e(t)},ensureImplements:function(e,t){var n,r,i;for(n=0,r=t.members.length;n<r;n++){i=t.members[n];if(typeof e[i]=="undefined")throw new Error("InterfaceError: missing member '"+i+"'")}return!0}}}),define("bs/interfaces/view",["bs/util/interface"],function(e){var t=e.factory(["show","remove","render","_rendered"]);return t}),define("backbone",[],function(){}),define("bs/util/viewregion",["bs/util/interface","bs/interfaces/view","backbone"],function(e,t,n){var r=Backbone.View.extend({initialize:function(e){if(!e)throw new Error("ViewRegion missing config argument");this.name=e.name,this.currentView=null,e.scrollable&&(this.el.className+=" scrollable")},clearOldView:function(){this.currentView&&(this.currentView.remove(),this.currentView.el=null,this.currentView.$el=null,this.currentView=null)},load:function(n){e.ensureImplements(n,t),this.clearOldView(),this.setCurrentView(n),n.show(),n.el&&this.el.appendChild(n.el),n.postShow&&n.postShow()},setCurrentView:function(e){this.currentView=e},update:function(e){e.className&&(this.el.className=e.className)},resize:function(e){typeof e.height=="number"&&(e.height=e.height+"px"),typeof e.width=="number"&&(e.width=e.width+"px"),e.height&&(this.el.style.height=e.height),e.width&&(this.el.style.width=e.width)}});return{factory:function(e){return new r(e)}}}),define("bs/util/viewmanager",["bs/util/viewregion"],function(e){function t(e,t){return function(){var n=Array.prototype.slice.call(arguments);e.apply(t,n)}}function n(){this.viewregions={},this.keyboardShortcuts={},document.addEventListener("keydown",t(this.handleKeyboardShortcuts,this),!0)}return n.prototype={addKeyboardShortcuts:function(e){var t,n,r,i;if(e.keyboardShortcuts)for(t=0,n=e.keyboardShortcuts.handlers.length;t<n;t++)i=e.keyboardShortcuts.handlers[t],r=JSON.stringify(i.keyConfig),this.keyboardShortcuts[r]||(this.keyboardShortcuts[r]=i)},removeKeyboardShortcuts:function(e){var t,n,r,i;if(e.keyboardShortcuts)for(t=0,n=e.keyboardShortcuts.handlers.length;t<n;t++)i=e.keyboardShortcuts.handlers[t],r=JSON.stringify(i.keyConfig),this.keyboardShortcuts[r]&&delete this.keyboardShortcuts[r]},handleKeyboardShortcuts:function(e){var t,n;e.target.nodeName.toLowerCase()!=="input"&&(t={key:e.keyCode,altKey:!!e.altKey,ctrlKey:!!e.ctrlKey,shiftKey:!!e.shiftKey,metaKey:!!e.metaKey},n=JSON.stringify(t),this.keyboardShortcuts[n]&&(e.preventDefault(),e.stopPropagation(),this.keyboardShortcuts[n]()))},addRegion:function(t){if(!t)throw new Error("ViewManager.addRegion(): missing config argument");if(this.viewregions[t.name])throw new Error("ViewManager.addRegion(): region '"+t.name+"' already exists");return this.viewregions[t.name]=e.factory(t),this.viewregions[t.name]},load:function(e,t){if(!this.viewregions[e])throw new Error("ViewManager.load(): '"+e+"' is an invalid region");this.viewregions[e].currentView&&this.removeKeyboardShortcuts(this.viewregions[e].currentView),this.addKeyboardShortcuts(t),this.viewregions[e].load(t)},update:function(e,t){if(!this.viewregions[e])throw new Error("ViewManager.update(): '"+e+"' is an invalid region");this.viewregions[e].update(t)},reload:function(e,t){if(!this.viewregions[e])throw new Error("ViewManager.load(): '"+e+"' is an invalid region");this.viewregions[e].currentView&&this.viewregions[e].currentView.render(t)},resize:function(e,t){if(!this.viewregions[e])throw new Error("ViewManager.resize(): '"+e+"' is an invalid region");this.viewregions[e].resize(t)}},{factory:function(e){return new n(e)}}}),define("bs/model/feeditem",["bs/core","bs/util/xhr","bs/util/helpers","bs/util/format","lodash","backbone"],function(e,t,n,r,i,s){function o(e){return e=e||"",e=e.replace(/<a/g,'<a target="_blank"'),e}var u=Backbone.Model.extend({initialize:function(t,r){var s=n.param({url:t.content.url,via:"Digg",text:t.content.title}),u=n.param({display:"popup",app_id:e.config.FB_APP_ID,link:t.content.url,redirect_uri:"http://digg.com/fbshare"}),a=t.content.description?t.content.description.substr(0,197):"",f=t.content.description?t.content.description.substr(0,140):"",l=[],c;a&&a.length>=197&&a[a.length-1]!=="."&&(a+="..."),f&&f.length>=140&&f[a.length-1]!=="."&&(f+="..."),this.set("id",t.content.content_id),this.feed=r.feed,i.extend(t.content,{body:o(t.content.body),short_description:a,shorter_description:f,position:"",fuzzyTimestamp:this.getFuzzyTimestamp(),tweetlink:"https://twitter.com/intent/tweet?"+s,fblink:"https://www.facebook.com/dialog/feed?"+u,dugg:this.get("dugg"),read_later:this.get("read_later")}),t.tweets.sharers_display=!1,t.tweets.count&&(i.each(t.tweets.data,function(e,t){e.url=n.getTweetURL({twitter_screen_name:e.user.screen_name,tweet_id:e.id}),t<4&&l.push('<a href="'+e.url+'" target="_blank">'+e.user.name+"</a>")}),t.tweets.count>4?l[l.length-1]=" and "+(t.tweets.count-3)+" others":t.tweets.count>1&&t.tweets.data.length>1&&(l[l.length-1]=" and "+l[l.length-1]),c=l.pop(),t.tweets.sharers_display=l.join(", ")+c),t.dots||this.set("dots",0),this.set({subscribed:!!this.feed&&!!this.feed.get("subscribed"),content:t.content})},handleMarkAsReadSuccess:function(){},handleDiggSuccess:function(){this.set({dugg:!0},{silent:!0})},handleDeleteDiggSuccess:function(){this.set({dugg:!1},{silent:!0})},handleReadingListAdd:function(){this.set({read_later:!0},{silent:!0})},handleReadingListDelete:function(){this.set({read_later:!1},{silent:!0})},markAsRead:function(n,r){var s,o,u;return!this.get("subscribed")||this.get("read")||this.get("keep_unread")?!1:(e.pubsub.fire("pause_api_sync:start"),this.set({read:!0},{silent:!!r}),n||(this.feed.syncing=!0),this.feed.updateUnreadCount(-1,this.get("content").feed_url,!this.feed.get("label")&&this.feed.get("title").indexOf("digg.com/all")>-1),s="/api/reader/markasread/story.json",u=this.get("content"),o=new t.dataProvider({url:s,type:"POST",data:{content_id:u.content_id,feed_url:u.feed_url},error:function(t,n,r){t.status===0&&e.pubsub.fire("display_app_message",{msg:"We're having trouble marking items as read. Please disable your Ad Blocker.",className:"error"})},success:i.bind(function(t){e.pubsub.fire("pause_api_sync:end"),this.feed.syncing=!1},this)}),o.request(),!1)},toggleReadState:function(e,n){var r,i=this.get("read"),s=this.get("content"),o;return this.set({read:!i},{silent:!!n}),i?this.feed.updateUnreadCount(1,this.get("content").feed_url,!this.feed.get("label")&&this.feed.get("title").indexOf("digg.com/all")>-1):this.feed.updateUnreadCount(-1,this.get("content").feed_url,!this.feed.get("label")&&this.feed.get("title").indexOf("digg.com/all")>-1),r="/api/reader/toggleread.json",o=new t.dataProvider({url:r,type:"POST",data:{content_id:s.content_id,feed_url:s.feed_url,currently_read:i}}),o.request(),!1},submitDigg:function(){var e="/api/digg/submit.json",n;return n=new t.dataProvider({url:e,type:"POST",data:{content_id:this.get("content").content_id},success:i.bind(this.handleDiggSuccess,this)}),n.request(),!1},deleteDigg:function(){var e="/api/digg/delete.json",n;return n=new t.dataProvider({url:e,type:"POST",data:{content_id:this.get("content").content_id},success:i.bind(this.handleDeleteDiggSuccess,this)}),n.request(),!1},saveStory:function(){var e="/api/story/readlater/add.json",n;return n=new t.dataProvider({url:e,type:"POST",data:{content_id:this.get("content").content_id},success:i.bind(this.handleReadingListAdd,this)}),n.request(),!1},deleteSave:function(){var e="/api/story/readlater/delete.json",n;return n=new t.dataProvider({url:e,type:"POST",data:{content_id:this.get("content").content_id},success:i.bind(this.handleReadingListDelete,this)}),n.request(),!1},addToInstapaper:function(){var e="/api/story/instapaper/add.json",n=new t.dataProvider({url:e,type:"POST",data:{content_id:this.get("content").content_id}});return n.request(),!1},addToPocket:function(){var e="/api/story/pocket/add.json",n=new t.dataProvider({url:e,type:"POST",data:{content_id:this.get("content").content_id}});return n.request(),!1},addToReadability:function(){var e="/api/story/readability/add.json",n=new t.dataProvider({url:e,type:"POST",data:{content_id:this.get("content").content_id}});return n.request(),!1},getFuzzyTimestamp:function(){return r.secondsToDiggReaderTime(this.get("date"),!0)}});return{factory:function(e,t){return new u(e,t)},constructor:u}}),define("bs/collection/feeditems",["bs/model/feeditem","backbone"],function(e,t){var n=Backbone.Collection.extend({initialize:function(e,t){t.noSort&&(this.comparator=null)},model:e.constructor,comparator:function(e,t){return e.get("date")<=t.get("date")?1:-1}});return{factory:function(e,t){return new n(e,t)},constructor:n}}),define("bs/model/feed",["bs/core","bs/collection/feeditems","bs/util/xhr","lodash","backbone"],function(e,t,n,r,i){var s=Backbone.Model.extend({url:function(){var e=this.get("next_position"),t=e>0?"60":"20",n=this.get("show")||"all",r;return this.get("subscribed")||(t="80"),r=["/api/reader/feed.json?","feed_url=",encodeURIComponent(this.get("feed_url")),"&show=",n,"&count=",t],e&&e!==-1&&r.push("&position="+e),r.join("")},initialize:function(e,n){this.set("id",e.subscription_id),this.items=t.factory(null,{noSort:e.noSort}),this.folders=new Backbone.Collection,this.syncing=!1,this.fetchProxy=r.bind(this.fetch,this),n.DAO&&(this.DAO=n.DAO),e.folders&&(this._folders=e.folders)},fetch:function(){var e=r.clone(n.config);e.cache=!1,s.__super__.fetch.call(this,e)},setFolders:function(e){if(!e)throw new Error("setFolders(): missing Subscriptions DAO argument");r.each(this._folders,function(t){if(!t)return;var n=t.label,r=e.subscriptions.findWhere({label:n});r&&this.folders.set(r,{remove:!1})},this)},rename:function(e){this.set("title",e)},parse:function(e){var t=!this.items.size();e.data&&(e.data.unread&&!this.get("next_position")&&this.set({unread:e.data.unread,api_sync:!0}),this.set({next_position:e.data.next_position},{silent:!0}),this.items.add(e.data.feed,{silent:!0,merge:!0,feed:this})),t&&this.items.trigger("reset"),this.items.trigger("add")},updateUnreadCount:function(e,t,n){var r;e=typeof e=="number"?e:0,r=~~this.get("unread")+e,r<0&&(r=0),this.set({unread:r,api_sync:!1}),this.folders.each(function(t){t.get("label").indexOf("digg.com/")<0&&t.updateUnreadCount(e)}),this.get("title").indexOf("digg.com/")<0&&!n?this.collection.findWhere({title:"digg.com/all"}).updateUnreadCount(e):t&&n&&this.collection.findWhere({feed_url:t}).updateUnreadCount(e,null,!0)},markAsRead:function(t,i){var s="/api/reader/markasread.json",o,u;t||(this.syncing=!0,e.pubsub.fire("pause_api_sync:start"),o=new n.dataProvider({url:s,type:"POST",data:{feed_url:this.get("feed_url"),stream_date:this.items.at(0).get("date")},success:r.bind(function(t){e.pubsub.fire("pause_api_sync:end"),this.syncing=!0},this)}),o.request()),u=~~this.get("unread"),this.get("title").indexOf("digg.com/")<0&&this.collection.findWhere({title:"digg.com/all"}).updateUnreadCount(-1*u),this.folders.each(function(e){e.updateUnreadCount(-1*u)}),this.items.each(function(e){e.set({read:!0,disable_toggleread:!0},{silent:!!i})}),this.set({unread:0,api_sync:!1},{silent:!!i})},resetItems:function(){this.items.reset(null,{silent:!0})}});return{factory:function(e,t){return new s(e,t)},constructor:s}}),define("bs/model/feedscollection",["bs/core","bs/collection/feedscollection","bs/collection/feeditems","bs/util/xhr","backbone","lodash"],function(e,t,n,r,i,s){var o=Backbone.Model.extend({url:function(){var e=this.get("next_position"),t=e>0?"60":"20",n=this.get("show")||"all",r=["/api/reader/feed.json?","folder=",encodeURIComponent(this.get("label")),"&show=",n,"&count=",t];return e&&r.push("&position="+e),r.join("")},parse:function(e){var t=!this.items.size();return this.set({next_position:e.data.next_position},{silent:!0}),this.items.add(e.data.feed,{silent:!0,merge:!0,feed:this}),t?this.items.trigger("reset"):this.items.trigger("add"),e},initialize:function(e,t){this.set("feeds",require("bs/collection/feedscollection").factory()),t.DAO&&(this.DAO=t.DAO),this.items=n.factory(),this.folders=new Backbone.Collection,this.syncing=!1,this.fetchProxy=s.bind(this.fetch,this)},fetch:function(){var e=s.clone(r.config);e.cache=!1,o.__super__.fetch.call(this,e)},updateUnreadCount:function(e,t){var n=~~this.get("unread")||0,r,i;return e!=null&&typeof e=="number"?(r=n+e,r<0&&(r=0),t&&(i=this.get("feeds").findWhere({feed_url:t}),i&&i.updateUnreadCount(e))):e==null&&(r=this.get("feeds").chain().map(function(e){return~~e.get("unread")||0}).reduce(function(e,t){return e+t},0).value()),r!=null&&typeof r=="number"&&this.set({unread:r,api_sync:!1}),n!==r},loadFromSortOrdering:function(e){var t=e||this.get("sort_order")+"",n=32,r,i,s=0;if(!this.DAO)throw new Error("FeedsCollectionModel missing this.DAO property");while(t.length)r=t.substr(0,n),t=t.replace(r,""),i=this.DAO.subscriptions.get(r),i&&(i.get("type")==="feed"&&i.setFolders(this.DAO),this.get("feeds").set(i,{remove:!1}),s+=i.unread||0)},serializeSortOrder:function(){var e=this.get("feeds").map(function(e){return e.get("id")});return e.join("")},expand:function(){var e=this.get("label");this.set({expanded:!0},{silent:!0}),this.DAO.updateFolderPrefs({folder:e,expanded:!0})},collapse:function(){var e=this.get("label");this.set({expanded:!1},{silent:!0}),this.DAO.updateFolderPrefs({folder:e,expanded:!1})},moveModel:function(e,t,n){n||(n={sync:!0});if(e>=this.get("feeds").models.length){var r=t-this.get("feeds").models.length;while(r-- +1)this.get("feeds").models.push(undefined)}this.get("feeds").models.splice(t,0,this.get("feeds").models.splice(e,1)[0]),this.set("sort_order",this.serializeSortOrder()),n.sync&&this.DAO.editSubscription({folder:this.get("label"),sort_order:this.get("sort_order"),action:"sort_folder"})},markAsRead:function(t,n){var i="/api/reader/markasread.json",o;t||(e.pubsub.fire("pause_api_sync:start"),this.syncing=!0,o=new r.dataProvider({url:i,type:"POST",data:{folder:this.get("label"),stream_date:this.items.at(0).get("date")},success:s.bind(function(t){e.pubsub.fire("pause_api_sync:end"),this.syncing=!1},this)}),o.request()),this.items.each(function(e){e.set({read:!0,disable_toggleread:!0},{silent:!!n})}),this.set({unread:0,api_sync:!1},{silent:!!n}),this.get("feeds").each(function(e){e.markAsRead(!0)})},resetItems:function(){this.items.reset(null,{silent:!0})}});return{factory:function(e,t){return new o(e,t)},constructor:o}}),define("bs/collection/feedscollection",["bs/model/feed","bs/model/feedscollection","backbone","lodash"],function(e,t,n,r){function i(e){return r.chain(e).map(function(e){return e.subscription_id}).reduce(function(e,t){return e+t},"").value()}var s=Backbone.Collection.extend({model:e.constructor,findOrCreate:function(t,n){var s;n||(n=this),s=n.subscriptions.get(t.id||t.subscription_id),t.api_sync=!0,t.prev_unread=t.prev_unread||0;if(!s)t.prev_unread=t.unread,s=t.type==="feed"?e.factory(t,{DAO:n}):require("bs/model/feedscollection").factory(t,{DAO:n});else if(!r.isEqual(s.attributes,t)){var o,u,a=!1;t.subs&&(o=i(s.attributes.subs),u=i(t.subs),o!==u&&(a=!0)),t.label&&t.label!==s.attributes.label&&(a=!0),t.title&&t.title!==s.attributes.title&&(a=!0),!s.attributes.syncing&&t.unread!=null&&t.unread!==s.attributes.unread&&(a=!0,t.prev_unread=s.attributes.unread),a&&s.set(t)}return s}});return{factory:function(e,t){return new s(e,t)},constructor:s}}),define("bs/interfaces/feeds",["bs/util/interface"],function(e){var t=e.factory(["url"]),n=e.factory(["feed_url"]),r=e.factory(["feed_url","feed_title"]),i=e.factory(["folder","folder_name"]),s=e.factory(["feed_url","folder"]),o=e.factory(["feed_url","folder","folder_remove","folder_index"]);return{fetch_feed:t,add_feed:n,rename_feed:r,copy_feed:s,move_feed:o,rename_folder:i}}),define("bs/model/subscriptionslist",["bs/core","bs/collection/feedscollection","bs/interfaces/feeds","bs/util/interface","bs/util/xhr","bs/util/cookies","bs/util/helpers","lodash"],function(e,t,n,r,i,s,o,u){function l(t){var n=t.data,r,i,s,o,a=this.subscriptions.findWhere({title:"digg.com/all"}),f=a.get("unread")||0;i=this.subscriptions.findWhere({label:"digg.com/root"}),!n.feed_url&&n.folders?(n.folders[0]=u.extend(n.folders[0],{subscribed:!0,type:"folder",show:i.get("show"),view:i.get("view"),force_visible:!0}),r=this.subscriptions.findOrCreate(n.folders[0],this),this.subscriptions.add(r),i=this.subscriptions.findWhere({label:"digg.com/root"}),i.get("feeds").reset(),s=n.folders[0].id+i.get("sort_order"),i.loadFromSortOrdering(s),i.set({sort_order:s}),i.trigger("change")):(n=u.extend(n,{subscribed:!0,type:"feed",show:i.get("show"),view:i.get("view")}),r=this.subscriptions.findOrCreate(n,this),this.subscriptions.add(r),r.setFolders(this),u.each(n.folders,u.bind(function(e){var t=this.subscriptions.findWhere({label:e.label});t||(e.type="folder",t=this.subscriptions.findOrCreate(e,this),this.subscriptions.add(t),o=e.id),t.get("feeds").reset(),t.loadFromSortOrdering(),t.set({sort_order:e.sort_order},{silent:e.label.indexOf("digg.com/root")>-1}),e.label.indexOf("digg.com/root")>-1&&t.updateUnreadCount()},this)),n.folders.length===1&&i.get("sort_order").indexOf(n.folders[0].id)<0&&(o=n.folders[0].id),i.get("feeds").reset(),o?s=o+i.get("sort_order"):r.folders.findWhere({label:"digg.com/root"})&&(s=r.get("id")+i.get("sort_order")),this._totalUnread+=r.get("unread")||0,a.set({unread:f+r.get("unread"),api_sync:!1}),i.loadFromSortOrdering(s),i.set({sort_order:s}),i.trigger("change"),e.pubsub.fire("add_feed_success",{feed_url:n.feed_url}))}function c(t){var n=t.data,r,i,s,o,u=this.subscriptions.findWhere({title:"digg.com/all"}),a=u.get("unread")||0;for(r in n)n.hasOwnProperty(r)&&(n.type="folder",n.force_visible=!0,p.call(this,n[r],r),i=this.subscriptions.findWhere({label:r}),i&&i.loadFromSortOrdering());s=this.subscriptions.findWhere({label:"digg.com/root"}),o=i.get("id")+s.get("sort_order"),s.get("feeds").reset(),s.loadFromSortOrdering(o),s.set({sort_order:o}),s.trigger("change"),this._totalUnread+=i.get("unread")||0,u.set({unread:a+i.get("unread"),api_sync:!1}),e.pubsub.fire("batch_add_feed_success",{folder:i.get("label")})}function h(e,t){var n=e.feed_url?this.subscriptions.findWhere({feed_url:e.feed_url}):this.subscriptions.findWhere({label:e.folder}),r,i,s=this.subscriptions.findWhere({title:"digg.com/all"}),o=s.get("unread")||0,u;n.get("type")==="folder"&&(this._totalUnread-=n.get("unread")||0,s.set({unread:o-n.get("unread"),api_sync:!1}),n.get("feeds").each(function(e){e.folders.size()===1&&e.folders.at(0).get("label")===n.get("label")&&this.subscriptions.remove(e)},this),r=this.subscriptions.findWhere({label:"digg.com/root"}),r.get("feeds").remove(n),i=r.get("sort_order"),r.set({sort_order:i.replace(n.get("id"),"")}),r.trigger("force_update")),e.folder?(this._totalUnread-=n.get("unread")||0,s.set({unread:o-n.get("unread"),api_sync:!1}),u=n.folders.find(function(t){return t.get("label")===e.folder}),u&&(n.folders.remove(u),u.get("feeds").remove(n),u.set({sort_order:u.serializeSortOrder()}),u.get("label").indexOf("digg.com/")<0&&u.updateUnreadCount())):(this._totalUnread-=n.get("unread")||0,s.set({unread:o-n.get("unread"),api_sync:!1}),n.folders.each(function(e){e.get("feeds").remove(n)}),this.subscriptions.remove(n))}function p(e,t){var n;e.type="folder",e.label=t,e.subscribed=!0,n=this.subscriptions.findOrCreate(e,this),this.subscriptions.set(n,{remove:!1}),u.each(e.subs,u.bind(d,this))}function d(e){var t;e.type="feed",e.subscribed=!0,e.title.indexOf("digg.com/popular")>-1&&(e.noSort=!0),t=this.subscriptions.findOrCreate(e,this),this.subscriptions.set(t,{remove:!1})}function v(e,t){var n=this.subscriptions.get(e.id);n?n.loadFromSortOrdering():console.log("couldn't find folder",t,", id =",e.id)}function m(){var e,t=0,n,r=this.subscriptions.findWhere({label:"digg.com/all"}),i,s=this.subscriptions.filter(function(e){var t=e.get("title"),n=e.get("label");return~~e.get("unread")>0&&e.get("prev_unread")<e.get("unread")&&(t&&t.indexOf("digg.com/")<0||n&&n.indexOf("digg.com/")<0)});i=r.get("unread")>this._totalUnread?r.get("unread")-this._totalUnread:0;var o=s.map(function(e){return e.get("id")});if(this._prevUnreadFeeds.length){n=this._prevUnreadFeeds.length;while(t<n)u.contains(o,this._prevUnreadFeeds[t])||o.push(this._prevUnreadFeeds[t]),t++}return this._initialized?this._newUnreadFeeds=u.union(this._newUnreadFeeds,u.difference(o,this._prevUnreadFeeds)):this._totalUnread=r.get("unread"),e=o.length-this._prevUnreadFeeds.length,this._prevUnreadFeeds=o,{new_items:i,new_feeds:e}}var a=3,f=1e4,g=Backbone.Model.extend({url:function(){return"/api/subscription/list.json"},resetUnreadFeedsCounter:function(){var e=this.subscriptions.findWhere({label:"digg.com/all"});this._totalUnread=e.get("unread"),this._prevUnreadFeeds.length=0,this._newUnreadFeeds.length=0,this.set({unread_changed:{new_items:0,new_feeds:0}},{silent:!0})},initialize:function(n,r){var i=!n;n||(n={progress:n?n.progress:{},subscriptions:n?n.subscriptions:{}}),this._initialized=!1,this._prevUnreadFeeds=[],this._newUnreadFeeds=[],this.fetchProxy=u.bind(this.fetch,this),this.progress=new Backbone.Model,this.subscriptions=t.factory(),this.on("sync",this.checkProgress,this),this.progress.set(n.progress),i?e.user.get("user_id")&&this.fetchProxy():this.checkProgress(),u.size(n.subscriptions)&&this.loadSubscriptions(n.subscriptions),this._retryAttempt=0},handleFetchError:function(e,t,n){e._retryAttempt<a?(setTimeout(e.fetchProxy,f),e._retryAttempt++):(e.set({status:"fail"},{silent:!0}),e.progress.set({polling_status:500}),e.trigger("change"),e._retryAttempt=0)},fetch:function(){var e=u.clone(i.config);e.error=this.handleFetchError,e.cache=!1,g.__super__.fetch.call(this,e)},checkProgress:function(){var e=~~this.progress.get("polling_status"),t=e!==0?~~this.progress.get("polling_interval"):~~this.progress.get("unread_polling_interval");t>0&&(this.pollingInterval=t*1e3,this.clearNextFetch(),this.setNextFetch()),this._retryAttempt=0},setNextFetch:function(){this._nextFetch||(this._nextFetch=setTimeout(this.fetchProxy,this.pollingInterval))},clearNextFetch:function(){clearTimeout(this._nextFetch),this._nextFetch=null},parse:function(e){var t;u.size(e.data.subscriptions)&&(t=e.data.subscriptions["digg.com/all"],t&&(t.subs[0].unread=t.unread),this.loadSubscriptions(e.data.subscriptions)),this.progress.set(e.data.progress)},loadSubscriptions:function(e){var t,n,r,s,o,a,f,l,c="digg.com/all";u.each(e,u.bind(p,this)),u.each(e,u.bind(v,this)),this.set({unread_changed:m.call(this)}),t=this.subscriptions.findWhere({title:c}),n=this.subscriptions.findWhere({label:c});if(!this._initialized){if(t){r={silent:this._initialized},t.set({alt_title:"All",unread:n.get("unread"),api_sync:!0},r);var h=this;t.markAsRead=function(){var e="/api/reader/markasread.json",t=new i.dataProvider({url:e,type:"POST",data:{folder:this.get("label"),stream_date:this.items.at(0).get("date")}});t.request(),this.items.each(function(e){e.set({read:!0,disable_toggleread:!0})}),this.set({unread:0,api_sync:!1}),h.subscriptions.findWhere({label:c}).set({unread:0,api_sync:!1}),h.markAllAsRead()}}t.on("change:unread",u.bind(function(e){t.get("api_sync")||(this._totalUnread+=t.get("unread")-t.previous("unread"))},this)),f=this.subscriptions.findWhere({title:"digg.com/deeper"}),f&&f.set({alt_title:"Digg Deeper"},{silent:!0}),a=this.subscriptions.findWhere({title:"digg.com/popular"}),a&&a.set({alt_title:"Popular"},{silent:!0}),s=this.subscriptions.findWhere({title:"digg.com/diggs"}),s&&s.set({alt_title:"Diggs"},{silent:!0}),o=this.subscriptions.findWhere({title:"digg.com/saved"}),o&&o.set({alt_title:"Saved"},{silent:!0}),l=this.subscriptions.findWhere({label:"digg.com/tags"}),l&&(l.set({alt_label:"Tags"},{silent:!0}),l.get("feeds").each(function(e){e.set("icon","tag")}))}this._initialized=!0},fetchSubscription:function(e){r.ensureImplements(e,n.fetch_feed);var t="/api/subscription/fetch.json",o=u.extend(u.clone(i.config),{url:t,type:"POST",data:e}),a;return o.data._xsrf=s.get("_xsrf"),a=Backbone.ajax(o),a},addSubscription:function(e){var t="/api/subscription/add.json",n=u.extend(u.clone(i.config),{url:t,type:"POST",data:e,success:u.bind(l,this)}),r;if(e.folder&&e.folder.indexOf("digg.com/")>-1)throw new Error("SubscriptionsListModel.addSubscription(): Invalid folder name");return n.data._xsrf=s.get("_xsrf"),r=Backbone.ajax(n),r},batchAddSubscription:function(e){var t="/api/subscription/batch_add.json",n=u.extend(u.clone(i.config),{url:t,type:"POST",data:e,success:u.bind(c,this)}),r;if(e.folder&&e.folder.indexOf("digg.com/")>-1)throw new Error("SubscriptionsListModel.batchAddSubscription(): Invalid folder name");return n.data._xsrf=s.get("_xsrf"),r=Backbone.ajax(n),r},editSubscription:function(e){var t="/api/subscription/edit.json",n=u.extend(u.clone(i.config),{url:t,type:"POST",data:e});return n.data._xsrf=s.get("_xsrf"),Backbone.ajax(n)},renameFeed:function(e){return r.ensureImplements(e,n.rename_feed),this.subscriptions.findWhere({feed_url:e.feed_url}).set("title",e.feed_title),e.action="rename_feed",this.editSubscription(e)},renameFolder:function(e){r.ensureImplements(e,n.rename_folder);if(e.folder_name.indexOf("digg.com/")>-1)throw new Error("SubscriptionsListModel.renameFolder(): Invalid folder name");return this.subscriptions.findWhere({label:e.folder}).set("label",e.folder_name),e.action="rename_folder",this.editSubscription(e)},copyFeed:function(e){var t,i,s;return r.ensureImplements(e,n.copy_feed),t=this.subscriptions.findWhere({feed_url:e.feed_url}),i=this.subscriptions.findWhere({label:e.folder}),i.get("feeds").add(t),s=t.get("folders"),s.push({label:i.get("label"),id:i.get("id")}),t.set("folders",s),e.action="copy_folder",this.editSubscription(e)},moveFeed:function(e){var t,i,s,o,u;return r.ensureImplements(e,n.move_feed),t=this.subscriptions.findWhere({feed_url:e.feed_url}),i=this.subscriptions.findWhere({label:e.folder}),s=this.subscriptions.findWhere({label:e.folder_remove}),s.get("feeds").remove(t),o=s.updateUnreadCount(),s.set({sort_order:s.serializeSortOrder()}),t.folders.remove(s,{silent:!0}),i.get("feeds").add(t,{at:e.folder_index,silent:!0}),t.folders.add(i,{silent:!0}),u=i.updateUnreadCount(),i.set({sort_order:i.serializeSortOrder()}),e.sort_order=i.get("sort_order"),e.action="move_feed",this.editSubscription(e)},deleteSubscription:function(e){var t="/api/subscription/delete.json",n=u.extend(u.clone(i.config),{url:t,type:"POST",data:e}),r;return n.data._xsrf=s.get("_xsrf"),n.data.traditional=!0,r=Backbone.ajax(n),r.success(u.bind(h,this,e)),r},setFeedView:function(e){return this.subscriptions.each(function(t){t.set({view:e},{silent:!0})}),this.updateFolderPrefs({view:e})},setShowType:function(e){var t;return this.subscriptions.each(function(n){n.get("label")&&n.get("label").indexOf("digg.com/root")>-1?t=n:n.set({show:e},{silent:!0})}),t&&t.set({show:e}),this.updateFolderPrefs({show:e})},updateFolderPrefs:function(e){var t="/api/reader/prefs.json",n=u.extend(u.clone(i.config),{url:t,type:"POST",data:e}),r;return n.data._xsrf=s.get("_xsrf"),n.data.traditional=!0,r=Backbone.ajax(n),r},markAllAsRead:function(){this.subscriptions.each(function(e){var t=e.get("label"),n=e.get("title"),r=t&&t.indexOf("digg.com/root")>-1,i=t&&t.indexOf("digg.com/all")>-1,s=n&&n.indexOf("digg.com/all")>-1;!r&&!i&&!s&&e.markAsRead(!0)}),this.resetUnreadFeedsCounter()}});return{factory:function(e,t){return new g(e,t)},constructor:g}}),define("bs/reader/subscriptions",["bs/core","bs/model/subscriptionslist"],function(e,t){var n;return!e.reader||!e.reader.subscriptions?(n=t.factory(e.config.subscriptions&&e.config.subscriptions.data),e.reader={subscriptions:n.subscriptions,model:n}):n=e.reader.model,n}),define("bs/interfaces/command",["bs/util/interface"],function(e){var t=e.factory(["execute"]);return t}),define("bs/util/keyboardshortcutsmanager",["bs/util/interface","bs/interfaces/command","lodash"],function(e,t,n){function i(e){this.scope=e||window,this.handlers=[],this._enabled=!0}var r={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,esc:27,space:32,pageup:33,pagedown:34,end:35,home:36,leftarrow:37,uparrow:38,rightarrow:39,downarrow:40,insert:45,"delete":46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,"0numpad":96,"1numpad":97,"2numpad":98,"3numpad":99,"4numpad":100,"5numpad":101,"6numpad":102,"7numpad":103,"8numpad":104,"9numpad":105,Multiply:106,plus:107,minus:109,dot:110,Slash1:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,equals:187,comma:188,slash:191,backslash:220};return i.prototype={_findHandlerByKeyConfig:function(e){var t;return n.find(this.handlers,function(r,i){return t=i,n.isEqual(r.keyConfig,e)}),t},enable:function(){this._enabled=!0},disable:function(){this._enabled=!1},add:function(i,s){var o,u=this,a=["key","altKey","ctrlKey","shiftKey","metaKey"],f={};e.ensureImplements(s,t),i=typeof i=="object"?i:{key:i},n.each(a,function(e){i[e]?f[e]=i[e]:f[e]=!1}),f.key=r[f.key],o=function(){u._enabled&&s.execute()},o.keyConfig=f,this.handlers.push(o)},remove:function(e){var t,n;e=typeof e=="object"?e:{key:e,altKey:!1,ctrlKey:!1,shiftKey:!1},t=this._findHandlerByKeyConfig(e),n=this.handlers.splice(t,1)[0]}},{factory:function(){return new i}}}),define("bs/views/base",["bs/util/keyboardshortcutsmanager","backbone"],function(e,t){var n=Backbone.View.extend({initialize:function(t){this.name=t.name,this._rendered=!1,t.disable_keyboard_shortcuts||(this.keyboardShortcuts=e.factory())},show:function(){this._rendered||this.render()},render:function(){this._rendered=!0}});return{factory:function(e){return new n(e)},constructor:n}}),define("bs/util/command",[],function(){return{factory:function(e,t){var n;if(arguments.length<2)throw new Error("CommandFactory: obj and fn are required arguments");return n=Array.prototype.slice.call(arguments,2),{execute:function(){var r=n.concat(Array.prototype.slice.call(arguments));return typeof t=="string"?e[t].apply(e,r):t.apply(e,r)}}}}}),define("text!bs/templates/reader/gatekeeper_import.html",[],function(){return'<div id="gatekeeper-billboard" class="billboard importing-billboard">\n    <div class="importing-animation"></div>\n    <div class="status-bar-inner">\n        <div class="status-bar-label">\n            <strong>Importing...</strong>\n        </div>\n    </div>\n</div>\n<footer class="billboard-footer"></footer>'}),define("text!bs/templates/reader/gatekeeper_importwithstatus.html",[],function(){return'<div id="gatekeeper-billboard" class="billboard importing-billboard">\n    <div class="importing-animation"></div>\n    <div class="status-bar-inner">\n        <div class="status-bar-label">\n            <strong>Importing</strong>\n            <span class="completed" id="status-bar-completed-feeds"><%= completed_feeds %></span> of <span class="total" id="status-bar-total-feeds"><%= total_feeds %></span>\n        </div>\n        <div class="status-bar-status-tray">\n            <div class="status-bar-status" id="status-bar-status" style="width: <%= Math.round((completed_feeds/total_feeds)*100) + \'%\' %>"></div>\n        </div>\n    </div>\n</div>\n<footer class="billboard-footer"></footer>'}),define("text!bs/templates/reader/gatekeeper_importemail.html",[],function(){return'<div class="billboard email-you-later-billboard">\n    <h1 class="digg-reader-logo logo-small">Digg Reader</h1>\n    <div class="billboard-content">\n        <p><strong class="billboard-hed">This might take a while.</strong><br/>\n        We’ll email you as soon as your Google Reader data has been imported.<br/>\n        Please try again later.</p>\n        <a class="btn-action" href="/">Back to Digg.com</a>\n    </div>\n</div>'}),define("text!bs/templates/reader/gatekeeper_error.html",[],function(){return'<div class="billboard error-billboard">\n    <h1 class="digg-reader-logo logo-small">Digg Reader</h1>\n    <div class="billboard-content">\n        <p><strong class="billboard-hed">Something went wrong.</strong><br/>\n        We were unable to import your <br/>\n        Google Reader data.</p>\n        <a class="btn-action" href="/login?error=1">Try Again</a>\n    </div>\n</div>'}),define("bs/reader/view/gatekeeper",["bs/core","bs/views/base","bs/util/command","bs/util/format","bs/reader/subscriptions","text!bs/templates/reader/gatekeeper_import.html","text!bs/templates/reader/gatekeeper_importwithstatus.html","text!bs/templates/reader/gatekeeper_importemail.html","text!bs/templates/reader/gatekeeper_error.html","lodash"],function(e,t,n,r,i,s,o,u,a,f){var l=!1,c=!1,h=!1,p=!1,d=t.constructor.extend({events:{},tagName:"div",importBillboardTemplate:f.template(s),importWithStatusBillboardTemplate:f.template(o),importEmailMessageTemplate:f.template(u),errorBillboardTemplate:f.template(a),initialize:function(t){this.constructor.__super__.initialize.call(this,t),this.listenTo(this.model,"change",this.render),e.pubsub.on("","gatekeeper:importing",this.updateStatusBar),$("body").addClass("gatekeeper-active")},render:function(){var e=this.pollingStatus();return e&&(this.el.innerHTML=e),this._rendered=!0,this.el},pollingStatus:function(){var e=this.model.get("polling_status");switch(e){case-1:return this.stayOrComeBackLater();case 0:return this.allGood();case 1:return this.renderImportWithStatusBillboard();case 2:return this.renderImportBillboard();default:return this.renderError()}},stayOrComeBackLater:function(){var e=i.subscriptions.findWhere({label:"digg.com/root"}),t=e?e.get("feeds"):!1,n=t?t.size():0;return n>0?(p=!0,this.allGood()):this.renderImportEmailMessage()},allGood:function(){var t=i.subscriptions.findWhere({label:"digg.com/root"}),n=t.get("feeds"),r={};return r.importDataWasEmpty=h&&n.size()===0?!0:!1,r.partialImport=p?!0:!1,$("body").removeClass("gatekeeper-active"),e.pubsub.fire("gatekeeper:allgood",r),!1},renderImportBillboard:function(){return c?!1:(c=!0,h=!0,this.importBillboardTemplate())},renderImportWithStatusBillboard:function(){if(!l)return l=!0,c=!0,h=!0,this.importWithStatusBillboardTemplate(this.model.toJSON());this.updateStatusBar()},updateStatusBar:function(){var e=this.model.get("total_feeds"),t=this.model.get("completed_feeds"),n=Math.round(t/e*100)+"%";return $("#status-bar-completed-feeds").text(t),$("#status-bar-status").css("width",n),!1},renderImportEmailMessage:function(){return this.importEmailMessageTemplate()},renderError:function(){return this.errorBillboardTemplate()},remove:function(){e.pubsub.off("","gatekeeper:importing",this.updateStatusBar),d.__super__.remove.call(this)}});return{factory:function(e){return new d(e)},constructor:d}}),define("bs/widgets/usersettings",["bs/core","lodash"],function(e,t){function s(t){var n=$("#site-nav-user-widget"),r=$("#site-nav-user-module");r.appendTo("body"),n.html('<div id="site-nav-user-name" class="nav-item-user-name">'+t.name+"</div>"),$("#site-nav-user-module").appendTo(n),t.twitter&&($("#settings-login-type").html("Twitter"),$("#settings-fb-timeline").hide()),e.pubsub.off("site_nav_user_widget",e.pubsub.channels.user_auth,s)}function o(){var e=$("#site-nav-user-widget"),t=$("#site-nav-signin");t.appendTo("body"),e.html("Sign in"),t.appendTo(e)}function u(){r?a():n.load("/settings",function(){r=!0,a()})}function a(){var t=e.user.getUser(),r,s;return n.modal("show"),$("#settings-profile-img-container").html($("<img />",{src:t.profile_image_url,alt:"",width:40,height:40})),$("#settings-profile-name-container").html(t.name),t.email?($("#settings-input-email").val(t.email),$("#btn-update-email").removeClass("btn-disabled")):$("#btn-update-email").addClass("btn-disabled"),t.email_subscriber?r="left":r="right",$("#email-subscriber-switch").removeClass("form-element-switch-left form-element-switch-right").addClass("form-element-switch-"+r),t.facebook||($("#update-fb-settings-form").hide(),t.twitter&&$("#settings-login-type").html("Twitter")),t.fb_enable_og?s="left":s="right",$("#fb-timeline-switch").removeClass("form-element-switch-left form-element-switch-right").addClass("form-element-switch-"+s),$("#settings-input-userid").val(t.user_id),i&&(i=!1,$("#settings-input-email").on("keypress",function(e){this.value.length>1?$("#btn-update-email").removeClass("btn-disabled"):$("#btn-update-email").addClass("btn-disabled")})),!1}function f(e){$("#fb-enable-og").val(e.fb_enable_og),$("#settings-success").html(""),$("#update-fb-settings-form").submit()}function l(e){var t=$(this),n=$("#settings-status-indicator");if(t.hasClass("btn-disabled"))return;return n.find(".loading").show(),n.find(".success").hide(),$("#settings-invalid-message").empty(),$("#update-email-form").submit(),!1}function c(e){$("#settings-email-subscriber").val(e.email_subscriber),$("#settings-success").html(""),$("#update-email-subscriber").submit()}var n,r,i=!0;return{init:function(){$(function(){$.fn.modal&&(n=$("#user-settings-modal").modal({keyboard:!0,show:!1}))}),$("#site-nav-user-widget").on("mouseenter",function(t){var n=$(this);n.html().indexOf("Sign In")>-1&&e.pubsub.fire("signin_tooltip_displayed","Sign In")}),e.pubsub.one("site_nav_user_widget",e.pubsub.channels.user_auth,s),e.user.isLoggedIn()||$(o),e.pubsub.on("user_settings","settings_save_error",function(e){t.indexOf(e,"email")>-1?($("#settings-status-indicator").find(".loading").hide(),$("#settings-invalid-message").html("There was a problem saving your email address. Please refresh and try again.")):t.indexOf(e,"email_subscriber")>-1?$("#settings-success").html("There was a problem updating your settings. Please refresh and try again."):t.indexOf(e,"fb_enable_og")>-1&&$("#settings-success").html("There was a problem updating your settings. Please refresh and try again.")}),$("#btn-twitter-auth-topnav").on("click",function(t){var n="Sign In";return e.pubsub.fire("twitter_auth_click",n),e.user.initTwitterLogin(null,n),!1}),$(document).on("click","#fb-enable-og-true",function(t){e.pubsub.fire("fb_enable_og_update",1),f({fb_enable_og:1})}).on("click","#fb-enable-og-false",function(t){e.pubsub.fire("fb_enable_og_update",0),f({fb_enable_og:0})}).on("click","#email-subscriber-true",function(e){c({email_subscriber:!0})}).on("click","#email-subscriber-false",function(e){c({email_subscriber:!1})}).on("click","#btn-settings-modal-close",function(){n.modal("hide")}).on("click","#btn-display-settings-timeline",u).on("click","#btn-delete-link",function(e){return $(this).fadeOut(300,function(){$("#delete-account-confirmation").show()}),!1}).on("click","#delete-link-cancel",function(e){return $("#delete-account-confirmation").fadeOut(300,function(){$("#btn-delete-link").show()}),!1}).on("click","#delete-link",function(e){e.preventDefault(),e.stopPropagation(),$("#delete-account-form").submit()}).on("click","#btn-update-email",l),e.pubsub.on("user_settings","settings_save_success",function(n){var r,i;t.indexOf(n,"email")>-1?(r=$("#settings-status-indicator"),r.find(".loading").hide(),r.find(".success").show()):t.indexOf(n,"email_subscriber")>-1?(i=$("#settings-email-subscriber").val()==="true"?"left":"right",$("#email-subscriber-switch").removeClass("form-element-switch-left form-element-switch-right").addClass("form-element-switch-"+i)):t.indexOf(n,"fb_enable_og")>-1&&(i=$("#fb-enable-og").val()==="1"?"left":"right",$("#fb-timeline-switch").removeClass("form-element-switch-left form-element-switch-right").addClass("form-element-switch-"+i)),e.user.refresh()})}}}),define("bs/util/storyactions_v3",["require","bs/core","bs/util/cookies","bs/util/xhr","bs/util/format","bs/util/helpers","bs/widgets/onboarding","lodash"],function(e,t,n,r,i,s,o,u){function d(e){var t=(new Date).valueOf()+31536e6;$.extend(h,e),n.set({name:c,value:$.param(h),expires:new Date(t)})}function v(e){var n="http://api.digg.com/api/v3/redirect",r=$(this).closest(a),i=r.data("contentId"),s=t.user.get("user_id"),o=r.data("source"),u={url:this.href};i&&(u.content_id=i),s&&(u.user_id=s),o&&(u.source=o),navigator.mozApps&&window.locationbar.visible===!1&&(u.platform=1005,window.open([n,$.param(u)].join("?")));if(p==="mobile")u.platform=1005,window.location.href=[n,$.param(u)].join("?");else{if(this.target!=="_blank")return;window.open([n,$.param(u)].join("?"))}return!1}function m(e){var t={contentID:e.data("contentId"),diggUrlID:e.data("urlId"),category:e.data("category"),diggScore:e.data("diggScore"),tweets:e.data("tweets"),fbShares:e.data("fbShares"),diggs:e.data("diggs"),dugg:e.data("dugg")||e.hasClass(f),read_later:e.data("read_later")||e.hasClass(l)};return t.diggScore=u.isString(t.diggScore)?parseInt(t.diggScore.replace(/,/g,""),10):t.diggScore,t.tweets=u.isString(t.tweets)?parseInt(t.tweets.replace(/,/g,""),10):t.tweets,t.fbShares=u.isString(t.fbShares)?parseInt(t.fbShares.replace(/,/g,""),10):t.fbShares,t.diggs=u.isString(t.diggs)?parseInt(t.diggs.replace(/,/g,""),10):t.diggs,t}function g(e,t){e.data(t)}function y(e){u.each(e,function(e,t){b(t,e)})}function b(e,t,n){var r=$(".story-"+e),s=$(".diggscore-"+e),o=$(".diggs-"+e),u=$(".tweets-"+e),a=$(".fb_shares-"+e),c=$(".digg-"+e),h=$(".save-"+e),p=s.parent(".story-score"),d=$(".diggs-label-"+e);g(r,{diggScore:t.digg_score,diggs:t.diggs,tweets:t.tweets,fbShares:t.fb_shares,dugg:t.dugg,read_later:t.read_later});if(!s||!s.size())return;t.digg_score>0&&p.hasClass("story-score-zero")?p.removeClass("story-score-zero"):t.digg_score===0&&p.addClass("story-score-zero"),d.length>0&&t.diggs===0?p.addClass("story-score-zero"):d.length>0&&t.diggs===1?(d.html("digg"),p.removeClass("story-score-zero")):d.length>0&&(d.html("diggs"),p.removeClass("story-score-zero")),o.html(i.intWithCommas(t.diggs)),u.html(i.intWithCommas(t.tweets)),a.html(i.intWithCommas(t.fb_shares)),s.html(i.intWithCommas(t.digg_score,!0)),!n&&t.hasOwnProperty("dugg")&&t.dugg&&(c.html("Dugg"),r.addClass(f)),!n&&t.hasOwnProperty("read_later")&&t.read_later&&(h.html("Saved"),r.addClass(l))}function w(e){var t=$(this),n=t.parents(a),i=m(n),s={content_id:i.contentID,digg_url_id:i.diggUrlID},o=i.dugg?"/api/digg/delete.json":"/api/digg/submit.json",f=new r.dataProvider({url:o,type:"POST",data:s,success:u.bind(E,this,t,i.contentID)});return f.request(),!1}function E(e,n,r){var i=document.location.hash,s=$('.js--digg-story[data-content-id="'+n+'"]'),u=(new Date).valueOf()/1e3-~~t.user.get("date_signup")<900,a=r.data;b(n,a,!0),a.dugg?(t.pubsub.fire("digg_success",e,a,n),s.addClass(f),s.find(".js--digg-label").html("Dugg")):(t.pubsub.fire("digg_delete_success",e,a,n),s.removeClass(f),s.find(".js--digg-label").html("Digg"));if(i.match("test-onboarding")||a.dugg&&!h.dugg&&u)o.firstDigg(e),d({dugg:1})}function S(e){var t=$(this),n=t.parents(a),i=m(n),s=i.read_later?"/api/story/readlater/delete.json":"/api/story/readlater/add.json",o={content_id:i.contentID,digg_url_id:i.diggUrlID},f=new r.dataProvider({url:s,type:"POST",data:o,success:u.bind(x,this,t,i.contentID)});return f.request(),!1}function x(e,n,r){var i=document.location.hash,s=$('.js--digg-story[data-content-id="'+n+'"]'),u=(new Date).valueOf()/1e3-~~t.user.get("date_signup")<900,a=r.data;g(s,{read_later:a.read_later}),a.read_later?(s.addClass(l),s.find(".js--save-label").html("Saved"),t.pubsub.fire("add_reading_list_success",e,a,n)):(s.removeClass(l),s.find(".js--save-label").html("Save"),t.pubsub.fire("delete_reading_list_request",e,a,n));if(i.match("test-onboarding")||a.read_later&&!h.saved&&u)o.firstSave(e),d({saved:1})}function T(e){var n=$(this),r=n.hasClass("share-twitter")?"twitter":"facebook";return e.preventDefault(),t.pubsub.fire("story_share",r,n),r==="twitter"?!1:(s.popWin(this.href,null,{width:550,height:450}),!1)}function N(e){var t=$(this),n=t.data("shareContentId"),r=t.data("shareId"),i="share-details-"+n+"-"+r;$(".share-details-"+n).hide(),$("#"+i).show(),$(".story-trending-share-img-container-"+n).removeClass("current"),t.parent().addClass("current")}var a=".js--digg-story",f="is--dugg",l="is--saved",c="saflags",h=n.get(c),p=n.get("preferred_view")||"desktop";return h=h?s.deparam(h):{},{submitDigg:w,addReadingList:S,renderStoryScores:y,redirectStoryLink:v,shareStory:T,showShareDetails:N}}),define("text!bs/templates/reader/viewtype_item.html",[],function(){return'<li class="reader-nav-tooltip-list-item view-type view-type-<%= type %>"><a id="btn-<%= type %>" data-view-type="<%= type %>" href="#<%= type %>"><%= label %></a></li>\n'}),define("text!bs/templates/reader/showtype_item.html",[],function(){return'<li class="reader-nav-tooltip-list-item show-type show-type-<%= type %>"><a id="btn-<%= type %>" data-show-type="<%= type %>" href="#<%= type %>"><%= label %></a></li>\n'}),define("bs/views/viewtypeselector",["bs/core","bs/views/base","bs/util/command","text!bs/templates/reader/viewtype_item.html","text!bs/templates/reader/showtype_item.html","lodash"],function(e,t,n,r,i,s){var o=[{type:"expanded",label:"Expanded"},{type:"list",label:"List"}],u=[{type:"all",label:"All items"},{type:"unread",label:"Unread only"}],a=t.constructor.extend({events:{"click .view-type":"setViewType","click .show-type":"setShowType"},tagName:"div",className:"view-type-selector",viewTypeTemplate:s.template(r),showTypeTemplate:s.template(i),initialize:function(e){this.constructor.__super__.initialize.call(this,e);var t=n.factory(this,"setViewType","list"),r=n.factory(this,"setViewType","expanded"),i=n.factory(this,"setShowType","all"),s=n.factory(this,"setShowType","unread"),o=this.model.subscriptions.findWhere({label:"digg.com/root"});this.keyboardShortcuts.add("1",r),this.keyboardShortcuts.add("2",t),this.keyboardShortcuts.add("3",i),this.keyboardShortcuts.add("4",s),this.viewType=o&&o.get("view")||"list",this.showType=o&&o.get("show")||"all",this.listenTo(this.model,"change:view",this.render),this.listenTo(this.model,"change:show",this.render)},render:function(){var e=document.createDocumentFragment(),t=document.createElement("div"),n=document.createElement("div"),r=document.createElement("ul"),i="";return s.each(o,function(e){e.selected=e.type===this.viewType,i+=this.viewTypeTemplate(e)},this),s.each(u,function(e){e.selected=e.type===this.showType,i+=this.showTypeTemplate(e)},this),r.innerHTML=i,r.className="reader-nav-tooltip-list",t.id="show-type-label",t.className="show-type-label",t.innerHTML=this.getShowTypeLabelText(this.showType),e.appendChild(t),n.className="reader-nav-tooltip view-types",n.appendChild(r),e.appendChild(n),this.el.innerHTML="",this.el.appendChild(e),this._rendered=!0,this.el},getShowTypeLabelText:function(e){var t=e==="unread"?"Unread":"All items";return t},updateShowTypeLabel:function(e){var t=document.getElementById("show-type-label"),n="innerText"in t?"innerText":"textContent";t[n]=this.getShowTypeLabelText(e)},setViewType:function(t){var n=t.target?t.target.getAttribute("data-view-type"):t;return t&&t.stopPropagation&&t.stopPropagation(),this.viewType!==n&&(this.model.setFeedView(n),this.viewType=n,e.pubsub.fire("view_type_changed",this),e.pubsub.fire("hide_reader_nav_tooltips")),!1},getViewType:function(){return this.viewType=this.viewType?this.viewType:"list",this.viewType},setShowType:function(t){var n=t.target?t.target.getAttribute("data-show-type"):t;return t&&t.stopPropagation&&t.stopPropagation(),this.showType!==n&&(this.updateShowTypeLabel(n),this.model.setShowType(n),this.showType=n,e.pubsub.fire("show_type_changed",this),e.pubsub.fire("hide_reader_nav_tooltips")),!1},getShowType:function(){return this.showType=this.showType?this.showType:"all",this.showType}});return{factory:function(e){return new a(e)}}}),define("bs/reader/view/subsnav/basenav",["bs/core","bs/views/base","bs/util/command","bs/util/helpers","lodash"],function(e,t,n,r,i){var s="nav-item-focused",o=t.constructor.extend({tagName:"li",className:function(){var e=["dr-list-item","dr-feed-list-item"];return~~this.model.get("unread")&&e.push("dr-label-has-unread"),e.join(" ")},initialize:function(e){e.disable_keyboard_shortcuts=!0,this.parent=e.parent,this.visible=!0,this.updateVisibility(),o.__super__.initialize.call(this,e)},updateUnread:function(e){var t=this.el.getElementsByClassName("dr-unread-count")[0],n,i,s,u=this.model.get("title"),a,f=this.$el.children(".dr-label")[0];if(this.model.get("api_sync"))return;a=this.model.get("unread")-this.model.previous("unread"),e?n=~~this.model.get("unread"):f&&(n=~~f.getAttribute("data-unread")+a),i=n>o.MAX_UNREAD?"&#8734":n,s=n+" unread";if(u&&u.indexOf("digg.com/")>-1&&u.indexOf("all")<0&&u.indexOf("deeper")<0)return;this.showUnreadCounts&&(n>o.MAX_UNREAD&&Math.floor(Math.random()*100)<25&&(s+=". "+r.getMaxUnreadMessage()),n>0?t&&(t.innerHTML=i,t.setAttribute("title",s)):t&&(t.innerHTML="",t.setAttribute("title",""))),f.setAttribute("data-unread",n),this.setUnreadStatusClass(n)},updateVisibility:function(){if(!this.model)return;this.visible=this.model.get("show")==="all"||!e.user.get("show_only_unread_feeds")||!!this.model.get("unread")||!!this.model.get("force_visible")},handleFeedItemClick:function(){if(this.parent&&this.parent.feedViews){var e=i.indexOf(this.parent.feedViews,this);this.parent.setActive(e,this,!0)}},setFocus:function(e,t){var n;this.el.className+=" "+s;if(t)return;n=r.isElementInViewport(this.$el);if(n===!0)return;n!=null&&this.el.scrollIntoView(!1)},removeFocus:function(){this.el.className=this.el.className.replace(s,"")}});return o.MAX_UNREAD=999,o.CLASS_SEP=" ",{factory:function(e){return new o(e)},constructor:o}}),define("text!bs/templates/reader/feedview.html",[],function(){return'<% if (title.indexOf("digg.com/") < 0) { %>\n    <div class="dr-feed-badge" style="background-image: url(<%= icon %>); background-size: 16px;"></div>\n<% } %>\n\n<div class="dr-label dr-feed-label" data-unread="<%= unread || 0 %>">\n    <span title="<%- alt_title || title %>" class="dr-label-txt"><%- alt_title || title %></span>\n    <% if (showUnreadCounts) { %>\n        <span class="dr-unread-count"\n            <% if (unread) { %>\n                title="<%= unread %> unread"\n            <% } %>\n        ><%= unread ? unreadLabel : "" %></span>\n    <% } %>\n</div>\n'}),define("bs/reader/view/subsnav/feed",["bs/core","bs/reader/view/subsnav/basenav","bs/util/command","bs/util/helpers","text!bs/templates/reader/feedview.html","lodash"],function(e,t,n,r,i,s){var o=t.constructor.extend({events:{"click .dr-feed-label":"loadFeedItems"},template:s.template(i),tagName:"li",className:function(){var e=["dr-list-item","dr-feed-list-item"];return~~this.model.get("unread")&&e.push("dr-label-has-unread"),e.join(" ")},attributes:function(){return{draggable:!0,"data-feed-url":this.model.get("feed_url"),"data-html-url":this.model.get("html_url"),"data-title":this.model.get("title")}},initialize:function(t){o.__super__.initialize.call(this,t),this.showUnreadCounts=e.user.get("show_unread_counts"),this.renderNavItem(),this.listenTo(this.model,"change:title",this.updateTitle),this.listenTo(this.model,"change:unread",this.updateUnread)},renderNavItem:function(){var e=this.model.toJSON(),n;e.alt_title=e.alt_title||!1,e.showUnreadCounts=this.showUnreadCounts,e.unreadLabel=e.unread>t.constructor.MAX_UNREAD?"&#8734":e.unread,this.el.innerHTML=this.template(e),this.parent&&(n=this.parent.model.get("label"),this.el.setAttribute("data-parent",n))},updateTitle:function(){var e=this.el.getElementsByClassName("dr-label-txt")[0],t="innerText"in e?"innerText":"textContent",n=this.model.get("title");e[t]=n,e.setAttribute("title",n)},render:function(){return this._rendered=!0,this.el},handleFeedItemClick:function(){if(this.parent&&this.parent.feedViews){var e=s.indexOf(this.parent.feedViews,this);this.parent.setActive(e,this,!0)}},loadFeedItems:function(t){t&&t.stopPropagation();var n=this.model.get("feed_url"),r=this.model.get("html_url"),i=this.model.get("title"),s={feed_url:n,html_url:r,feed_title:i,navItem:this};this.parent&&(s.parentFolder=this.parent.model.get("label")),this.handleFeedItemClick(),e.pubsub.fire("feed_selected",s),i.indexOf("digg.com/")>-1&&$("#dr-subscription-list .dr-list-item").removeClass("nav-item-focused"),this.$el.removeClass("dr-feed-has-updates"),this.parent&&this.parent.checkChildUnreadFeeds()},setUnreadStatusClass:function(){var e="dr-label-has-unread";if(~~this.model.get("unread")){this.el.className.indexOf(e)<0&&(this.el.className+=t.constructor.CLASS_SEP+e);return}this.el.className=this.el.className.replace(t.constructor.CLASS_SEP+e,"");return}});return{factory:function(e){return new o(e)},constructor:o}}),define("text!bs/templates/reader/folderview.html",[],function(){return'\n<div class="dr-folder-toggle">&nbsp;</div>\n\n<div class="dr-feeds-collection-view dr-label dr-folder-label <%= unread && "dr-label-has-unread" %>" data-unread="<%= unread || 0 %>">\n    <span class="dr-label-txt" title="<%= alt_label || label %>"><%= alt_label || label %></span>\n    <% if (showUnreadCounts) { %>\n        <span class="dr-unread-count"\n            <% if (unread) { %>\n                title="<%= unread %> unread"\n            <% } %>\n        ><%= unread ? unreadLabel : "" %></span>\n    <% } %>\n</div>\n\n<ul class="dr-list dr-feed-list"></ul>\n\n'}),define("bs/reader/view/subsnav/folder",["bs/core","bs/reader/view/subsnav/basenav","bs/reader/view/subsnav/feed","bs/util/helpers","text!bs/templates/reader/folderview.html","lodash"],function(e,t,n,r,i,s){function o(e,t){var r;return e.get("type")==="folder"?r=new u({model:e,parent:t}):r=n.factory({model:e,parent:t}),r}var u=t.constructor.extend({events:{"click .dr-folder-label":"loadFeedItems","click .dr-folder-toggle":"toggleFolder"},template:s.template(i),tagName:function(){return this.model.get("label").indexOf("digg.com/root")>-1?"ul":"li"},className:function(){var e=this.model.get("label"),t=["dr-list-item","dr-feed-list-folder"];return e.indexOf("digg.com/root")>-1?t=["dr-root-feed-list","dr-feed-list"]:e.indexOf("digg.com/tags")>-1&&(t=["dr-tags-feed-list","dr-list-item","dr-feed-list-folder"]),t.join(" ")},attributes:function(){var e=this.model.get("label");return e.indexOf("digg.com/root")>-1?{id:"root-feed-list","data-folder":"digg.com/root","data-feed-url":"digg.com/root"}:e.indexOf("digg.com/tags")>-1?{id:"tags-feed-list","data-folder":"digg.com/tags","data-feed-url":"digg.com/tags"}:{draggable:!0,"data-rootonly":!0,"data-droppable":!0,"data-folder":this.model.get("label"),"data-feed-url":this.model.get("label"),"data-folder-expanded":this.model.get("expanded")}},initialize:function(t){u.__super__.initialize.call(this,t),this.listenTo(this.model,"force_update",this.forceRender),this.focusedIndex=this.model.get("nav_focused_index"),this.focusedItem=null,this.showUnreadCounts=e.user.get("show_unread_counts"),this.setFeedViews(),this.renderNavItem(),this.listenTo(this.model,"change:label",this.updateLabel),this.model.get("label").indexOf("digg.com/")<0&&this.listenTo(this.model,"change:unread",this.updateUnread),this.listenTo(this.model,"change:sort_order",s.bind(function(){this.updateFolderViews(!0)},this)),this.listenTo(this.model.get("feeds"),"remove",this.removeFeedView)},renderNavItem:function(){var e,n=this.model.toJSON(),r=2.063,i;n.alt_label=n.alt_label||!1,n.showUnreadCounts=this.showUnreadCounts,n.unread=n.unread||0,n.unreadLabel=n.unread>t.constructor.MAX_UNREAD?"&#8734":n.unread,this.el.innerHTML=this.template(n),e=this.el.getElementsByClassName("dr-feed-list")[0],i=s.size(this.feedViews)*r+r,s.each(this.feedViews,function(t){e.appendChild(t.render())}),Modernizr.csstransitions&&(this.el.style.height=i+"em"),this.model.get("is_active_nav_folder")&&(this.focusedIndex!=null?this.setActive(this.focusedIndex,this,!0,!0):this.setActive(0,null,!0,!0))},checkChildUnreadFeeds:function(){var e=this.$el.find(".dr-feed-has-updates").size();e||this.$el.removeClass("dr-feed-has-updates")},updateFolderViews:function(e){var t=this.el.getElementsByClassName("dr-feed-list")[0],n=2.063,r;$(t).empty(),this.setFeedViews(e),r=s.size(this.feedViews)*n+n,s.each(this.feedViews,function(e){t.appendChild(e.render()),e.delegateEvents()}),Modernizr.csstransitions&&(this.el.style.height=r+"em")},updateLabel:function(){var e=this.el.getElementsByClassName("dr-label-txt")[0],t="innerText"in e?"innerText":"textContent",n=this.model.get("label");e[t]=n,e.setAttribute("title",n),this.el.setAttribute("data-folder",n),this.el.setAttribute("data-feed-url",n)},render:function(){return this._rendered=!0,this.el},removeFeedView:function(e){var t=s.find(this.feedViews,function(t){return t.model.get("id")===e.get("id")});t&&t.remove()},updateVisibility:function(){u.__super__.updateVisibility.call(this),this._rendered&&this.updateFolderViews()},setFeedViews:function(e){var t;this.feedViews?(t=Array.prototype.slice.call(this.feedViews),s.each(t,function(e,t){e.$el.removeClass("dr-feed-has-updates")}),this.feedViews.length=0,this.numVisible=0,this.model.get("feeds").each(s.bind(function(n,r){var i=s.find(t,function(e){return e.model.get("id")===n.get("id")});i||(i=o(n,this)),n.set({api_sync:!1},{silent:!0}),i.el.setAttribute("data-sort-position",r),i.updateUnread(!0),i.updateVisibility(),i.visible&&(this.numVisible+=1,n.get("type")==="folder"&&i.setFeedViews(),!e&&s.contains(n.DAO._newUnreadFeeds,n.get("id"))&&(this.$el.addClass("dr-feed-has-updates"),i.$el.addClass("dr-feed-has-updates")),this.feedViews.push(i))},this))):(this.feedViews=[],this.numVisible=0,this.model.get("feeds").each(s.bind(function(e,t){var n=o(e,this);n.el.setAttribute("data-sort-position",t),t===this.focusedIndex&&(this.focusedItem=n),n.visible&&(this.numVisible+=1,this.feedViews.push(n))},this)))},get:function(e){return s.find(this.feedViews,function(t){if(e.name)return t.model.get("label")===e.name||t.model.get("title")===e.name})},expandFolder:function(){this.el.setAttribute("data-folder-expanded",!0),this.model.expand()},collapseFolder:function(){this.el.setAttribute("data-folder-expanded",!1),this.model.collapse()},toggleFolder:function(e){e&&e.stopPropagation();var t=this.el.getAttribute("data-folder-expanded");t==="true"?this.collapseFolder():this.expandFolder()},setActive:function(t,n,r,i){n&&n.parent?this.focusNavItem(t,!0,r,i):this.focusNavItem(t,!1,r,i),this.active=!0,n&&n!==this&&e.pubsub.fire("set_active_folder",this)},setInactive:function(){this.focusedItem&&this.focusedItem.removeFocus(),this.active=!1},focusNavItem:function(e,t,n,i){var s;n?s=e:s=this.focusedIndex!=null?this.focusedIndex+e:e===1?0:this.feedViews.length-1,this.focusedItem!=null&&this.focusedItem.removeFocus();if(e===1&&(s===this.feedViews.length&&this.parent||!t&&this.focusedItem&&this.focusedItem.model.get("expanded")&&this.focusedItem.feedViews.length))if(this.parent&&s===this.feedViews.length){if(!this.parent.parent&&this.parent.focusedIndex===this.parent.feedViews.length-1){this.focusedItem.setFocus();return}this.parent.setActive(e,this),this.setInactive()}else this.focusedItem.removeFocus(),this.focusedItem.setActive(1,this),this.setInactive();else e===-1&&(s<0&&this.parent||!t&&this.feedViews[s]&&this.feedViews[s].model.get("expanded")&&this.feedViews[s].feedViews.length)?this.parent&&s<0?(this.parent.setActive(0,this),this.setInactive(),this.focusedIndex=null,this.model.set({nav_focused_index:null},{silent:!0})):(this.focusedIndex=r.enforceRangeLimits(s,0,this.feedViews.length-1),this.model.set({nav_focused_index:this.focusedIndex},{silent:!0}),this.focusedItem=this.feedViews[this.focusedIndex],this.focusedItem.setActive(0,this),this.setInactive(!0)):(this.focusedIndex=r.enforceRangeLimits(s,0,this.feedViews.length-1),this.model.set({nav_focused_index:this.focusedIndex},{silent:!0}),this.focusedItem=this.feedViews[this.focusedIndex],this.focusedItem&&this.focusedItem.setFocus(n,i))},setUnreadStatusClass:function(e){var n="dr-label-has-unread",r=this.el.getElementsByClassName("dr-label")[0],i=new RegExp(t.constructor.CLASS_SEP+n,"g");if(!r)return;e=e||~~r.getAttribute("data-unread");if(!e){r.className=r.className.replace(i,"");return}if(r.className.indexOf(n)<0){r.className+=t.constructor.CLASS_SEP+n;return}},forceRender:function(){this.render(!0)},updateUnread:function(e){if(this.model.get("api_sync"))return;u.__super__.updateUnread.call(this,e),this.model.get("label").indexOf("digg.com/root")<0&&this.setUnreadStatusClass()},loadFeedItems:function(t){t&&t.stopPropagation();var n=this.model.get("label"),r;this.handleFeedItemClick(),r=this.$el.removeClass("dr-feed-has-updates").find(".dr-feed-has-updates"),r.size()&&r.removeClass("dr-feed-has-updates"),e.pubsub.fire("feed_selected",{folder:n,feed_title:n,navItem:this})}});return{factory:function(e){return new u(e)},constructor:u}}),define("bs/reader/view/subsnav/rootfolder",["bs/core","bs/reader/view/subsnav/folder","bs/util/helpers","text!bs/templates/reader/folderview.html","lodash"],function(e,t,n,r,i){var s=t.constructor.extend({events:{},initialize:function(e){s.__super__.initialize.call(this,e),this.visible=!0,this.listenTo(this.model,"change:show",this.updateFolderViews)},renderNavItem:function(){var t=document.createDocumentFragment();i.each(this.feedViews,function(e){t.appendChild(e.render()),e.delegateEvents(),e.feedViews&&i.each(e.feedViews,function(e){e.delegateEvents()})}),this.el.appendChild(t),e.user.get("show_only_unread_feeds")&&this.model.get("show")==="unread"?this.$el.removeClass("sortable"):this.$el.addClass("sortable")},updateFolderViews:function(){var t,n;this.$el.empty(),this.setFeedViews(),this.renderNavItem(),t=$(".view-region-nav"),e.user.get("show_only_unread_feeds")&&this.model.get("show")==="unread"?this.$el.removeClass("sortable"):this.$el.addClass("sortable"),e.user.get("show_only_unread_feeds")&&!this.numVisible?t.find(".nav-zero-items-label").size()||i.delay(function(){t.addClass("nav-zero-items").append($("<div />",{html:"No unread items","class":"nav-zero-items-label"}))},300):n=t.removeClass("nav-zero-items").find(".nav-zero-items-label").remove()}});return{factory:function(e){return new s(e)},constructor:s}}),define("bs/util/module_factory",[],function(){return{view:function(e){return{factory:function(t){return new e(t)},constructor:e}},model:function(e){return{factory:function(t,n){return new e(t,n)},constructor:e}},collection:function(e){return{factory:function(t,n){return new e(t,n)},constructor:e}}}}),define("bs/reader/view/subsnav/feed_deeper",["bs/core","bs/reader/view/subsnav/feed","bs/util/module_factory","lodash"],function(e,t,n,r){var i=t.constructor.extend({events:{"click .dr-feed-label":"checkUserHasDeeper"},checkUserHasDeeper:function(){var t=e.user.get("apps");t.digg_deeper&&t.digg_deeper.enabled?i.__super__.loadFeedItems.call(this):e.pubsub.fire("digg_deeper_onboarding")}});return n.view(i)}),define("bs/util/sortable",[],function(){function s(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function o(e,t,n){e.attachEvent?(e["e"+t+n]=n,e[t+n]=function(){e["e"+t+n](window.event)},e.attachEvent("on"+t,e[t+n])):e.addEventListener(t,n,!1)}function u(e,t,n){e.detachEvent?(e.detachEvent("on"+t,e[t+n]),e[t+n]=null):e.removeEventListener(t,n,!1)}function a(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function f(e,t){if(e.className)return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function l(e,t){f(e,t)||(e.className+=" "+t)}function c(e,t){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");f(e,t)&&(e.className=e.className.replace(n,""))}function h(e){var n=b(e),r,i=n.getBoundingClientRect(),s=null,o=null;for(var u=n.childNodes.length-1;u>=0;u-=1)f(n.childNodes[u],"dr-label")&&(r=n.childNodes[u]);if(!!d(t)||!n.hasAttribute("data-droppable")||n.getAttribute("data-droppable")!=="true")return s=i.top+i.height/2,e.pageY<s?"before":"after";i=r.getBoundingClientRect(),s=i.top+i.height/3,o=i.bottom-i.height/3;if(e.pageY>s&&e.pageY<o)return"droppable";if(e.pageY<s)return"before";if(e.pageY>o&&n.getAttribute("data-folder-expanded")==="false")return"after"}function p(e){var n=b(e),r=h(e);if(r==="before")n.parentNode.insertBefore(t,n);else if(r==="after")n.parentNode.insertBefore(t,n.nextSibling);else if(r==="droppable"){var i=n.getElementsByTagName("ul")[0],s=i.firstChild;i.insertBefore(t,s)}}function d(e){return t.hasAttribute("data-rootonly")?!0:!1}function v(t){return t.parentNode===e?!0:!1}function m(e){var n=b(e);return d(t)&&v(n)?!0:d(t)?!1:!0}function g(e){var n=e===t?!0:!1;return n}function y(e,t){return m(e)&&!g(t)?!0:!1}function b(e){var t=e.srcElement?e.srcElement:e.target;while(!t.hasAttribute("draggable"))t=t.parentNode;return t}function w(e){a(e)}function E(e){var n=b(e);return l(n,"dragging"),t=n,e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("Text","*")),i.dragStartFn(e,n),!1}function S(e){var t=b(e);n!==null&&r!==null&&c(n,r),y(e,t)&&(n=t,r="over move-"+h(e),l(n,r)),e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.dropEffect="move"),i.dragEnterFn(e,t),a(e)}function x(e){var t=b(e);y(e,t)&&(c(n,r),n=t,r="over move-"+h(e),l(n,r)),e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.dropEffect="move"),i.dragOverFn(e,t),a(e)}function T(e){var t=b(e);y(e,t)&&c(n,r),i.dragLeaveFn(e,t),a(e)}function N(e){var s=b(e);y(e,s)&&(p(e),c(n,r),c(t,"dragging")),i.dropFn(e,s),a(e)}function C(e){var s=e.srcElement?e.srcElement:e.target;c(s,"dragging"),c(n,r),t=null,i.dragEndFn(e,s),L.call(this,e)}function k(e){o(this,"selectstart",w),o(this,"dragstart",E),o(this,"dragenter",S),o(this,"dragover",x),o(this,"dragleave",T),o(this,"drop",N),o(this,"dragend",C)}function L(e){return u(this,"selectstart",w),u(this,"dragstart",E),u(this,"dragenter",S),u(this,"dragover",x),u(this,"dragleave",T),u(this,"drop",N),u(this,"dragend",C),!1}function A(){if(i.rootElement){var t=i.rootElement instanceof jQuery?i.rootElement[0]:i.rootElement;if(!O())return!1;e=t,o(t,"mousedown",k),o(t,"mouseup",L)}}function O(){var e=document.createElement("div"),t=Modernizr.hasEvent("dragstart",e)&&Modernizr.hasEvent("dragenter",e)&&Modernizr.hasEvent("dragover",e)&&Modernizr.hasEvent("dragleave",e)&&Modernizr.hasEvent("drop",e)&&Modernizr.hasEvent("dragend",e);return t&&"draggable"in e?!0:!1}var e=null,t=null,n=null,r=null,i={rootElement:null,dragStartFn:function(){},dragEnterFn:function(){},dragOverFn:function(){},dragLeaveFn:function(){},dropFn:function(){},dragEndFn:function(){}};return{init:function(e){s(i,e),A()}}}),define("bs/reader/view/nav",["bs/core","bs/reader/subscriptions","bs/model/feed","bs/views/base","bs/reader/view/subsnav/basenav","bs/reader/view/subsnav/feed","bs/reader/view/subsnav/folder","bs/reader/view/subsnav/rootfolder","bs/reader/view/subsnav/feed_deeper","bs/util/command","bs/util/sortable","lodash"],function(e,t,n,r,i,s,o,u,a,f,l,c){function T(e){this.activeFolder!==e&&(this.activeFolder===this.rootFolderView&&(this.activeFolder.focusedIndex=c.indexOf(this.rootFolderView.feedViews,e)),this.activeFolder&&(this.activeFolder.setInactive(),this.activeFolder.model.set({is_active_nav_folder:!1},{silent:!0})),this.activeFolder=e,this.activeFolder.model.set({is_active_nav_folder:!0},{silent:!0}))}function N(e){var t=e.parentNode.childNodes,n=0;for(var r=0,i=t.length;r<i;r+=1){n=r;if(e===t[r])break}return n}function C(e){var t=e.parentNode;return t.parentNode.hasAttribute("data-folder")?t.parentNode.getAttribute("data-folder"):t.getAttribute("data-folder")}var h={},p={},d,v,m,g,y,b,w,E,S,x,k=r.constructor.extend({dragStartProxy:function(t,n){e.pubsub.fire("pause_api_sync:start"),h.el=n,h.feed_url=n.getAttribute("data-feed-url"),h.index=n.getAttribute("data-sort-position"),n.hasAttribute("data-folder")?(h.isFolder=!0,h.isFeed=!1,h.folder=n.getAttribute("data-folder")):(h.isFolder=!1,h.isFeed=!0,h.folder=C(n))},dropProxy:function(){var n,r;e.pubsub.fire("pause_api_sync:end"),p.el=h.el,p.folder=C(p.el),r=N(p.el),r===0?p.index=0:p.index=~~p.el.parentNode.childNodes[r-1].getAttribute("data-sort-position"),h.index>p.index&&(p.index+=1),n=t.subscriptions.findWhere({label:p.folder}),h.isFeed&&p.folder!==h.folder?t.moveFeed({feed_url:h.feed_url,folder:p.folder,folder_remove:h.folder,folder_index:p.index}):n.moveModel(h.index,p.index)},selectNavItem:function(e){this.prevSelectedItem!=null&&this.prevSelectedItem.removeClass("dr-feed-selected"),e&&e.navItem&&(this.prevSelectedItem=e.navItem.$el.addClass("dr-feed-selected"),this.focusedItem=e.navItem)},refresh:function(){var n,r;e.pubsub.fire("loading_in_progress"),d.set({api_sync:!1},{silent:!0}),v.updateUnread(!0),this.updateTitle(),this.rootFolderView.updateFolderViews(),this.numFeedsChanged=0,this.numNewItems=0,t._newUnreadFeeds.length=0,t._totalUnread=d.get("unread"),n=$(".view-region-nav"),e.user.get("show_only_unread_feeds")&&!this.rootFolderView.numVisible?n.find(".nav-zero-items-label").size()||c.delay(function(){n.addClass("nav-zero-items").append($("<div />",{html:"No unread items","class":"nav-zero-items-label"}))},300):r=n.removeClass("nav-zero-items").find(".nav-zero-items-label").remove()},initialize:function(n){this.numNewItems=0;var r=t.subscriptions.findWhere({label:"digg.com/root"}),i=t.subscriptions.findWhere({label:"digg.com/tags"});this.constructor.__super__.initialize.call(this,n),this.viewManager=n.viewManager,this.viewManager.addRegion({name:"subscription-list",el:document.getElementById("dr-subscription-list")}),i&&this.initializeTagsView(i),this.rootFolderView=u.factory({model:r}),T.call(this,this.rootFolderView),e.pubsub.on("navItemSelected","feed_selected",this.selectNavItem),this.prevSelectedItem=null,this.initKeyboardShortcuts(),e.pubsub.on("navItemActive","set_active_folder",c.bind(T,this)),this.adjustSizeProxy=c.debounce(c.bind(this.adjustSize,this),300),$(window).on("resize",this.adjustSizeProxy),this.initAllFeedNavItem(),this.initDeeperFeedNavItem(),this.initPopularFeedNavItem(),this.initDiggsFeedNavItem(),this.initSavedFeedNavItem(),$(document).on("click","#nav-notif",c.bind(function(){this.refresh(),$(".nav-notif-enabled").removeClass("nav-notif-enabled"),$("#nav-notif").remove(),this.adjustSize()},this)),this.sortableInit=!1},initializeTagsView:function(e){this.tagsFolderView=o.factory({model:e})},initAllFeedNavItem:function(){d=t.subscriptions.findWhere({title:"digg.com/all"}),d&&(v=s.factory({model:d,el:document.getElementById("dr-nav-all")}),v.render(),v.setUnreadStatusClass(),v.updateUnread(!0),v.listenTo(d,"change:unread",function(){v.updateUnread(!0)}),e.user.get("show_unread_counts")&&(d.on("change:unread",c.bind(this.updateTitle,this)),this.updateTitle()))},initDeeperFeedNavItem:function(){y=t.subscriptions.findWhere({title:"digg.com/deeper"}),y&&(b=a.factory({model:y,el:document.getElementById("dr-nav-digg-deeper")}),b.render(),b.setUnreadStatusClass(),b.updateUnread(!0),b.listenTo(y,"change:unread",function(){b.updateUnread(!0)}))},initPopularFeedNavItem:function(){m=t.subscriptions.findWhere({title:"digg.com/popular"}),m&&(g=s.factory({model:m,el:document.getElementById("dr-nav-popular")}),g.render())},initDiggsFeedNavItem:function(){w=t.subscriptions.findWhere({title:"digg.com/diggs"}),w&&(E=s.factory({model:w,el:document.getElementById("dr-nav-diggs")}),E.render())},initSavedFeedNavItem:function(){S=t.subscriptions.findWhere({title:"digg.com/saved"}),S&&(x=s.factory({model:S,el:document.getElementById("dr-nav-saved")}),x.render())},initKeyboardShortcuts:function(){var e=f.factory(this,"focusNavItem",-1),t=f.factory(this,"focusNavItem",1),n=f.factory(this,"toggleFolder"),r=f.factory(this,"openNavItem");this.keyboardShortcuts.add({key:"n",shiftKey:!0},t),this.keyboardShortcuts.add({key:"p",shiftKey:!0},e),this.keyboardShortcuts.add({key:"j",shiftKey:!0},t),this.keyboardShortcuts.add({key:"k",shiftKey:!0},e),this.keyboardShortcuts.add({key:"x",shiftKey:!0},n),this.keyboardShortcuts.add({key:"o",shiftKey:!0},r)},adjustSize:function(){var e=122;$(".nav-notif-enabled").size()>0&&(e=141),this.viewManager.resize("nav",{height:window.innerHeight-e})},updateTitle:function(){var e,t=d.get("unread");d.get("api_sync")||(t?(e=t>i.constructor.MAX_UNREAD?"∞":t,document.title=["(",e,") Digg Reader"].join("")):document.title="Digg Reader")},render:function(){var t,n;this.viewManager.load("subscription-list",this.rootFolderView),this.tagsFolderView&&this.viewManager.load("tags",this.tagsFolderView),this.adjustSize(),t=$(".view-region-nav"),e.user.get("show_only_unread_feeds")&&!this.rootFolderView.numVisible?t.find(".nav-zero-items-label").size()||c.delay(function(){t.addClass("nav-zero-items").append($("<div />",{html:"No unread items","class":"nav-zero-items-label"}))},300):n=t.removeClass("nav-zero-items").find(".nav-zero-items-label").remove(),this._rendered=!0},postShow:function(){var e;this.sortableInit||(l.init({rootElement:this.rootFolderView.el,dragStartFn:this.dragStartProxy,dropFn:this.dropProxy}),this.sortableInit=!0),e=t.subscriptions.findWhere({label:"digg.com/root"}),this.listenTo(t,"change:unread_changed",this.broadcastUnreadChanged)},broadcastUnreadChanged:function(){var n=t.get("unread_changed"),r=n.new_items,i,s="nav-notif",o=$("#"+s),u;~~r>0&&(this.numNewItems=r),e.user.get("show_unread_counts")?(i=this.numNewItems+" new ",i+=this.numNewItems===1?"item":"items"):i="New items",u=['<div id="nav-notif" class="nav-notif">','<span id="nav-notif-label" data-new-items-count="',this.numNewItems,'">',i,"</span>",'<span class="nav-notif-ico">',"&#10227;","</span>","</div>"].join(""),this.numNewItems&&(o.size()?o.find("#nav-notif-label").attr("data-new-items-count",this.numNewItems).html([i].join(" ")):(o=$(u),$(".col-left").addClass("nav-notif-enabled").prepend(o),o.slideDown(200,c.bind(function(){this.adjustSize()},this))))},focusNavItem:function(e){this.activeFolder.setActive(e)},toggleFolder:function(){this.activeFolder.focusedItem&&this.activeFolder.focusedItem.model.has("expanded")&&this.activeFolder.focusedItem.toggleFolder()},openNavItem:function(){this.activeFolder.focusedItem&&this.activeFolder.focusedItem.loadFeedItems()}});return{factory:function(e){return new k(e)}}}),define("text!bs/templates/reader/feeditem_list.html",[],function(){return'<div class="feeditem--hdr">\n    <% if (showSource) { %>\n        <div class="feeditem-feedtitle">\n            <span class="feeditem-feedtitle-src"><%= content.feed_title || content.domain %></span>\n        </div>\n    <% } %>\n\n    <div class="story-data js--btn-expand">\n        <span class="story-content-mask">\n            <span itemprop="headline" class="feeditem-headline"><%= content.title %></span>\n            <% if (content.short_description.length) { %>\n                <span class="feeditem-description" itemprop="description"><%- content.short_description %></span>\n            <% } %>\n        </span>\n    </div>\n\n    <% if (tweets && tweets.count) { %>\n        <div class="story-sharers js--btn-expand">\n            <% for (var tweet, sharer, s = ((tweets.data.length > 4) ? 3 : tweets.data.length) - 1; s >= 0; s--) { %>\n                <% tweet = tweets.data[s]; %>\n                <% if (tweet) { %>\n                    <% sharer = tweet.user; %>\n                    <% if (sharer) { %>\n                        <figure class="digg-story--deeper__sharer-img-container--list js--digg-deeper__sharer-img-container js--btn-show-digg-story-modal">\n                            <img src="<%= sharer.profile_image_url %>" alt="Image of <%= sharer.name %>" title="<%= sharer.name %>" class="digg-story--deeper__sharer-img--list">\n                            <figcaption class="digg-story--deeper__sharer-tweet js--digg-deeper__sharer-details">\n                                <img class="digg-story--deeper__sharer-img-detail" src="<%= sharer.profile_image_url %>" alt="Image of <%= sharer.name %>">\n                                <div class="digg-story--deeper__sharer-tweet-details-label">From Twitter</div>\n                                <span class="digg-story--deeper__sharer-tweet-name"><%= sharer.name %></span> <span class="digg-story--deeper__sharer-tweet-screenname">@<%= sharer.screen_name %></span> <a class="digg-story--deeper__sharer-tweet-link" href="<%= tweet.url %>" target="_blank"><%= tweet.fuzzyTimeStamp %></a>\n                                <div class="digg-story--deeper__sharer-tweet-text"><%= tweet.text %></div>\n                            </figcaption>\n                        </figure>\n                    <% } %>\n                <% } %>\n            <% } %>\n\n            <% var maxSharersDisplayed = 4; %>\n            <% if (tweets.count > 4 && tweets.data.length > 4) { %>\n                <span class="<%= ~~tweets.count - maxSharersDisplayed > 10 ? \'digg-story--deeper__sharers-circle-list--sml\' : \'digg-story--deeper__sharers-circle-list\' %>  js--btn-show-digg-story-modal">\n                    <span class="digg-story--deeper__sharers-total--list">+<%= ~~tweets.count - maxSharersDisplayed %></span>\n                </span>\n            <% } %>\n        </div>\n    <% } %>\n\n    <div class="story-metadata js--btn-expand">\n        <% if (mode !== "preview") { %>\n            <span class="story-score">\n                <% if (dots) { %> \n                    <% for (var d = 0; d < dots; d++) { %>\n                        &#8226;\n                    <% } %>\n                <% } %>\n            </span>\n        <% } %>\n        <abbr class="published">\n            <time class="feeditem-fuzzytime">\n                <a target="_blank" class="timestamp" href="<%= content.url %>"><%= content.fuzzyTimestamp %></a>\n            </time>\n        </abbr>\n    </div>\n\n    <div class="story-actions-container js--btn-expand">\n        <% if (mode !== "preview") { %>\n            <ul class="story-actions">\n                <% if (BS.features.digg) { %>\n                    <li class="story-action-item story-action story-action-thumb<%= dugg ? " story-action-acted" : "" %>"><a href="#" class="btn-story-action-thumb<%= dugg ? " btn-story-action-thumb-dugg" : "" %>"></a></li>\n                <% } %>\n                <% if (BS.features.readlater) { %>\n                    <li class="story-action-item story-action<%= read_later ? " story-action-acted" : "" %>"><a href="#" class="btn-story-action-readlater<%= read_later ? " btn-story-action-readlater-delete-save" : "" %>"></a></li>\n                <% } %>\n                <li class="story-action-item story-action story-action-share">\n\n                    <div class="tooltip tooltip-grey tooltip-top tooltip-fade tooltip-story-share">\n                        <ul class="plain-list">\n                            <li class="story-share-tweet"><a href="<%= content.tweetlink %>" class="share-story-link">Share to Twitter</a></li>\n                            <li class="story-share-fb"><a href="<%= content.fblink %>" class="share-story-link">Share to Facebook</a></li>\n                            <% if (instapaper) { %>\n                                <% if (pocket) { %>\n                                    <li class="story-share-pocket"><a href="#" class="btn-story-action-pocket">Save to Pocket</a></li>\n                                <% } %>\n                                <% if (readability) { %>\n                                    <li class="story-share-readability"><a href="#" class="btn-story-action-readability">Save to Readability</a></li>\n                                <% } %>\n                            <% } else if (pocket && readability) { %>\n                                <li class="story-share-readability"><a href="#" class="btn-story-action-readability">Save to Readability</a></li>\n                            <% } %>\n                        </ul>\n                    </div>\n\n                    <a href="#" class="btn-story-action-share"></a>\n                </li>\n\n                <% if (instapaper) { %>\n                    <li class="story-action-item story-action"><a href="#" class="btn-story-action-instapaper"></a></li>\n                <% } else if (pocket) { %>\n                    <li class="story-action-item story-action"><a href="#" class="btn-story-action-pocket"></a></li>\n                <% } else if (readability) { %>\n                    <li class="story-action-item story-action"><a href="#" class="btn-story-action-readability"></a></li>\n                <% } %>\n            </ul>\n        <% } %>\n    </div>\n</div>\n'}),define("text!bs/templates/reader/feeditem_expanded.html",[],function(){return'<div class="story-detail-view-container">\n    <div class="story-detail-content">\n\n        <% if (tweets && tweets.count && tweets.data.length) { %>\n            <span class="story-sharers">\n                <% for (var tweet, sharer, s = ((tweets.data.length > 4) ? 3 : tweets.data.length) - 1; s >= 0; s--) { %>\n                    <% tweet = tweets.data[s]; %>\n                    <% if (tweet) { %>\n                        <% sharer = tweet.user; %>\n                        <% if (sharer) { %>\n                                <figure class="digg-story--deeper__sharer-img-container js--digg-deeper__sharer-img-container js--btn-show-digg-story-modal">\n                                    <a href="<%= tweet.url %>" target="_blank" data-screenname="<%= sharer.screen_name %>">\n                                        <img src="<%= sharer.profile_image_url %>" alt="Image of <%= sharer.name %>" title="<%= sharer.name %>" width="30" height="30" class="digg-story--deeper__sharer-img">\n                                    </a>\n                                    <figcaption class="digg-story--deeper__sharer-tweet js--digg-deeper__sharer-details">\n                                        <img class="digg-story--deeper__sharer-img-detail" src="<%= sharer.profile_image_url %>" alt="Image of <%= sharer.name %>">\n                                        <div class="digg-story--deeper__sharer-tweet-details-label">From Twitter</div>\n                                        <span class="digg-story--deeper__sharer-tweet-name"><%= sharer.name %></span> <span class="digg-story--deeper__sharer-tweet-screenname">@<%= sharer.screen_name %></span> <a class="digg-story--deeper__sharer-tweet-link" href="<%= tweet.url %>" target="_blank"><%= tweet.fuzzyTimeStamp %></a>\n                                        <div class="digg-story--deeper__sharer-tweet-text"><%= tweet.text %></div>\n                                    </figcaption>\n                                </figure>\n                            </a>\n                        <% } %>\n                    <% } %>\n                <% } %>\n\n                <% var maxSharersDisplayed = 4; %>\n                <% if (tweets.count > 4 && tweets.data.length > 4) { %>\n                    <span class="<%= ~~tweets.count - maxSharersDisplayed > 10 ? \'digg-story--deeper__sharers-circle--sml\' : \'digg-story--deeper__sharers-circle\' %> js--btn-show-digg-story-modal">\n                        <span class="digg-story--deeper__sharers-total">+<%= ~~tweets.count - maxSharersDisplayed %></span>\n                    </span>\n                <% } %>\n\n            </span>\n        <% } %>\n        \n        <% if (mode !== "preview") { %>\n            <ul class="story-actions">\n                <% if (BS.features.digg) { %>\n                    <li class="story-action-item story-action story-action-thumb<%= dugg ? " story-action-acted" : "" %>"><a href="#" class="btn-story-action-thumb<%= dugg ? " btn-story-action-thumb-dugg" : "" %>"></a></li>\n                <% } %>\n                <% if (BS.features.readlater) { %>\n                    <li class="story-action-item story-action<%= read_later ? " story-action-acted" : "" %>"><a href="#" class="btn-story-action-readlater<%= read_later ? " btn-story-action-readlater-delete-save" : "" %>"></a></li>\n                <% } %>\n                <li class="story-action-item story-action story-action-share">\n\n                    <div class="tooltip tooltip-grey tooltip-top tooltip-fade tooltip-story-share">\n                        <ul class="plain-list">\n                            <li class="story-share-tweet"><a href="<%= content.tweetlink %>" class="share-story-link">Share to Twitter</a></li>\n                            <li class="story-share-fb"><a href="<%= content.fblink %>" class="share-story-link">Share to Facebook</a></li>\n                            <% if (instapaper) { %>\n                                <% if (pocket) { %>\n                                    <li class="story-share-pocket"><a href="#" class="btn-story-action-pocket">Save to Pocket</a></li>\n                                <% } %>\n                                <% if (readability) { %>\n                                    <li class="story-share-readability"><a href="#" class="btn-story-action-readability">Save to Readability</a></li>\n                                <% } %>\n                            <% } else if (pocket && readability) { %>\n                                <li class="story-share-readability"><a href="#" class="btn-story-action-readability">Save to Readability</a></li>\n                            <% } %>\n                        </ul>\n                    </div>\n\n                    <a href="#" class="btn-story-action-share"></a>\n                </li>\n\n                <% if (instapaper) { %>\n                    <li class="story-action-item story-action"><a href="#" class="btn-story-action-instapaper"></a></li>\n                <% } else if (pocket) { %>\n                    <li class="story-action-item story-action"><a href="#" class="btn-story-action-pocket"></a></li>\n                <% } else if (readability) { %>\n                    <li class="story-action-item story-action"><a href="#" class="btn-story-action-readability"></a></li>\n                <% } %>\n            </ul>\n        <% } %>\n\n        <h3 class="story-title">\n            <a href="<%= content.url %>" target="_blank"><%= content.title %></a>\n        </h3>\n        <div class="story-meta">\n            <span class="story-meta-item"><%= content.feed_title || content.domain %>  </span>\n            <% if (content.author && content.author.length) { %>\n                <span class="story-meta-item">by <%= content.author %></span>\n            <% } %>\n            <span class="story-meta-item story-timestamp"><%= content.fuzzyTimestamp %></span>\n        </div>\n        <div class="detail-body">\n            <% var video = false; %>\n            <% if (feed.model.attributes.title && feed.model.attributes.title.indexOf(\'digg.com/deeper\') > -1) { %>\n                <% if (content.media && content.media.videos && content.media.videos.length) { %>\n                    <% video = content.media.videos[0]; %>\n                    <% if (content.domain.indexOf(\'youtube\') > -1 || video.type && video.type === \'text/html\') { %>\n                        <div class="dr-iframe-wrap-wrap"> <div class="dr-iframe-wrap">\n                                <iframe src="<%= video.url %>"></iframe>\n                            </div>\n                        </div>\n\n                    <% } else if (video.type === \'video/mp4\') { %>\n                        <video class="digg-story--deeper__video-embed<%= content.domain.indexOf(\'vine\') > -1 || content.domain.indexOf(\'instagram\') > -1 ? \'-square\' : \'\' %>" src="<%= url %>" controls <%= typeof loop !== \'undefined\' && loop ? \'loop="true"\' : \'\' %>></video>\n                    <% } %>\n                <% } else if (content.media && content.media.images && content.media.images.length) { %>\n                    <p><img src="<%= content.media.images[0].url %>" alt="" class="story__digg-deeper-img--preload js--feeditem--digg-deeper__img"></p>\n                <% } %>\n            <% } %>\n\n            <%= content.body %>\n\n        </div>\n\n        <% if (content.media && content.media.audio && content.media.audio.length) { %>\n            <br/><audio controls>\n                <source src="<%= content.media.audio[0].url %>" type="<%= content.media.audio[0].type %>" />\n            </audio>\n        <% } else if (content.url.indexOf("mp3") > -1) { %>\n            <br/><audio controls>\n                <source src="<%= content.url %>" type="audio/mpeg" />\n            </audio>\n        <% } %>\n\n        <% if ( ! video && content.media && content.media.videos && content.media.videos.length) { %>\n            <br/><video controls>\n                <source src="<%= content.media.videos[0].url %>" type="<%= content.media.videos[0].type %>" />\n            </audio>\n        <% } %>\n\n        <% if ( mode !== "preview" && ! disable_toggleread) { %>\n            <div class="container-toggle-read-state">\n                <span class="btn-toggle-read-state">\n                    <% if (read) { %>\n                        Mark as Unread\n                    <% } else { %>\n                        Mark as Read\n                    <% } %>\n                </span>\n            </div>\n        <% } %>\n\n    </div>\n</div>\n'}),define("text!bs/templates/deeper/story_modal.html",[],function(){return'<div class="js--modal--digg-deeper-story modal--digg-deeper modal fade hide" role="dialog" aria-hidden="true">\n\n    <div class="js--btn-modal-close modal--digg-deeper__close">✖</div>\n\n    <%= storyDetailsHTML %><!-- will be article.digg-story element -->\n\n    <div class="modal--digg-deeper__shared-by">Shared by <%= sharerCount %> people</div>\n\n    <div class="modal--digg-deeper_sharers">\n        <%= sharersHTML %>\n\n        <div class="ico-loading"></div>\n    </div>\n\n</div>\n'}),define("text!bs/templates/deeper/story.html",[],function(){return'<% \n/**\n * Template for a story living in the Digg Deeper stream\n */\n%>\n\n<article \n    class="digg-story--deeper\n        js--digg-story\n        js--story-<%= content.content_id %>\n        <%= dugg ? \'is--dugg\' : \'\' %>\n        <%= read_later ? \'is--saved\' : \'\' %>\n    " \n    data-content-id="<%= content.content_id %>"\n    data-contenturl="<%= content.url %>"\n    data-position="<%= position %>"\n    data-source="digg_deeper"\n>\n    <% if ( ! tweets.hideSharers) { %>\n        <% if (feed === \'fof\') { %>\n            <div class="digg-story--deeper__sharers">\n                <% var sharer, tweet; %>\n                <% for (var s = 0, lenTweets = friends.data.length > maxSharersDisplayed ? maxSharersDisplayed : friends.data.length; s < lenTweets; s++) { %>\n                    <% sharer = friends.data[s]; %>\n                        <figure class="digg-story--deeper__sharer-img-container js--digg-deeper__sharer-img-container">\n                            <a href="/u/<%= sharer.user_id %>/deeper" class="digg-story--deeper__sharer-link">\n                                <img class="digg-story--deeper__sharer-img js--digg-deeper-sharer-img" src="<%= sharer.profile_image_url %>" alt="Image of <%= sharer.name %>">\n                            </a>\n                            <figcaption class="digg-story--deeper__sharer-name">\n                                <!-- <%= sharer.name %> -->\n                            </figcaption>\n                        </figure>\n                        <% if (lenTweets === 1) { %>\n                            <span class="digg-story--deeper__single-sharer-label">Top story for <%= sharer.name %></span>\n                        <% } %>\n                <% } %>\n\n                <% if (tweets.count > maxSharersDisplayed) { %>\n                    <span class="<%= ~~tweets.count - maxSharersDisplayed > 10 ? \'digg-story--deeper__sharers-circle--sml\' : \'digg-story--deeper__sharers-circle\' %>">\n                        <span class="digg-story--deeper__sharers-total">+<%= ~~tweets.count - maxSharersDisplayed %></span>\n                    </span>\n                <% } %>\n            </div>\n        <% } else { %>\n            <div class="digg-story--deeper__sharers">\n                <% var sharer, tweet; %>\n                <% for (var s = 0, lenTweets = tweets.data.length > maxSharersDisplayed ? maxSharersDisplayed : tweets.data.length; s < lenTweets; s++) { %>\n                    <% tweet = tweets.data[s]; %>\n                    <% sharer = tweet.user; %>\n                        <figure class="digg-story--deeper__sharer-img-container js--digg-deeper__sharer-img-container">\n                            <span class="digg-story--deeper__sharer-link js--btn-show-digg-story-modal" data-screenname="<%= sharer.screen_name %>">\n                                <img class="digg-story--deeper__sharer-img" src="<%= sharer.profile_image_url %>" alt="Image of <%= sharer.name %>">\n                            </span>\n                            <% if ( ! tweets.hideTweetDetails) { %>\n                                <figcaption class="digg-story--deeper__sharer-tweet js--digg-deeper__sharer-details">\n                                    <img class="digg-story--deeper__sharer-img-detail" src="<%= sharer.profile_image_url %>" alt="Image of <%= sharer.name %>">\n                                    <div class="digg-story--deeper__sharer-tweet-details-label">From Twitter</div>\n                                    <span class="digg-story--deeper__sharer-tweet-name"><%= sharer.name %></span> <span class="digg-story--deeper__sharer-tweet-screenname">@<%= sharer.screen_name %></span> <a class="digg-story--deeper__sharer-tweet-link" href="<%= tweet.url %>" target="_blank"><%= tweet.fuzzyTimeStamp %></a>\n                                    <div class="digg-story--deeper__sharer-tweet-text"><%= tweet.text %></div>\n                                </figcaption>\n                            <% } %>\n                        </figure>\n                        <% if (lenTweets === 1) { %>\n                            <span class="digg-story--deeper__single-sharer-label"><%= sharer.name %></span>\n                        <% } %>\n                <% } %>\n\n                <% if (tweets.count > maxSharersDisplayed) { %>\n                    <span class="<%= ~~tweets.count - maxSharersDisplayed > 10 ? \'digg-story--deeper__sharers-circle--sml\' : \'digg-story--deeper__sharers-circle\' %>  js--btn-show-digg-story-modal">\n                        <span class="digg-story--deeper__sharers-total">+<%= ~~tweets.count - maxSharersDisplayed %></span>\n                    </span>\n                <% } %>\n            </div>\n        <% } %>\n    <% } %>\n\n    <div class="digg-story--deeper__content">\n        <header class="digg-story--deeper__header">\n            <h2 class="digg-story--deeper__title">\n                <a \n                    class="digg-story--deeper__title-link js--digg-story__link"\n                    href="<%= content.url %>"\n                    target="<%= content.link_target %>"\n                >\n                    <%= content.title %></a>\n            </h2>\n\n            <div class="digg-story--deeper__metadata-container">\n                <% if (showDiversityScore && digg_rank_score_display && digg_rank_score_display !== 0) { %>\n                    <span class="digg-story--deeper__metadata-score">\n                        <%= digg_rank_score_display %> \n                    </span>\n                <% } %>\n\n                <span class="digg-story--deeper__metadata--source">\n                    <a \n                        itemprop="publisher copyrightHolder sourceOrganization provider"\n                        class="digg-story--deeper__metadata--link js--digg-story__link"\n                        href="<%= content.url %>"\n                        target="<%= content.link_target %>"\n                    >\n                        <%= content.domain %>\n                    </a>\n                </span>\n\n                <% if (date !== null) { %>\n                    <abbr class="published digg-story--deeper__metadata--timestamp">\n                       <time><%= formattedDate %></time>\n                    </abbr>\n                <% } %>\n\n                <ul class="digg-story--deeper__actions--metadata-list">\n                    <li class="digg-story--deeper__action--digg js--digg-story-action--digg">\n                        <span class="js--digg-label digg-story--deeper__action-label"><%= dugg ? \'Dugg\' : \'Digg\' %></span>\n                    </li>\n                    <li class="digg-story--deeper__action--save js--digg-story-action--save">\n                        <span class="js--save-label digg-story--deeper__action-label"><%= read_later ? \'Saved\' : \'Save\' %></span>\n                    </li>\n                    <li class="digg-story--deeper__action--share js--digg-story-action--share">\n                        <div class="digg-story--deeper__share-tooltip">\n                            <ul class="digg-story--deeper__share-action-list">\n                                <li class="digg-story--deeper__share-action-item"><a href="<%= tweetlink %>" class="digg-story--deeper__share-link js--digg-story-action--tweet">Share to Twitter</a></li>\n                                <li class="digg-story--deeper__share-action-item"><a href="<%= fblink %>" class="digg-story--deeper__share-link js--digg-story-action--facebook">Share to Facebook</a></li>\n                            </ul>\n                        </div>\n                        \n                        <span class="js--share-label digg-story--deeper__action-label">Share</span>\n                    </li>\n\n                    <% if ( ! tweets.hideSharers && ! tweets.hideTweetDetails) { %>\n                        <li class="digg-story--deeper__action js--btn-show-digg-story-modal">\n                            <span class="digg-story--deeper__action-label">View Tweets</span>\n                        </li>\n                    <% } %>\n\n                </ul>\n            </div>\n        </header>\n\n        <% if (typeof noContentPreview === \'undefined\' || ! noContentPreview) { %>\n            <div class="digg-story--deeper__content-preview">\n                <% if (content.video) { %>\n                    <%= content.video %>\n                <% } else if (content.media.images.length && content.media.images[0].url && content.media.images[0].url.length && content.media.images[0].url.indexOf(\'http\') > -1) { %>\n                    <figure class="digg-story--deeper__img-container"><a class="digg-story--deeper__img-link js--digg-story__link"\n                            href="<%= content.url %>"\n                            target="<%= content.link_target %>"><img src="<%= content.media.images[0].url %>" alt="" class="digg-story--deeper__img js--digg-story__img"></a></figure>\n                <% } %>\n\n                <% if (content.description) { %>\n                    <p class="digg-story--deeper__description">\n                        <%= content.description %>\n                    </p>\n                <% } %>\n            </div>\n        <% } %>\n    </div>\n\n</article>\n'}),define("text!bs/templates/deeper/story_sharer_tweet.html",[],function(){return'<div class="digg-story--deeper__sharer story-embedded-share">\n    <a href="https://twitter.com/<%= sharer.screen_name %>" target="_blank" class="digg-story--deeper__sharer-link" data-screenname="<%= sharer.screen_name %>">\n        <img class="digg-story--deeper__sharer-img" src="<%= sharer.profile_image_url %>" alt="Image of <%= sharer.name %>" title="<%= sharer.name %>">\n    </a>\n    <div class="digg-story--deeper__sharer__body">\n        <div class="digg-story--deeper__sharer__user-info">\n            <a href="https://twitter.com/<%= sharer.screen_name %>" target="_blank" class="digg-story--deeper__sharer__name-link">\n                <%= sharer.name %>\n            </a>\n            <a href="https://twitter.com/<%= sharer.screen_name %>" target="_blank" class="digg-story--deeper__sharer__meta-link">\n                @<%= sharer.screen_name %>\n            </a>\n            <span class="digg-story--deeper__sharer__meta-text">&middot;</span>\n            <a href="<%= tweet.url %>" target="_blank" class="digg-story--deeper__sharer__meta-link">\n                <%= tweet.fuzzyTimeStamp.replace(\' ago\', \'\') %>\n            </a>\n        </div>\n\n        <div class="digg-story--deeper__sharer__text">\n            <%= tweet.text %>\n        </div>\n\n        <ul class="horizontal-list story-embedded-tweet-actions">\n            <li><a class="btn-tweet-reply digg-story--deeper__sharer__tweet-action-link" href="https://twitter.com/intent/tweet?in_reply_to=<%= tweet.id %>">Reply</a></li>\n            <li><a class="btn-tweet-retweet digg-story--deeper__sharer__tweet-action-link" href="https://twitter.com/intent/retweet?tweet_id=<%= tweet.id %>">Retweet</a></li>\n            <li><a class="btn-tweet-favorite digg-story--deeper__sharer__tweet-action-link" href="https://twitter.com/intent/favorite?tweet_id=<%= tweet.id %>">Favorite</a></li>\n        </ul>\n    </div>\n</div>\n'}),function(e,t){typeof define=="function"&&define.amd?define("autolinker",t):typeof exports!="undefined"?module.exports=t():e.Autolinker=t()}(this,function(){var e=function(t){e.Util.assign(this,t)};return e.prototype={constructor:e,urls:!0,email:!0,twitter:!0,newWindow:!0,stripPrefix:!0,className:"",htmlCharacterEntitiesRegex:/(&nbsp;|&#160;|&lt;|&#60;|&gt;|&#62;)/gi,matcherRegex:function(){var e=/(^|[^\w])@(\w{1,15})/,t=/(?:[\-;:&=\+\$,\w\.]+@)/,n=/(?:[A-Za-z]{3,9}:(?:\/\/)?)/,r=/(?:www\.)/,i=/[A-Za-z0-9\.\-]*[A-Za-z0-9\-]/,s=/\.(?:international|construction|contractors|enterprises|photography|productions|foundation|immobilien|industries|management|properties|technology|christmas|community|directory|education|equipment|institute|marketing|solutions|vacations|bargains|boutique|builders|catering|cleaning|clothing|computer|democrat|diamonds|graphics|holdings|lighting|partners|plumbing|supplies|training|ventures|academy|careers|company|cruises|domains|exposed|flights|florist|gallery|guitars|holiday|kitchen|neustar|okinawa|recipes|rentals|reviews|shiksha|singles|support|systems|agency|berlin|camera|center|coffee|condos|dating|estate|events|expert|futbol|kaufen|luxury|maison|monash|museum|nagoya|photos|repair|report|social|supply|tattoo|tienda|travel|viajes|villas|vision|voting|voyage|actor|build|cards|cheap|codes|dance|email|glass|house|mango|ninja|parts|photo|shoes|solar|today|tokyo|tools|watch|works|aero|arpa|asia|best|bike|blue|buzz|camp|club|cool|coop|farm|fish|gift|guru|info|jobs|kiwi|kred|land|limo|link|menu|mobi|moda|name|pics|pink|post|qpon|rich|ruhr|sexy|tips|vote|voto|wang|wien|wiki|zone|bar|bid|biz|cab|cat|ceo|com|edu|gov|int|kim|mil|net|onl|org|pro|pub|red|tel|uno|wed|xxx|xyz|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)\b/,o=/(?:[\-A-Za-z0-9+&@#\/%?=~_()|!:,.;]*[\-A-Za-z0-9+&@#\/%=~_()|])?/;return new RegExp(["(",e.source,")","|","(",t.source,i.source,s.source,")","|","(","(?:","(?:",n.source,i.source,")","|","(?:","(.?//)?",r.source,i.source,")","|","(?:","(.?//)?",i.source,s.source,")",")",o.source,")"].join(""),"gi")}(),invalidProtocolRelMatchRegex:/^[\w]\/\//,charBeforeProtocolRelMatchRegex:/^(.)?\/\//,link:function(t){var n=this,r=this.getHtmlParser(),i=this.htmlCharacterEntitiesRegex,s=0,o=[];return r.parse(t,{processHtmlNode:function(e,t,n){t==="a"&&(n?s=Math.max(s-1,0):s++),o.push(e)},processTextNode:function(t){if(s===0){var r=e.Util.splitAndCapture(t,i);for(var u=0,a=r.length;u<a;u++){var f=r[u],l=n.processTextNode(f);o.push(l)}}else o.push(t)}}),o.join("")},getHtmlParser:function(){var t=this.htmlParser;return t||(t=this.htmlParser=new e.HtmlParser),t},getTagBuilder:function(){var t=this.tagBuilder;return t||(t=this.tagBuilder=new e.AnchorTagBuilder({newWindow:this.newWindow,truncate:this.truncate,className:this.className})),t},processTextNode:function(t){var n=this,r=this.charBeforeProtocolRelMatchRegex;return t.replace(this.matcherRegex,function(t,i,s,o,u,a,f,l){var c=i,h=s,p=o,d=u,v=a,m=f||l,g="",y="",b;if(!n.isValidMatch(c,d,v,m))return t;n.matchHasUnbalancedClosingParen(t)&&(t=t.substr(0,t.length-1),y=")");if(d)b=new e.match.Email({matchedText:t,email:d});else if(c)h&&(g=h,t=t.slice(1)),b=new e.match.Twitter({matchedText:t,twitterHandle:p});else{if(m){var w=m.match(r)[1]||"";w&&(g=w,t=t.slice(1))}b=new e.match.Url({matchedText:t,url:t,protocolRelativeMatch:m,stripPrefix:n.stripPrefix})}var E=n.createMatchReturnVal(b,t);return g+E+y})},isValidMatch:function(e,t,n,r){return e&&!this.twitter||t&&!this.email||n&&!this.urls||n&&n.indexOf(".")===-1||n&&/^[A-Za-z]{3,9}:/.test(n)&&!/:.*?[A-Za-z]/.test(n)||r&&this.invalidProtocolRelMatchRegex.test(r)?!1:!0},matchHasUnbalancedClosingParen:function(e){var t=e.charAt(e.length-1);if(t===")"){var n=e.match(/\(/g),r=e.match(/\)/g),i=n&&n.length||0,s=r&&r.length||0;if(i<s)return!0}return!1},createMatchReturnVal:function(t,n){var r;this.replaceFn&&(r=this.replaceFn.call(this,this,t));if(typeof r=="string")return r;if(r===!1)return n;if(r instanceof e.HtmlTag)return r.toString();var i=this.getTagBuilder(),s=i.build(t);return s.toString()}},e.link=function(t,n){var r=new e(n);return r.link(t)},e.match={},e.Util={abstractMethod:function(){throw"abstract"},assign:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},extend:function(t,n){var r=t.prototype,i=function(){};i.prototype=r;var s;n.hasOwnProperty("constructor")?s=n.constructor:s=function(){r.constructor.apply(this,arguments)};var o=s.prototype=new i;return o.constructor=s,o.superclass=r,delete n.constructor,e.Util.assign(o,n),s},ellipsis:function(e,t,n){return e.length>t&&(n=n==null?"..":n,e=e.substring(0,t-n.length)+n),e},indexOf:function(e,t){if(Array.prototype.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},splitAndCapture:function(e,t){if(!t.global)throw new Error("`splitRegex` must have the 'g' flag set");var n=[],r=0,i;while(i=t.exec(e))n.push(e.substring(r,i.index)),n.push(i[0]),r=i.index+i[0].length;return n.push(e.substring(r)),n}},e.HtmlParser=e.Util.extend(Object,{htmlRegex:function(){var e=/[0-9a-zA-Z:]+/,t=/[^\s\0"'>\/=\x01-\x1F\x7F]+/,n=/(?:".*?"|'.*?'|[^'"=<>`\s]+)/,r=t.source+"(?:\\s*=\\s*"+n.source+")?";return new RegExp(["<(?:!|(/))?","("+e.source+")","(?:","\\s+","(?:",r,"|",n.source+")",")*","\\s*/?",">"].join(""),"g")}(),parse:function(e,t){t=t||{};var n=t.processHtmlNode||function(){},r=t.processTextNode||function(){},i=this.htmlRegex,s,o=0;while((s=i.exec(e))!==null){var u=s[0],a=s[2],f=!!s[1],l=e.substring(o,s.index);l&&r(l),n(u,a,f),o=s.index+u.length}if(o<e.length){var c=e.substring(o);c&&r(c)}}}),e.HtmlTag=e.Util.extend(Object,{whitespaceRegex:/\s+/,constructor:function(t){e.Util.assign(this,t),this.innerHtml=this.innerHtml||this.innerHTML},setTagName:function(e){return this.tagName=e,this},getTagName:function(){return this.tagName||""},setAttr:function(e,t){var n=this.getAttrs();return n[e]=t,this},getAttr:function(e){return this.getAttrs()[e]},setAttrs:function(t){var n=this.getAttrs();return e.Util.assign(n,t),this},getAttrs:function(){return this.attrs||(this.attrs={})},setClass:function(e){return this.setAttr("class",e)},addClass:function(t){var n=this.getClass(),r=this.whitespaceRegex,i=e.Util.indexOf,s=n?n.split(r):[],o=t.split(r),u;while(u=o.shift())i(s,u)===-1&&s.push(u);return this.getAttrs()["class"]=s.join(" "),this},removeClass:function(t){var n=this.getClass(),r=this.whitespaceRegex,i=e.Util.indexOf,s=n?n.split(r):[],o=t.split(r),u;while(s.length&&(u=o.shift())){var a=i(s,u);a!==-1&&s.splice(a,1)}return this.getAttrs()["class"]=s.join(" "),this},getClass:function(){return this.getAttrs()["class"]||""},hasClass:function(e){return(" "+this.getClass()+" ").indexOf(" "+e+" ")!==-1},setInnerHtml:function(e){return this.innerHtml=e,this},getInnerHtml:function(){return this.innerHtml||""},toString:function(){var e=this.getTagName(),t=this.buildAttrsStr();return t=t?" "+t:"",["<",e,t,">",this.getInnerHtml(),"</",e,">"].join("")},buildAttrsStr:function(){if(!this.attrs)return"";var e=this.getAttrs(),t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n+'="'+e[n]+'"');return t.join(" ")}}),e.AnchorTagBuilder=e.Util.extend(Object,{constructor:function(t){e.Util.assign(this,t)},build:function(t){var n=new e.HtmlTag({tagName:"a",attrs:this.createAttrs(t.getType(),t.getAnchorHref()),innerHtml:this.processAnchorText(t.getAnchorText())});return n},createAttrs:function(e,t){var n={href:t},r=this.createCssClass(e);return r&&(n["class"]=r),this.newWindow&&(n.target="_blank"),n},createCssClass:function(e){var t=this.className;return t?t+" "+t+"-"+e:""},processAnchorText:function(e){return e=this.doTruncate(e),e},doTruncate:function(t){return e.Util.ellipsis(t,this.truncate||Number.POSITIVE_INFINITY)}}),e.match.Match=e.Util.extend(Object,{constructor:function(t){e.Util.assign(this,t)},getType:e.Util.abstractMethod,getMatchedText:function(){return this.matchedText},getAnchorHref:e.Util.abstractMethod,getAnchorText:e.Util.abstractMethod}),e.match.Email=e.Util.extend(e.match.Match,{getType:function(){return"email"},getEmail:function(){return this.email},getAnchorHref:function(){return"mailto:"+this.email},getAnchorText:function(){return this.email}}),e.match.Twitter=e.Util.extend(e.match.Match,{getType:function(){return"twitter"},getTwitterHandle:function(){return this.twitterHandle},getAnchorHref:function(){return"https://twitter.com/"+this.twitterHandle},getAnchorText:function(){return"@"+this.twitterHandle}}),e.match.Url=e.Util.extend(e.match.Match,{urlPrefixRegex:/^(https?:\/\/)?(www\.)?/i,protocolRelativeRegex:/^\/\//,checkForProtocolRegex:/^[A-Za-z]{3,9}:/,getType:function(){return"url"},getUrl:function(){var e=this.url;return!this.protocolRelativeMatch&&!this.checkForProtocolRegex.test(e)&&(e=this.url="http://"+e),e},getAnchorHref:function(){var e=this.getUrl();return e.replace(/&amp;/g,"&")},getAnchorText:function(){var e=this.getUrl();return this.protocolRelativeMatch&&(e=this.stripProtocolRelativePrefix(e)),this.stripPrefix&&(e=this.stripUrlPrefix(e)),e=this.removeTrailingSlash(e),e},stripUrlPrefix:function(e){return e.replace(this.urlPrefixRegex,"")},stripProtocolRelativePrefix:function(e){return e.replace(this.protocolRelativeRegex,"")},removeTrailingSlash:function(e){return e.charAt(e.length-1)==="/"&&(e=e.slice(0,-1)),e}}),e}),define("bs/widgets/digg_deeper_story_modal",["bs/core","bs/util/xhr","bs/util/format","bs/util/helpers","text!bs/templates/deeper/story_modal.html","text!bs/templates/deeper/story.html","text!bs/templates/deeper/story_sharer_tweet.html","autolinker","lodash","bootstrap_modal","jquery"],function(e,t,n,r,i,s,o,u,a,f,l){function y(e,t){var n={content_id:e,full_text:!0};m.request({data:n,success:function(e){if(!e||!e.data||!e.data.feed||!e.data.feed.length)return console.error("unexpected response format:",e),t("failed");t(null,e.data.feed[0])},error:function(e,n,r){console.error("failed to get full alert:",n,r),t(r)}})}function b(e,t){c.removeClass("is--loading");if(e)return;var n=t.tweets.data.splice(10);n=w(n),l(E(n)).appendTo(l(".modal--digg-deeper_sharers"))}function w(e){return a.each(e,function(e){e.url=r.getTweetURL({twitter_screen_name:e.user.screen_name,tweet_id:e.id}),e.fuzzyTimeStamp=n.secondsToFuzzyTime(e.date),e.text=u.link(e.text)}),e}function E(e){return a.map(e,function(e){return v({tweet:e,sharer:e.user})}).join("\n")}function S(t,i,s){return t.position=i,t.formattedDate=n.secondsToFuzzyTime(t.date),t.content.title||(t.content.title=t.tweets.data[0].text),t.content.link_target="_blank",t.fblink=r.getFacebookStoryShareLink({app_id:e.config.FB_APP_ID,url:t.content.url}),t.tweetlink=r.getTweetStoryLink({url:t.content.url,title:t.content.title||t.tweets[0].text}),!t.content.media.videos.length&&t.content.media.images.length&&(t.content.description=n.truncate(t.content.description,g,!0)),t.tweets.hideSharers=!0,t.noContentPreview=!s,d(t)}var c,h={},p=a.template(i),d=a.template(s),v=a.template(o),m=new t.dataProvider({url:"/api/news/alert.json",cache:!1}),g=135,x={saveStoryDetails:function(e){a.each(e,function(e){e.tweets.data=w(e.tweets.data),h[e.story_id]=e})},show:function(e,t){var n=l(e.target).closest(".digg-story-el, .digg-story--deeper, article.expanded, article.feeditem-list"),r=n.data("content-id"),i=n.data("position"),s=h[r];if(!s)return;var o=p({storyDetailsHTML:S(s,i,t),sharersHTML:E(s.tweets.data),sharerCount:s.tweets.count});return c=l(o).appendTo("body").modal({keyboard:!0,show:!0}),l(document).on("click touchend",x.hide),s.tweets.count>10&&(c.addClass("is--loading"),y(r,b)),!1},hide:function(e){var t=l(e.target).hasClass("js--btn-modal-close"),n=l(e.target).closest(".js--modal--digg-deeper-story").length>0;if(t||!n)l(".js--modal--digg-deeper-story").modal("hide").remove(),l(document).off("click touchend",x.hide)}};return x}),define("bs/views/feeditem",["bs/core","bs/views/base","bs/util/command","bs/util/format","bs/util/helpers","text!bs/templates/reader/feeditem_list.html","text!bs/templates/reader/feeditem_expanded.html","lodash","bs/widgets/digg_deeper_story_modal"],function(e,t,n,r,i,s,o,u,a){function N(e,t){return e&&e.target||this.el.getElementsByClassName(t)[0]}var f=" ",l="feeditem-list",c="feed-item-focused",h="story-action-acted",p="btn-story-action-thumb",d="btn-story-action-thumb-dugg",v="btn-story-action-readlater",m="btn-story-action-readlater-delete-save",g="btn-story-action-instapaper",y="btn-story-action-instapaper-saved",b="btn-story-action-pocket",w="btn-story-action-pocket-saved",E="btn-story-action-readability",S="btn-story-action-readability-saved",x="list",T="expanded",C=t.constructor.extend({tagName:"article",listItemTemplate:u.template(s),expandedItemTemplate:u.template(o),events:{"click .feeditem-feedtitle-src":"loadSourceFeed","click .feeditem-feedtitle":"triggerItemClick","click .js--btn-expand":"triggerItemClick","click .timestamp":"timestampClick","click .btn-toggle-read-state":"toggleReadState","click .btn-story-action-thumb":"digg","click .btn-story-action-readlater":"save","click .btn-story-action-instapaper":"addToInstapaper","click .btn-story-action-pocket":"addToPocket","click .btn-story-action-readability":"addToReadability","click .story-action-share":"showShareToolTip","click .share-story-link":"shareStory","click .js--btn-show-digg-story-modal":"showDeeperModal","mouseenter .more-shares":"showMoreSharersTooltip","mouseleave .more-shares":"hideMoreSharersTooltip"},positionTooltip:function(e){var t=$(e.currentTarget),n=t.find(".js--digg-deeper__sharer-details"),r=t.position();n.css({top:r.top})},loadSourceFeed:function(){var t=this.model.get("content").feed_url;e.pubsub.fire("feed_selected",{feed_url:t})},initialize:function(e){e.disable_keyboard_shortcuts=!0,this.constructor.__super__.initialize.call(this,e),this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"change:read",this.setReadStatusClass),this.viewType=e.viewType||x,this.feed=e.feed,this.parentView=e.parentView,this.isClearedOut=!1,this.innerClientRect={}},render:function(t){var n,r,i=l,s=this.model.get("content"),o,a=500;typeof t=="string"&&(this.viewType=t),s.fuzzyTimestamp=this.model.getFuzzyTimestamp(),this.model.set({content:s},{silent:!0}),n=this.model.toJSON(),n.instapaper=!u.isEmpty(e.user.get("instapaper")),n.pocket=!u.isEmpty(e.user.get("pocket")),n.readability=!u.isEmpty(e.user.get("readability")),n.mode=this.parentView.mode,n.feed=this.feed;if(this.viewType===x){if(this.el.className.indexOf(i)<0){this.el.className=i,this.model.get("showSource")&&(this.el.className+=" item-listview-combo");if(n.instapaper||n.pocket||n.readability)this.el.className+=" item-has-readlater-service"}else this.el.className=this.el.className.replace(f+T,"");this.el.innerHTML=this.listItemTemplate(n)}else this.viewType===T&&(this.parentView.viewType===x&&this.parentView.mode!=="preview"&&this.markAsRead(!1,!0),this.el.className+=f+T,r=this.el.getElementsByClassName("story-detail-view")[0],r||(r=document.createElement("div"),r.className="story-detail-view",this.el.appendChild(r)),r.innerHTML=this.expandedItemTemplate(n));return this.setReadStatusClass(),this.$el.data("content-id",s.content_id),o=this.$el.find(".js--feeditem--digg-deeper__img"),o.size()&&(o[0].width===0?o.on("load",function(){o[0].width<a?o.remove():o.removeClass("story__digg-deeper-img--preload").addClass("story__digg-deeper-img")}).on("error",function(){o.remove()}):o[0].width<a?o.remove():o.removeClass("story__digg-deeper-img--preload").addClass("story__digg-deeper-img")),this._rendered=!0,this.el},getExpandedOffset:function(e){return{top:e,bottom:e+this.$el.height()}},getInnerClientRect:function(){this.el.firstChild.className==="story-detail-view"&&u.isEmpty(this.innerClientRect)&&(this.innerClientRect=this.el.firstChild.getBoundingClientRect())},setReadStatusClass:function(){var e="feeditem-read";this.model.get("read")?this.el.className.indexOf(e)<0&&(this.el.className+=f+e):this.el.className=this.el.className.replace(f+e,""),this.viewType.indexOf("expanded")>-1&&(this.model.get("read")?this.$el.find(".btn-toggle-read-state").html("Mark as Unread"):this.$el.find(".btn-toggle-read-state").html("Mark as Read"));return},markAsRead:function(e,t){this.model.markAsRead(e,t)},toggleReadState:function(){var e;if(this.model.get("disable_toggleread"))return;e=this.model.feed.get("view").indexOf("expanded")>-1,this.model.toggleReadState(!1,!0),this.model.get("read")?(this.$el.find(".btn-toggle-read-state").html("Mark as Unread"),this.model.set({keep_unread:!1},{silent:!0})):(this.$el.find(".btn-toggle-read-state").html("Mark as Read"),e&&this.model.set({keep_unread:!0},{silent:!0})),this.setReadStatusClass()},digg:function(e){var t=N.call(this,e,p);return t.className.indexOf(d)>-1?this.deleteDigg(e):(t.className+=f+d,t.parentNode.className+=f+h,this.model.submitDigg(),!1)},deleteDigg:function(e){var t=N.call(this,e,p);return t.className=t.className.replace(f+d,""),t.parentNode.className=t.parentNode.className.replace(f+h,""),this.model.deleteDigg(),!1},save:function(e){var t=N.call(this,e,v);return t.className.indexOf(m)>-1?this.deleteSave(e):(t.className+=f+m,t.parentNode.className+=f+h,this.model.saveStory(),!1)},deleteSave:function(e){var t=N.call(this,e,v);return t.className=t.className.replace(f+m,""),t.parentNode.className=t.parentNode.className.replace(f+h,""),this.model.deleteSave(),!1},addToInstapaper:function(e){var t=N.call(this,e,g);if(t.className.indexOf(y)>-1)return;return t.className+=f+y,t.parentNode.className+=f+h,this.model.addToInstapaper(),!1},addToPocket:function(e){var t=N.call(this,e,b);if(t.className.indexOf(w)>-1)return;return t.className+=f+w,t.parentNode.className+=f+h,this.model.addToPocket(),!1},addToReadability:function(e){var t=N.call(this,e,E);if(t.className.indexOf(S)>-1)return;return t.className+=f+S,t.parentNode.className+=f+h,this.model.addToReadability(),!1},setFocus:function(e){this.el.className.indexOf(c)<0&&(this.el.className+=f+c,e&&this.scrollIntoView(!1)),this.getInnerClientRect()},hideShareToolTip:function(){$(".story-action-share").removeClass("show"),$(document).off("click",this.hideShareToolTipProxy),this.$el.off("mouseleave",this.hideShareToolTipProxy)},showShareToolTip:function(e){return this.hideShareToolTipProxy=u.bind(this.hideShareToolTip,this),this.$el.find(".story-action-share").eq(0).addClass("show"),$(document).on("click",this.hideShareToolTipProxy),this.$el.on("mouseleave",this.hideShareToolTipProxy),!1},shareStory:function(t){var n,r;return t.preventDefault(),n=$(t.target),r=n.html().indexOf("Tweet")>-1?"twitter":"facebook",e.pubsub.fire("story_share",r,n),i.popWin(t.target.href,null,{width:530,height:350}),!1},removeFocus:function(){this.el.className=this.el.className.replace(f+c,"")},viewOriginal:function(){window.open(this.model.get("content").url,"_blank")},mailItem:function(){var e=this.model.get("content"),t="%0A%0A",n=["subject="+encodeURIComponent(e.title),"body="+e.title+" - "+(e.feed_title||e.domain)+t+encodeURIComponent(e.url)+t+"via Digg Reader"];return window.location.href="mailto:?"+n.join("&"),!1},triggerItemClick:function(){this.feed.handleItemClick(this)},timestampClick:function(e){this.parentView.mode!=="preview"&&(this.markAsRead(!1,!0),this.setReadStatusClass()),e.stopPropagation()},toggleViewType:function(e){if(this.viewType===x){this.render(T),e&&this.scrollIntoView(!0);return}return this.render(x)},scrollIntoView:function(e){this.$el.closest(".scrollable").get(0).scrollTop=this.el.offsetTop-56},collapse:function(){return this.render(x)},remove:function(){this.feed=null,this.constructor.__super__.remove.call(this)},clearOut:function(){var e=document.createElement("div");(u.isEmpty(this.innerClientRect)||this.innerClientRect.height<200)&&this.getInnerClientRect(),e.style.cssText="height:"+this.innerClientRect.height+"px;",this.el.replaceChild(e,this.el.firstChild),this.undelegateEvents(),this.isClearedOut=!0},reloadContent:function(){var t=document.createElement("div"),n=this.model.toJSON();n.instapaper=!u.isEmpty(e.user.get("instapaper")),n.pocket=!u.isEmpty(e.user.get("pocket")),n.readability=!u.isEmpty(e.user.get("readability")),n.mode=this.parentView.mode,t.className="story-detail-view",t.innerHTML=this.expandedItemTemplate(n),t.style.cssText="height:"+this.innerClientRect.height+"px;",this.el.replaceChild(t,this.el.firstChild),this.delegateEvents(),this.isClearedOut=!1},showDeeperModal:function(e){var t=this.model.toJSON();e.stopPropagation(),e.preventDefault(),t.showDiversityScore=!1,a.saveStoryDetails([t]),a.show(e,!0)}});return{factory:function(e){return new C(e)},constructor:C}}),define("bs/util/scrollmonitor",["bs/core","jquery","lodash"],function(e,t,n){function i(e,r){var i=20,s=1e3/i,o=n.bind(this.monitor,this);typeof e=="string"&&(e=document.getElementById(e)),r||(r={}),this._el=e,this._lastScrollTop=0,this.direction=null,this.name=r.name||"scrollMonitor",r.pubsub&&(this.pubsub=r.pubsub),this.updateScrollHeight(),this._monitor=n.throttle(o,s),t(this._el).on("scroll",this._monitor)}var r=function(){var r=20;this.$win=t(window),this.$body=t(document.body),this.winHeight=this.$win.height(),this.scrollHeight=this.$body.height(),this.$win.scroll(n.throttle(n.bind(this.monitor,this),1e3/r))};return r.prototype={updateScrollHeight:function(){this.scrollHeight=this.$body.height()},updateWinHeight:function(){this.winHeight=this.$win.height()},monitor:function(){var t=30;e.pubsub.fire(e.pubsub.channels.scrolltop,this.$win.scrollTop()),this.winHeight+document.body.scrollTop+t>=this.scrollHeight&&e.pubsub.fire("window_scroll_monitor:bottom")}},e.scrollMonitor=new r,n.bindAll(e.scrollMonitor),i.prototype={data:function(){var e;return this.direction=this._el.scrollTop-this._lastScrollTop<0?"up":"down",e={el:this._el,scrollTop:this._el.scrollTop,scrollHeight:this._el.scrollHeight,direction:this.direction},e.scrollBottom=e.scrollTop+e.scrollHeight,e},isBottom:function(){var e=100;return this._el.offsetHeight+this._el.scrollTop+e>=this._el.scrollHeight},checkScrollDepth:function(e){return this._el.offsetHeight+this._el.scrollTop>=this._el.scrollHeight*e},updateScrollHeight:function(){this.scrollHeight=this._el.scrollHeight},monitor:function(){this.pubsub&&(this.pubsub.fire(this.name+":scroll",this.data()),this.checkScrollDepth(.5)&&this.pubsub.fire(this.name+":scroll:50%",this.data()),this.isBottom()&&this.pubsub.fire(this.name+":scroll:bottom",this.data())),this._lastScrollTop=this._el.scrollTop},destroy:function(){t(this._el).off("scroll"),this._el=null}},{factory:function(e,t){return new i(e,t)}}}),define("bs/util/storyactions",["require","bs/core","bs/util/cookies","bs/util/xhr","bs/util/format","bs/util/helpers","lodash"],function(e,t,n,r,i,s,o){function l(e){var t=(new Date).valueOf()+31536e6;$.extend(a,e),n.set({name:u,value:$.param(a),expires:new Date(t)})}function c(e){var n="http://api.digg.com/api/v1/redirect",r=$(this).closest(".digg-story-el"),i=r.data("contentId"),s=t.user.get("user_id"),o={url:this.href};return e&&e.preventDefault(),i&&(o.content_id=i),s&&(o.user_id=s),navigator.mozApps&&window.locationbar.visible===!1&&(o.platform=1005,window.open([n,$.param(o)].join("?"))),f==="mobile"?(o.platform=1005,window.location.href=[n,$.param(o)].join("?")):this.target==="_blank"?window.open([n,$.param(o)].join("?")):window.location.href=this.href,!1}function h(e){$("#topnav-onboarding-dailydigg-signup").hide(),$("#dugg-success-container").hide(),$("#saved-success-container").hide(),$(document).off("click",h),$(".story-container").off("mouseleave",h),$(".story-row").off("mouseleave",h)}function p(e,t,n){var r=$(".btn-story-action-"+t+"-"+e),i=["webkitTransitionEnd","mozTransitionEnd","oTransitionEnd","msTransitionEnd","transitionend"].join(" "),s;Modernizr.csstransitions?(!n&&r.hasClass("btn-story-acted")&&r.parent().removeClass("btn-container-acted"),s=o.bind(function(e){n?r.addClass("btn-rotated"):r.removeClass("btn-rotated"),r.hasClass("btn-rotated")&&r.parent().addClass("btn-container-acted"),r.off(i,s)},this),r.on(i,s),n?r.addClass("btn-story-acted"):r.removeClass("btn-story-acted"),t!=="digg"&&(r.hasClass("btn-story-acted")?r.parent().css("visibility","visible"):r.parent().css("visibility","hidden"))):!n&&r.hasClass("btn-story-acted")?(r.parent().removeClass("btn-container-acted"),r.find(".btn-story-action-off").animate({top:"0px"},300),r.find(".btn-story-action-on").animate({top:"31px"},300,function(){r.removeClass("btn-story-acted")})):n&&!r.hasClass("btn-story-acted")&&(r.find(".btn-story-action-off").animate({top:"-31px"},300),r.find(".btn-story-action-on").animate({top:"0px"},300,function(){r.addClass("btn-story-acted"),r.parent().addClass("btn-container-acted")}))}function d(e){var t={contentID:e.data("contentId"),diggUrlID:e.data("urlId"),category:e.data("category"),diggScore:e.data("diggScore"),tweets:e.data("tweets"),fbShares:e.data("fbShares"),diggs:e.data("diggs")};return t.diggScore=o.isString(t.diggScore)?parseInt(t.diggScore.replace(/,/g,""),10):t.diggScore,t.tweets=o.isString(t.tweets)?parseInt(t.tweets.replace(/,/g,""),10):t.tweets,t.fbShares=o.isString(t.fbShares)?parseInt(t.fbShares.replace(/,/g,""),10):t.fbShares,t.diggs=o.isString(t.diggs)?parseInt(t.diggs.replace(/,/g,""),10):t.diggs,t}function v(e,t){e.data(t)}function m(e,n,r){var i=r.data,s,o=(new Date).valueOf()/1e3-~~t.user.get("date_signup")<900,u;v(e,{diggScore:i.digg_score,diggs:i.diggs,tweets:i.tweets,fbShares:i.fb_shares}),t.pubsub.fire("digg_success",e,i,n);if(!a.dugg||o)l({dugg:1}),s=$("#dugg-success-container").appendTo(e.closest(".btn-story-action-container")).fadeIn(100),t.user.get("facebook")?(s.find(".dugg-success-fb-message").show(),s.find(".dugg-success-twitter-message").hide()):(s.find(".dugg-success-fb-message").hide(),s.find(".dugg-success-twitter-message").show()),o&&!t.user.get("email_subscriber")?($("#onboarding-dailydigg-signup").data("sourceAction","Digg").show().appendTo(s),u=t.user.get("email"),u&&($(".dailydigg-email").val(u),$("#onboarding-dailydigg-signup").find(".btn-dailydigg-no").css("visibility","visible")),s.addClass("dailydigg-signup-active")):($(document).on("click",h),e.parents(".story-container").on("mouseleave",h),e.parents(".story-row").on("mouseleave",h)),$(".tooltip").on("click",".btn-close",h)}function g(e){var t="/api/digg/submit.json",n=$(this),s=n.closest(".digg-story-el"),u=d(s),a=u.contentID,f=$(".btn-story-action-on .story-score-"+a),l=u.diggScore,c=$(".story-score-thumb-"+a),h=u.diggs,g,b,w=l+1,E=h+1;return n.parent().hasClass("btn-story-acted")?(y.call(this),!1):(p(a,"digg",!0),f.size()&&(f.html(i.intWithCommas(w,!0)),c.html(i.intWithCommas(E)),v(s,{diggScore:w,diggs:E})),b={content_id:a},u.category&&(b.category=u.category),u.diggUrlID&&(b.digg_url_id=u.diggUrlID),g=new r.dataProvider({url:t,type:"POST",data:b,success:o.bind(m,this,n,a)}),g.request(),!1)}function y(e){var s="/api/digg/delete.json",o=$(this),u=o.closest(".digg-story-el"),a=d(u),f=a.contentID,l=$(".btn-story-action-off .story-score-"+f),c=a.diggScore,h=$(".story-score-thumb-"+f),m=a.diggs,g=0,y=0,b;return g=c-1<0?0:c-1,y=m-1<0?0:m-1,l.size()&&(l.html(i.intWithCommas(g,!0)),h.html(i.intWithCommas(y)),v(u,{diggScore:g,diggs:y})),p(f,"digg",!1),b=new r.dataProvider({url:s,type:"POST",data:{content_id:f,_xsrf:n.get("_xsrf")},success:function(e){var n=e.data;v(o,{diggScore:n.digg_score,diggs:n.diggs,tweets:n.tweets,fbShares:n.fb_shares}),t.pubsub.fire("digg_delete_success",o,n,f)}}),b.request(),!1}function b(e,n,r){var i,s,o=(new Date).valueOf()/1e3-~~t.user.get("date_signup")<900,u;if(e.hasClass("btn-deleted-undo")){i=e.parents(".story-row"),i.removeClass("story-row-deleted"),i.find(".btn-score-action-readlater-delete").removeClass("btn-score-action-readlater-delete"),i.find(".timestamp, .story-actions-cell").show(),i.find(".deleted-label, .deleted-undo").remove();return}t.pubsub.fire("add_reading_list_success",e);if(!a.saved||o)l({saved:1}),s=$("#saved-success-container").appendTo("#saved-stories-container").fadeIn(100),o&&!t.user.get("email_subscriber")?($("#onboarding-dailydigg-signup").data("sourceAction","Save").appendTo(s).show(),u=t.user.get("email"),u&&($(".dailydigg-email").val(u),$("#onboarding-dailydigg-signup").find(".btn-dailydigg-no").css("visibility","visible"))):$(document).on("click",h)}function w(e,n,r){var i;t.pubsub.fire("delete_reading_list_success",e);if(e.closest(".saved-story-row").size()>0)return i=e.closest(".story-row"),i.addClass("story-row-deleted"),i.find(".timestamp, .story-actions-cell").hide(),i.append('<td class="deleted-label">deleted</td>'),i.append('<td class="deleted-undo"><a href="#undo" class="btn-deleted-undo" data-content-id="'+n+'">Undo</a></td>'),!1}function E(e){var t=$(this),n=t.data("contentId"),i,s,u="/api/story/readlater/add.json",a;if(t.hasClass("btn-story-acted"))return t.hasClass("btn-story-action-delete-save")||S.call(this),!1;if(!n){var f=t.closest(".digg-story-el");n=f.data("contentId"),i=f.data("urlId"),s=f.data("category")}t.removeClass("btn-score-action-readlater-delete"),p(n,"save",!0);var l={content_id:n};return s&&(l.category=s),i&&(l.digg_url_id=i),a=new r.dataProvider({url:u,type:"POST",data:l,success:o.bind(b,this,t,n)}),a.request(),!1}function S(e){var i=$(this),s=i.data("contentId"),u="/api/story/readlater/delete.json",a;return s||(s=i.closest(".digg-story-el").data("contentId")),t.pubsub.fire("delete_reading_list_request",i),i.hasClass("btn-story-action-delete-save")||p(s,"save",!1),a=new r.dataProvider({url:u,type:"POST",data:{content_id:s,_xsrf:n.get("_xsrf")},success:o.bind(w,this,i,s)}),a.request(),!1}function x(e){o.each(e,function(e,t){var n,r;T(t,e),e.dugg&&(n=$(".story-"+t).find(".btn-story-action-digg"),p(t,"digg",!0)),e.read_later&&(r=$(".story-"+t).find(".btn-story-action-save"),p(t,"save",!0))})}function T(e,t){var n=$(".story-"+e),r=$(".story-score-"+e),s,o,u;v(n,{diggScore:t.digg_score,diggs:t.diggs,tweets:t.tweets,fbShares:t.fb_shares});if(!r||!r.size())return;s=$(".story-score-thumb-"+e),o=$(".story-score-tweets-"+e),u=$(".story-score-fb_shares-"+e),r.html(i.intWithCommas(t.digg_score,!0)),s.html(i.intWithCommas(t.diggs)),o.html(i.intWithCommas(t.tweets)),u.html(i.intWithCommas(t.fb_shares))}function N(e){var n,r;return e.preventDefault(),n=$(this),r=n.html().indexOf("Tweet")>-1?"twitter":"facebook",t.pubsub.fire("story_share",r,n),r==="twitter"?!1:(s.popWin(this.href,null,{width:530,height:350}),!1)}function C(e){var t=$(this),n=t.data("shareContentId"),r=t.data("shareId"),i="share-details-"+n+"-"+r;$(".share-details-"+n).hide(),$("#"+i).show(),$(".story-trending-share-img-container-"+n).removeClass("current"),t.parent().addClass("current")}function k(){$(".btn-story-action-container-share").removeClass("show"),$(document).off("click",k),$(".story-container").off("mouseleave",k),$(".story-row").off("mouseleave",k)}function L(e){var t=$(this);return $("#facebook-auth-container").hide(),t.closest(".btn-story-action-container-share").addClass("show"),$(document).on("click",k),t.closest(".story-container").on("mouseleave",k),t.closest(".story-row").on("mouseleave",k),t.closest(".story-community").on("mouseleave",k),!1}function A(e){return e.stopPropagation(),e.preventDefault(),$(this).closest(".btn-story-action-container-digg").addClass("show-score-details"),t.pubsub.fire("story_score_details_displayed"),!1}function O(e){$(this).closest(".btn-story-action-container-digg").removeClass("show-score-details")}var u="saflags",a=n.get(u),f=n.get("preferred_view")||"desktop";return a=a?s.deparam(a):{},t.pubsub.on("story_actions","auth_tooltip_displayed",k),t.pubsub.on("story_actions","hide_success_tooltips",h),{submitDigg:g,deleteDigg:y,addReadingList:E,deleteReadingList:S,renderStoryScores:x,redirectStoryLink:c,shareStory:N,showShareDetails:C,showShareToolTip:L,showScoreDetails:A,hideScoreDetails:O,hideSuccessToolTips:h}}),define("text!bs/templates/reader/feed_stream.html",[],function(){return'<header class="feed-stream-header">\n    <h2 id="feed-title" class="feed-title"><%= title %></h2>\n    <% if (editable) { %>\n        <div class="stream-edit">Edit</div>\n    <% } %>\n    <!-- output i18n(\'Edit\') -->\n</header>\n'}),define("text!bs/templates/reader/feed_stream_preview.html",[],function(){return'<header class="feed-preview discovery-browse-header">\n    <h2 class="discovery-browse-hed">\n        <span class="discovery-browse-breadcrumb">\n            <% if (display_breadcrumb) { %>\n                    <% if (preview_mode === "search") { %>\n                        <span class="discovery-browse-categories" id="discovery-search">Search</span>\n                    <% } else { %>\n                        <span class="discovery-browse-categories" id="discovery-browse-categories">Browse</span>\n                    <% } %>\n            <% } %>\n            <% if ( !! folder) { %>\n                <span class="discovery-browse-categories" id="discovery-browse-category"><%= folder %></span>\n            <% } %>\n            </span>\n        <%= title %>\n    </h2>\n\n    <div class="discovery-category-controls">\n        <% if (subscribed) { %>\n            <button class="btn-action btn-add-feed" disabled>✔</button>\n        <% } else { %>\n            <button class="btn-action btn-add-feed">Add</button>\n        <% } %>\n    </div>\n    <!-- output i18n(\'Edit\') -->\n</header>\n'}),define("text!bs/templates/reader/feed_zero_diggs.html",[],function(){return'<div class="zero-items-message">\n    <h2 class="zero-items-message-hed">You haven’t dugg anything yet.</h2>\n    <p>Click the <span class="digg-icon">DIGG ICON</span> to digg something.</p>\n</div>'}),define("text!bs/templates/reader/feed_zero_items.html",[],function(){return'<div class="zero-items-message">\n    <h2 class="zero-items-message-hed">0 items</h2>\n    <p>We couldn\'t find anything for <span class="feed-url">&ldquo;<%= alt_title || title %>&rdquo;</span></p>\n    <button class="btn-action" id="btn-zero-feeds-try-again">Try Again</button>\n</div>\n'}),define("text!bs/templates/reader/feed_zero_popular.html",[],function(){return'<div class="zero-items-message">\n    <h2 class="zero-items-message-hed">0 items</h2>\n    <button class="btn-action" id="btn-zero-feeds-try-again">Try Again</button>\n</div>'}),define("text!bs/templates/reader/feed_zero_saved.html",[],function(){return'<div class="zero-items-message">\n    <h2 class="zero-items-message-hed">You haven’t saved anything yet.</h2>\n    <p>Click the <span class="save-icon">SAVE ICON</span> to save an item here.</p>\n</div>\n'}),define("bs/reader/view/feeditems/feeditems_base",["bs/core","bs/views/base","bs/views/feeditem","bs/util/cookies","bs/util/helpers","bs/util/command","bs/util/scrollmonitor","bs/util/storyactions","text!bs/templates/reader/feed_stream.html","text!bs/templates/reader/feed_stream_preview.html","text!bs/templates/reader/feed_zero_diggs.html","text!bs/templates/reader/feed_zero_items.html","text!bs/templates/reader/feed_zero_popular.html","text!bs/templates/reader/feed_zero_saved.html","jquery","lodash"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){function m(e,t){var n=e[0].getBoundingClientRect(),r=e.parents(".scrollable"),i;t=t||0,i=r[0]&&r[0].getBoundingClientRect();if(!i)return;return n.top>=i.bottom?"bottom":n.bottom-t<=i.top?"top":!0}function g(e,t){var n=e[0].getBoundingClientRect(),r=e.parents(".scrollable"),i,s;t=t||0,i=r[0]&&r[0].getBoundingClientRect();if(!i)return;return n.height>=i.height?s=n.top+i.height/2:s=n.bottom,n.top>=i.top&&s<=i.bottom}var y=t.constructor.extend({streamTemplate:v.template(a),streamPreviewTemplate:v.template(f),zeroDiggsTemplate:v.template(l),zeroItemsTemplate:v.template(c),zeroPopularTemplate:v.template(h),zeroSavedTemplate:v.template(p),events:{"click .stream-edit":"fireStreamEdit","click #btn-zero-feeds-try-again":"refresh","click #btn-view-all-items":"switchToShowAll","click #discovery-browse-categories":"loadAllBrowseCategories","click #discovery-browse-category":"loadBrowseCategory","click #discovery-search":"loadSearchResults","click .btn-add-feed":"addSubscription"},className:function(){var e=this.model.type==="folder"?"combo-view":"";return e},setClass:function(){var e=[this.className(),this.viewType],t=this.$el.find(".zero-items").size(),n=this.model.get("label")||this.model.get("title");t&&e.push("feeditems-zero-items"),n.indexOf("digg.com/deeper")>-1&&e.push("feed-digg-deeper"),this.el.className=e.join(" "),this.mode==="preview"&&this.$el.addClass("discovery-browse discovery-browse-category-view")},initialize:function(e){y.__super__.initialize.call(this,e),this.focusedIndex=null,this.focusedItem=null,this.expandedItemIndex=null,this._scrollFocusIndex=null,this.feedItems=[],this.unreadFeedItems=[],this.shiftSpaceToPreviousItem=!1,this.hasViewAllItems=!1,this.hasScrolled=!1,this.viewType=this.model.get("view")||"list",this.showType=this.model.get("show")||"all",this.mode=e.mode||this.model.get("mode")||"subscribed",this.pageSize=this.viewType==="list"?30:10,this.mode==="preview"&&(this.preview_mode=e.preview_mode||"discovery"),e.parentFolder&&(this.parentFolder=e.parentFolder),this.mode==="preview"?(this.$el.addClass("discovery-browse discovery-browse-category-view"),this.renderPreviewHeader()):(this.renderHeader(),this.markAsReadProxy=v.bind(this.markAsRead,this),this.enableMarkAsRead()),this.listenTo(this.model,"change:title",this.render),this.listenTo(this.model.items,"reset",this.render),this.getNextPageProxy=v.bind(this.getNextPage,this),this.scrollWatchProxy=v.bind(this.scrollWatch,this),this.isFeedItemInFocusProxy=v.bind(this.isFeedItemInFocus,this),this.isFeedItemInViewportProxy=v.bind(this.isFeedItemInViewport,this),this.resizeProxy=v.debounce(v.bind(this.adjustSize,this),300),d(window).on("resize",v.debounce(v.bind(this.adjustSize,this),300)),this.initKeyboardShortcuts(),this.lastPosition=0},initKeyboardShortcuts:function(){var e=s.factory(this,"setFocusAndExpandItem",-1),t=s.factory(this,"setFocusAndExpandItem",1),n=s.factory(this,"setFocusedItem",-1,!0),r=s.factory(this,"setFocusedItem",1,!0),i=s.factory(this,"viewOriginal"),o=s.factory(this,"keyboardShortcutToggle"),u=s.factory(this,"collapseView"),a=s.factory(this,"mailItem"),f=s.factory(this,"diggItem"),l=s.factory(this,"saveItem"),c=s.factory(this,"pageScroll",1),h=s.factory(this,"pageScroll",-1),p=s.factory(this,"markAsReadProxy"),d=s.factory(this,"toggleReadState");this.keyboardShortcuts.add("j",t),this.keyboardShortcuts.add("k",e),this.keyboardShortcuts.add("n",r),this.keyboardShortcuts.add("p",n),this.keyboardShortcuts.add("v",i),this.keyboardShortcuts.add("enter",o),this.keyboardShortcuts.add("esc",u),this.keyboardShortcuts.add("o",o),this.keyboardShortcuts.add("e",a),this.keyboardShortcuts.add("d",f),this.keyboardShortcuts.add("s",l),this.keyboardShortcuts.add("m",d),this.keyboardShortcuts.add("space",c),this.keyboardShortcuts.add({key:"space",shiftKey:!0},h),this.keyboardShortcuts.add({key:"a",shiftKey:!0},p)},isFeedItemInFocus:function(e,t){m(e,t)},isFeedItemInViewport:function(e,t){g(e,t)},renderPreviewHeader:function(){var t=this.model.get("type")==="feed"&&this.model.get("title").indexOf("digg.com/")<0&&this.model.get("icon"),n="",r,i=this.model.get("folder"),s=this.model.get("subscribed");r=this.model.escape("alt_label")||this.model.escape("label")||this.model.escape("alt_title")||this.model.escape("title"),this.el.innerHTML=this.streamPreviewTemplate({title:r,icon:t,icon_style:n,display_breadcrumb:!!e.user.get("user_id"),folder:i,subscribed:s,preview_mode:this.preview_mode})},loadAllBrowseCategories:function(){this.mode==="preview"&&e.pubsub.fire("discovery:load_categories")},loadBrowseCategory:function(){this.mode==="preview"&&e.pubsub.fire("discovery:load_category",this.model.get("folder"))},loadSearchResults:function(){e.pubsub.fire("load_search_results")},addSubscription:function(){this.mode==="preview"&&(e.pubsub.fire("add_subscription",{feed_url:this.model.get("feed_url"),html_url:this.model.get("html_url"),feed_title:this.model.get("title")}),e.user.get("user_id")&&this.$el.find(".btn-add-feed").prop("disabled",!0).text("✔"))},renderHeader:function(){var e=this.model.escape("title"),t=this.model.escape("alt_title")||e,n=this.model.get("type")==="feed"&&this.model.get("title").indexOf("digg.com/")<0&&this.model.get("icon"),r="",i,s=!1;this.model.get("html_url")?i=['<a href="',this.model.get("html_url"),'" target="_blank">',t||this.model.get("label"),"</a>"].join(""):i=this.model.get("alt_label")||this.model.get("label")||this.model.get("alt_title")||this.model.get("title"),n&&(r="background-image:url("+n+");",n.indexOf(".ico")<0&&(r+="background-size:16px 16px;"));if(this.model.get("type")==="folder"||e&&e.indexOf("digg.com/")<0)s=!0;this.el.innerHTML=this.streamTemplate({title:i,icon:n,icon_style:r,editable:s})},renderItems:function(e){var t=document.createDocumentFragment(),r=document.getElementById("zero-items-article"),i=this.$el.find(".feeditems-zero-items-label"),s=document.getElementById("btn-view-all-items"),o=this.model.get("title"),u=0,a;i.size()&&i.remove(),this.model.items.size()>0?(r&&this.el.removeChild(r),s&&this.el.removeChild(s),this.model.items.each(function(r,i){var s,o=this.model.get("title"),a=this.model.get("feed_url");!r.get("rendered")&&(e||u<this.pageSize)&&(r.set({showSource:this.model.get("type")==="folder"||o&&o.indexOf("digg.com/")>-1||a.indexOf("digg.com/")>-1}),s=n.factory({model:r,viewType:this.viewType,feed:this,parentView:this}),t.appendChild(s.render()),u===0&&(s.el.className+=e?" local":" api"),r.rendered||u++,this.feedItems.push(s),this.model.get("read")||this.unreadFeedItems.push(s),r.set({rendered:!0},{silent:!0}))},this),this.el.appendChild(t),this.model.get("show")==="unread"&&(this.model.get("view")==="list"||this.model.get("view")==="expanded"&&this.model.items.size()<=this.pageSize)&&(~~this.model.get("next_position")===-1?(s=document.createElement("article"),s.id="btn-view-all-items",s.innerHTML="View all items from "+(this.model.get("alt_label")||this.model.get("label")||this.model.get("alt_title")||this.model.get("title")),t.appendChild(s)):!e&&this.scrollmonitor&&(this.viewType==="list"||this.viewType==="expanded"&&this.el.parentElement.clientHeight>=this.el.clientHeight)&&this.scrollmonitor.monitor())):this.model.get("show")==="unread"?(s||(s=document.createElement("article"),s.id="btn-view-all-items",s.className="zero-items",t.appendChild(s)),s.innerHTML='<span class="plain-label">There are no unread items for '+(this.model.get("alt_label")||this.model.get("label")||this.model.get("alt_title")||this.model.get("title"))+" &#183; </span>View all",this.$el.find(".feeditems-zero-items-label").size()||this.$el.append(d("<div />",{html:"No unread items","class":"feeditems-zero-items-label"}))):r||(r=document.createElement("article"),r.id="zero-items-article",o==="digg.com/all"||o==="digg.com/popular"?(r.className="zero-items-article zero-popular",r.innerHTML=this.zeroPopularTemplate()):o==="digg.com/diggs"?(r.className="zero-items-article zero-diggs",r.innerHTML=this.zeroDiggsTemplate()):o==="digg.com/saved"?(r.className="zero-items-article zero-saved",r.innerHTML=this.zeroSavedTemplate()):(a=this.model.toJSON(),a.type==="folder"&&(a.title=a.label,a.alt_title=a.label),r.className="zero-items-article zero-items",r.innerHTML=this.zeroItemsTemplate(a)),t.appendChild(r)),this.el.appendChild(t)},render:function(t){var n=t&&this.viewType!==t.viewType;if(t&&t.showType&&this.showType!==t.showType)return this.showType=t.showType,this.refresh(),this.el;t&&t.viewType&&(this.viewType!==t.viewType&&(this.focusedIndex=null),this.viewType=t.viewType,this.model.items.each(function(e){e.set({rendered:!1,keep_unread:!1},{silent:!0})}),this.focusedIndex=0);if(!this._rendered||n)e.pubsub.fire("scroll_feed_view",0,!0),this.focusedIndex=null,this.viewType==="expanded"?this.enableScrollWatch():this.disableScrollWatch(),this.resetFeedItemViews(),this.renderItems(),!this._rendered&&this.scrollmonitor&&(this.viewType==="list"||this.viewType==="expanded"&&this.el.parentElement.clientHeight>=this.el.clientHeight)?this.scrollmonitor.monitor():this.viewType==="expanded"&&this.setFocusedItem(1);this._rendered||this.adjustSize(),this.setClass(),this._rendered=!0},adjustSize:function(){var e=d("#site-header-container").outerHeight();this.$el&&this.$el.parent().height(window.innerHeight-e),this.scrollmonitor&&(this.scrollmonitor.updateScrollHeight(),this.scrollmonitor.monitor())},getNextPage:function(t){this.model.items.size()>0&&this.renderItems(!0),~~this.model.get("next_position")!==-1&&this.lastPosition!==this.model.get("next_position")&&(this.lastPosition=this.model.get("next_position"),this.model.fetch(),e.pubsub.fire("loading_in_progress"))},postShow:function(){this.scrollmonitor=o.factory(this.el.parentNode,{name:"feed_items_stream",pubsub:e.pubsub}),e.pubsub.on("feed_items","feed_items_stream:scroll:bottom",this.getNextPageProxy)},show:function(){this.model.fetch(),e.pubsub.fire("loading_in_progress")},refresh:function(){var e=document.getElementById("btn-view-all-items");e&&this.el.removeChild(e),this._rendered=!1,this.focusedIndex=null,this.expandedItemIndex=null,this.model.set({next_position:!1},{silent:!0}),this.model.items.reset(null,{silent:!0}),this.resetFeedItemViews(),this.show()},resetFeedItemViews:function(){v.each(this.feedItems,function(e){e.model.set({rendered:!1},{silent:!0}),e.remove()}),this.feedItems.length=0,this.unreadFeedItems.length=0,this.focusedItem=null},remove:function(){this.resetFeedItemViews(),e.pubsub.off("feed_items","feed_items_stream:scroll:bottom",this.getNextPageProxy),this.scrollmonitor&&(this.scrollmonitor.destroy(),this.scrollmonitor=null),this.mode!=="preview"&&(this.disableMarkAsRead(),this.disableScrollWatch()),d(window).off("resize",this.resizeProxy),y.__super__.remove.call(this)},viewOriginal:function(){this.focusedIndex!=null&&this.feedItems[this.focusedIndex].viewOriginal()},collapseView:function(){this.feedItems[this.focusedIndex]&&this.feedItems[this.focusedIndex].collapse()},keyboardShortcutToggle:function(){this.viewType==="list"&&this.expandedItemIndex!=null&&this.expandedItemIndex!==this.focusedIndex&&this.feedItems[this.expandedItemIndex].collapse(),this.toggleViewType()},toggleViewType:function(e){this.focusedIndex!=null&&(this.feedItems[this.focusedIndex].toggleViewType(e),this.expandedItemIndex=this.focusedIndex)},setFocusedItem:function(e,t){this.focusedIndex!=null&&e!==0&&this.feedItems[this.focusedIndex].removeFocus(),this.feedItems.length&&(this.focusedIndex=this.focusedIndex!=null?this.focusedIndex+e:0,this.focusedIndex=i.enforceRangeLimits(this.focusedIndex,0,this.feedItems.length-1),this.feedItems[this.focusedIndex].setFocus(t),this.viewType==="expanded"&&this.hasScrolled&&this.feedItems[this.focusedIndex].markAsRead(!1,!0))},setFocusAndExpandItem:function(e,t){this.viewType==="list"&&this.disableScrollWatch(),!t&&this.viewType==="list"&&this.expandedItemIndex!=null&&this.feedItems[this.expandedItemIndex].collapse(),this.setFocusedItem(e),this.viewType==="list"&&e!==0&&!t&&this.toggleViewType(!0),e!==0?this.updateFocusedStoryPositionInViewport(e):e===0&&t&&this.updateFocusedStoryPositionInViewport(!0)},handleItemClick:function(e){var t=v.indexOf(this.feedItems,e),n=0,r=!1,s;t!==this.focusedIndex&&(this.focusedIndex==null&&(this.focusedIndex=0),n=t-this.focusedIndex,this.viewType==="list"&&this.expandedItemIndex!=null&&(this.feedItems[this.focusedIndex].collapse(),this.feedItems[this.focusedIndex].removeFocus())),this.setFocusedItem(n),this.viewType==="list"&&!r&&(s=i.isElementInViewport(this.feedItems[this.focusedIndex].$el),s&&this.toggleViewType(s!==!0))},mailItem:function(){this.feedItems[this.focusedIndex].mailItem()},diggItem:function(){this.feedItems[this.focusedIndex].digg()},saveItem:function(){this.feedItems[this.focusedIndex].save()},updateFocusedStoryPositionInViewport:function(){var e=this.feedItems[this.focusedIndex];e&&e.scrollIntoView(!0)},fireStreamEdit:function(){e.pubsub.fire("display_edit_stream_ui",this.model,this.parentFolder)},enableMarkAsRead:function(){e.pubsub.on("feeditems","mark_all_as_read",this.markAsReadProxy)},disableMarkAsRead:function(){e.pubsub.off("feeditems","mark_all_as_read",this.markAsReadProxy)},markAsRead:function(t){t&&t.stopPropagation(),this.model.markAsRead(),e.pubsub.fire("hide_reader_nav_tooltips")},toggleReadState:function(e){e&&e.stopPropagation(),this.feedItems[this.focusedIndex].toggleReadState()},enableScrollWatch:function(){e.pubsub.on("feed_items","feed_items_stream:scroll",this.scrollWatchProxy)},disableScrollWatch:function(){e.pubsub.off("feed_items","feed_items_stream:scroll",this.scrollWatchProxy)},scrollWatch:function(e){var t=50,n,r,i,s;n=v.find(this.feedItems,function(e,n){return m(e.$el,t)===!0}),s=v.filter(this.unreadFeedItems,function(e,t){return!e.model.get("read")&&!e.model.get("keep_unread")&&g(e.$el)===!0}),this.unreadFeedItems=v.reject(this.unreadFeedItems,function(e,t){return!e.model.get("read")&&!e.model.get("keep_unread")&&g(e.$el)===!0}),v.each(s,function(e){e.markAsRead(!1,!0),e.setReadStatusClass()}),n&&(r=v.indexOf(this.feedItems,n),this._scrollFocusIndex!==r&&(this._scrollFocusIndex=r,i=this.focusedIndex!=null?r-this.focusedIndex:i,this.setFocusedItem(i)))},pageScroll:function(t){var n=this.$el.parent(),r,i,s,o=this.scrollmonitor.data().scrollTop+n.height();this.focusedIndex!=null&&(s=v.first(this.feedItems,this.focusedIndex),i=v.chain(s).map(function(e){return e.$el.height()}).reduce(function(e,t){return e+t},59).value(),r=this.feedItems[this.focusedIndex].getExpandedOffset(i)),this.focusedIndex==null?this.setFocusAndExpandItem(t):t===1&&r.bottom<o?(this.setFocusAndExpandItem(t),this.shiftSpaceToPreviousItem=!0):t===-1?this.shiftSpaceToPreviousItem?(this.setFocusAndExpandItem(t),this.shiftSpaceToPreviousItem=!0):(this.setFocusAndExpandItem(0,!0),this.shiftSpaceToPreviousItem=!0):t===1?(e.pubsub.fire("scroll_feed_view",this.scrollmonitor.data().scrollTop+n.height()),this.shiftSpaceToPreviousItem=!1):t===-1&&e.pubsub.fire("scroll_feed_view",this.scrollmonitor.data().scrollTop-n.height())},switchToShowAll:function(t){this.model.set({show:"all"},{silent:!0}),this.refresh(),e.pubsub.fire("do_show_type_change","all"),d("#btn-view-all-items").remove(),t.stopPropagation()}});return{constructor:y}}),define("bs/reader/view/feeditems/feeditems_list",["bs/reader/view/feeditems/feeditems_base","bs/views/feeditem"],function(e,t){var n=e.constructor.extend({initialize:function(e){n.__super__.initialize.call(this,e),this.listenTo(this.model.items,"reset add",this.render),this._rendered||this.listenTo(this.model.items,"add",this.renderItems)}});return{factory:function(e){return new n(e)},constructor:n}}),define("bs/reader/view/feeditems/feeditems_expanded",["bs/core","bs/reader/view/feeditems/feeditems_base","bs/views/feeditem","bs/util/scrollmonitor","lodash"],function(e,t,n,r,i){function s(e,t){var n=e[0].getBoundingClientRect(),r=e.parents(".scrollable"),i;t=t||0,i=r[0]&&r[0].getBoundingClientRect();if(!i)return;return n.top>=i.bottom?"bottom":n.bottom-t<=i.top?"top":!0}function o(e,t){var n=e[0].getBoundingClientRect(),r=e.parents(".scrollable"),i,s;t=t||0,i=r[0]&&r[0].getBoundingClientRect();if(!i)return;return n.height>=i.height?s=n.top+i.height/2:s=n.bottom,n.top>=i.top&&s<=i.bottom}var u=t.constructor.extend({initialize:function(e){u.__super__.initialize.call(this,e),this.getNextPageProxy=i.bind(this.getNextPage,this),this.lastPosition=0},postShow:function(){this.scrollmonitor=r.factory(this.el.parentNode,{name:"feed_items_stream",pubsub:e.pubsub}),e.pubsub.on("feed_items","feed_items_stream:scroll:bottom",this.getNextPageProxy)},getNextPage:function(t){~~this.model.get("next_position")!==-1&&this.lastPosition!==this.model.get("next_position")&&(this.lastPosition=this.model.get("next_position"),this.model.fetch(),e.pubsub.fire("loading_in_progress"))},addFeedItems:function(e){var t,r=this.model.get("title"),i=this.model.get("feed_url"),s=document.createDocumentFragment(),o;for(var u=e,a=e+9;u<a;u+=1)o=this.model.items.at(u),o&&!o.get("rendered")?(o.set({showSource:this.model.get("type")==="folder"||r&&r.indexOf("digg.com/")>-1||i.indexOf("digg.com/")>-1},{silent:!0}),t=n.factory({model:o,viewType:this.viewType,feed:this,parentView:this}),s.appendChild(t.render()),this.feedItems.push(t),this.model.get("read")||this.unreadFeedItems.push(t),o.set({rendered:!0},{silent:!0})):typeof o=="undefined"&&~~this.model.get("next_position")===-1&&this.addViewAllItems();s.childNodes.length>0&&this.el.appendChild(s)},addViewAllItems:function(){var e=document.getElementById("btn-view-all-items");e||(e=document.createElement("article"),e.id="btn-view-all-items",e.innerHTML="View all items from "+(this.model.get("alt_label")||this.model.get("label")||this.model.get("alt_title")||this.model.get("title")),this.el.appendChild(e))},scrollWatch:function(e){var t=200,n,r,u,a,f,l;this.hasScrolled=!0,n=i.find(this.feedItems,function(e,n){return s(e.$el,t)===!0}),this.focusedItem=n,a=i.filter(this.unreadFeedItems,function(e,t){return!e.model.get("read")&&!e.model.get("keep_unread")&&o(e.$el)===!0}),this.unreadFeedItems=i.reject(this.unreadFeedItems,function(e,t){return!e.model.get("read")&&!e.model.get("keep_unread")&&o(e.$el)===!0}),i.each(a,function(e){e.markAsRead(!1,!0),e.setReadStatusClass()}),r=n?i.indexOf(this.feedItems,n):!1;if(r!==this._scrollFocusIndex){this._scrollFocusIndex=r,u=this.focusedIndex!=null?r-this.focusedIndex:u;if(e.direction==="down")for(f=r-4,l=r+5;f<l;f+=1){if(f<0||f===r||f>r&&this.feedItems[f]&&this.feedItems[f]._rendered)continue;f<r-2&&this.feedItems[f]&&!this.feedItems[f].isClearedOut?(this.feedItems[f].clearOut(),this.feedItems[f].model.get("read")&&!this.feedItems[f].model.get("keep_unread")&&(this.feedItems[f].markAsRead(!1,!0),this.feedItems[f].setReadStatusClass())):f>r&&this.feedItems[f]&&this.feedItems[f].isClearedOut?this.feedItems[f].reloadContent():f>this.model.items.size()&&~~this.model.get("next_position")===-1?this.addViewAllItems():this.addFeedItems(f)}else if(e.direction==="up")for(f=r+5;f>=r-4;f-=1){if(f<0||f===r||f>r&&this.feedItems[f]&&this.feedItems[f]._rendered)continue;f>r+4&&this.feedItems[f]&&!this.feedItems[f].isClearedOut?(this.feedItems[f].clearOut(),this.feedItems[f].model.get("read")&&!this.feedItems[f].model.get("keep_unread")&&(this.feedItems[f].markAsRead(!1,!0),this.feedItems[f].setReadStatusClass())):f<r&&this.feedItems[f]&&this.feedItems[f].isClearedOut&&this.feedItems[f].reloadContent()}this.model.get("next_position")>0&&(r>=Math.round(this.model.items.size()*.4)||this.el.parentElement.clientHeight>=this.el.clientHeight)&&this.getNextPage(),this.setFocusedItem(u)}}});return{factory:function(e){return new u(e)},constructor:u}}),define("bs/reader/view/feeditems/feeditems",["bs/reader/view/feeditems/feeditems_list","bs/reader/view/feeditems/feeditems_expanded"],function(e,t){return{factory:function(n){var r=n.model.get("view"),i;return i=r==="expanded"?t.factory(n):e.factory(n),i}}}),define("bs/views/modal",["bs/util/keyboardshortcutsmanager","backbone","bootstrap_modal","lodash"],function(e,t,n,r){var i=Backbone.View.extend({className:"modal hide fade",initialize:function(t){this.name=t.name,this._rendered=!1,this.keyboardShortcuts=e.factory(),this.$el.on("click",".btn-modal-close",r.bind(this.hide,this))},show:function(){this._rendered||this.render(),this.$el.modal({show:!0,keyboard:!0,backdrop:!0})},hide:function(){this.$el.modal("hide"),this.postHide&&typeof this.postHide=="function"&&this.postHide()}});return{factory:function(e){return new i(e)},constructor:i}}),define("text!bs/templates/reader/editfeed.html",[],function(){return'<header class="modal-header">\n    <span class="modal-header-text">\n        Edit <%= type.charAt(0).toUpperCase() + type.substr(1)  %>\n    </span>\n    <div class="btn-modal-close">✖</div>\n</header>\n<section class="modal-body">\n    <div class="modal-container">\n        <div class="modal-label">Name</div>\n        <input class="new-feed-title" type="text" value="<%= ( !! title) ? title : label %>" />\n    </div>\n    \n    <% if (type === "feed") { %>\n        <div class="modal-container">\n            <div class="modal-label">Feed URL</div>\n            <div class="feed-url-label" title="<%=feed_url %>">\n                <%= feed_url %>\n            </div>\n        </div>\n    <% } %>\n    \n    <div class="modal-container no-label">\n        <button class="btn-action subscription-delete"><%= type === "folder" ? "Delete Folder" : "Unsubscribe" %></button>\n    </div>\n\n</section>\n<footer class="modal-footer">\n    <button class="subscription-new-label-save btn-confirm">Done</button>\n</footer>\n\n'}),define("bs/views/editfeed",["bs/core","bs/views/modal","text!bs/templates/reader/editfeed.html","lodash"],function(e,t,n,r){var i=t.constructor.extend({events:{"click .subscription-new-label-save":"updateName","keypress .new-feed-title":"updateNameProxy","click .subscription-delete":"removeSubscription"},initialize:function(e){i.__super__.initialize.call(this,e),e.parentFolder&&(this.parentFolder=e.parentFolder)},className:function(){return"edit-feed-view "+this.constructor.__super__.className},template:r.template(n),render:function(){var e=this.model.toJSON();return e.label&&(e.title=e.label),this.el.innerHTML=this.template(e),this._rendered=!0,this.el},updateNameProxy:function(e){if(e.keyCode===13)return this.updateName()},updateName:function(t){var n=this.$el.find(".new-feed-title").val(),r=this.$el.find(".error"),i="<span class='error'>Please try another folder name.</span>";r.size()>0&&r.remove();if(n.indexOf("digg.com/")>-1)return this.$el.find(".modal-body").append(i),!1;e.pubsub.fire("update_feed_name",this.model,n),this.$el.modal("hide")},removeSubscription:function(t){e.pubsub.fire("remove_feed",this.model,this.parentFolder),this.$el.modal("hide")}});return{factory:function(e){return new i(e)},constructor:i}}),define("bs/views/confirm",["bs/views/modal","lodash"],function(e,t){var n=e.constructor.extend({className:function(){return"confirmation-view "+this.constructor.__super__.className},render:function(){var e=document.createDocumentFragment(),t=this.renderModalHeader(),n=this.renderModalBody(),r=this.renderModalFooter();return e.appendChild(t),e.appendChild(n),e.appendChild(r),this.el.appendChild(e),this._rendered=!0,this.el},renderModalHeader:function(){var e=document.createElement("header"),t=document.createElement("span"),n=document.createElement("div");return n.className="btn-modal-close",n.innerHTML="✖",t.className="modal-header-text",t.innerHTML=this.options.header_text?this.options.header_text:"Digg Reader",e.className="modal-header",e.appendChild(t),e.appendChild(n),e},renderModalBody:function(){var e=document.createElement("div"),t=document.createElement("p");return t.className="modal-message",t.innerHTML=this.options.message_text?this.options.message_text:"Hello!",e.className="modal-body",e.appendChild(t),e},renderModalFooter:function(){var e=document.createElement("footer"),t=document.createElement("button");return t.className="btn-confirm btn-modal-close",t.innerHTML=this.options.confirm_button_text?this.options.confirm_button_text:"OK",e.className="modal-footer",e.appendChild(t),e}});return{factory:function(e){return new n(e)},constructor:n}}),define("text!bs/templates/reader/addfolder.html",[],function(){return'<header class="modal-header">\n    <span class="modal-header-text">\n        Add Folder\n    </span>\n    <div class="btn-modal-close">✖</div>\n</header>\n<section class="modal-body">\n    <div class="modal-container">\n        <div class="modal-label">Name</div>\n        <input type="text" class="new-folder-label" /> \n    </div>\n</section>\n<footer class="modal-footer">\n    <button class="btn-confirm btn-add-folder-submit">Add</button>\n</footer>\n\n'}),define("bs/views/addfolder",["bs/core","bs/views/modal","text!bs/templates/reader/addfolder.html","lodash"],function(e,t,n,r){var i=t.constructor.extend({events:{"click .btn-add-folder-submit":"triggerAddFolder","keypress .new-folder-label":"triggerAddFolderProxy"},className:function(){return"fetch-feed-view "+this.constructor.__super__.className},render:function(){return this.el.innerHTML=n,this._rendered=!0,this.el},postShow:function(){this.el.getElementsByTagName("input")[0].focus()},triggerAddFolderProxy:function(e){if(e.keyCode===13)return this.triggerAddFolder()},triggerAddFolder:function(t){var n=this.$el.find(".new-folder-label").val(),r=this.$el.find(".error");r.size()>0&&r.remove();if(n.indexOf("digg.com/")>-1)return this.$el.find(".modal-body").append("<span class='error'>Please try another folder name.</span>"),!1;e.pubsub.fire("add_folder",n),this.$el.modal("hide")}});return{factory:function(e){return new i(e)},constructor:i}}),define("text!bs/templates/reader/addbutton.html",[],function(){return'<div class="dr-add-btn">\n    <div class="dr-add-btn-label">\n        <div class="btn-label-inner">Add</div>\n    </div>\n    <div class="tooltip-subscription-add">\n        <ul class="tooltip-list">\n            <li class="tooltip-list-item tooltip-list-input">\n                <form id="tooltip-subscription-add-form">\n                    <input type="text" id="tooltip-subscription-add-form-input" placeholder="Search or Enter a URL" autocomplete="off" />\n                </form>\n            </li>\n            <li class="tooltip-list-item btn-browse-categories">Browse categories</li>\n            <li class="tooltip-list-item btn-add-folder">New folder</li>\n        </ul>\n    </div>\n</div>'}),define("bs/views/addbutton",["bs/core","bs/views/base","text!bs/templates/reader/addbutton.html","bs/util/command","lodash"],function(e,t,n,r,i){var s=t.constructor.extend({events:{"click .dr-add-btn-label":"showTooltip","submit #tooltip-subscription-add-form":"loadDiscoveryFeedSearchView","click .btn-browse-categories":"loadBrowseCategoriesView","click .btn-add-folder":"displayAddFolderUI"},initialize:function(t){t||(t={name:"add-button"}),s.__super__.initialize.call(this,t);var n=r.factory(this,"showTooltip");this.keyboardShortcuts.add("a",n),e.pubsub.on("reader","reader:show_add_tooltip",i.bind(this.showTooltip,this)),e.pubsub.on("reader","discovery:feed_search_loaded",i.bind(this.feedDiscoveryCallback,this))},render:function(){return this.el.innerHTML=n,this.el},showTooltip:function(e){e&&e.stopPropagation(),this.$el.addClass("show-tooltip"),$("#tooltip-subscription-add-form-input").focus(),$("body").on("click.addbtntooltipclicks",i.bind(this.tooltipClickOffTarget,this))},tooltipClickOffTarget:function(e){$(e.target).parents(".tooltip-subscription-add").length===0&&this.hideTooltip()},hideTooltip:function(){this.$el.removeClass("show-tooltip"),$("body").off(".addbtntooltipclicks")},displayAddFolderUI:function(){e.pubsub.fire("display_add_folder_ui"),this.hideTooltip()},loadBrowseCategoriesView:function(){this.hideTooltip(),e.pubsub.fire("discovery:load_categories")},loadDiscoveryFeedSearchView:function(){var t=$("#tooltip-subscription-add-form-input"),n=t.val();return t.addClass("loading-show-bars"),e.pubsub.fire("discovery:load_search",{feed_url:n}),!1},feedDiscoveryCallback:function(){var e=$("#tooltip-subscription-add-form-input");e.val("").removeClass("loading-show-bars"),this.hideTooltip()}});return{factory:function(e){return new s(e)},constructor:s}}),define("bs/views/main_region_message",["bs/core","bs/views/base"],function(e,t){var n=t.constructor.extend({className:"main-message",initialize:function(e){this.name="main_message",this.constructor.__super__.initialize.call(this,e),e.className&&(this.className+=" "+e.className)},render:function(){return this.el.innerHTML=this.model.message,this.el}});return{factory:function(e){return new n(e)},constructor:n}}),define("text!bs/templates/reader/keyboardshortcutlegend.html",[],function(){return'<header class="modal-header">\n    <span class="modal-header-text">\n        Keyboard Shortcuts\n    </span>\n    <div class="btn-modal-close">✖</div>\n</header>\n<section class="modal-body">\n\n    <div class="kbs-legend-column">\n        <ul class="kbs-legend-list">\n            <li class="kbs-legend-list-item">\n                <div class="kbs-legend-label">Next item</div>\n                <div class="kbs-legend-key"><span class="key">j</span></div>\n            </li>\n            <li class="kbs-legend-list-item">\n                <div class="kbs-legend-label">Previous item</div>\n                <div class="kbs-legend-key"><span class="key">k</span></div>\n            </li>\n            <li class="kbs-legend-list-item">\n                <div class="kbs-legend-label">Select Next item</div>\n                <div class="kbs-legend-key"><span class="key">n</span></div>\n            </li>\n            <li class="kbs-legend-list-item">\n                <div class="kbs-legend-label">Select Previous item</div>\n                <div class="kbs-legend-key"><span class="key">p</span></div>\n            </li>\n            <li class="kbs-legend-list-item">\n                <div class="kbs-legend-label">Expand / Collapse item (list)</div>\n                <div class="kbs-legend-key"><span class="key">o</span> / <span class="key key-wide">enter</span></div>\n            </li>\n            <li class="kbs-legend-list-item">\n                <div class="kbs-legend-label">Next item/page down</div>\n                <div class="kbs-legend-key"><span class="key key-wide">space</span></div>\n            </li>\n            <li class="kbs-legend-list-item">\n                <div class="kbs-legend-label">Previous item/page</div>\n                <div class="kbs-legend-key"><span class="key key-wide">shift</span> + <span class="key key-wide">space</span></div>\n            </li>\n            <li class="kbs-legend-list-item">\n                <div class="kbs-legend-label">Refresh</div>\n                <div class="kbs-legend-key"><span class="key">r</span></div>\n            </li>\n            <li class="kbs-legend-list-item">\n                <div class="kbs-legend-label">Expanded view</div>\n                <div class="kbs-legend-key"><span class="key">1</span></div>\n            </li>\n            <li class="kbs-legend-list-item">\n                <div class="kbs-legend-label">List view</div>\n                <div class="kbs-legend-key"><span class="key">2</span></div>\n            </li>\n        </ul>\n    </div>\n    \n    <div class="kbs-legend-column">\n        <ul class="kbs-legend-list">\n            <li class="kbs-legend-list-item">\n                <div class="kbs-legend-label">Left Nav: Next</div>\n                <div class="kbs-legend-key"><span class="key key-wide">shift</span> + <span class="key">j</span></div>\n            </li>\n            <li class="kbs-legend-list-item">\n                <div class="kbs-legend-label">Left Nav: Previous</div>\n                <div class="kbs-legend-key"><span class="key key-wide">shift</span> + <span class="key">k</span></div>\n            </li>\n            <li class="kbs-legend-list-item">\n                <div class="kbs-legend-label">Left Nav: Select</div>\n                <div class="kbs-legend-key"><span class="key key-wide">shift</span> + <span class="key">o</span></div>\n            </li>\n            <li class="kbs-legend-list-item">\n                <div class="kbs-legend-label">Left Nav: Expand / Collapse folder</div>\n                <div class="kbs-legend-key"><span class="key key-wide">shift</span> + <span class="key">x</span></div>\n            </li>\n            <li class="kbs-legend-list-item">\n                <div class="kbs-legend-label">Add subscription</div>\n                <div class="kbs-legend-key"><span class="key">a</span></div>\n            </li>\n            <li class="kbs-legend-list-item">\n                <div class="kbs-legend-label">Mark All As Read</div>\n                <div class="kbs-legend-key"><span class="key key-wide">shift</span> + <span class="key">a</span></div>\n            </li>\n            <li class="kbs-legend-list-item">\n                <div class="kbs-legend-label">Mark Item as Read / Unread</div>\n                <div class="kbs-legend-key"><span class="key">m</span></div>\n            </li>\n            <li class="kbs-legend-list-item">\n                <div class="kbs-legend-label">Email</div>\n                <div class="kbs-legend-key"><span class="key">e</span></div>\n            </li>\n            <li class="kbs-legend-list-item">\n                <div class="kbs-legend-label">Digg</div>\n                <div class="kbs-legend-key"><span class="key">d</span></div>\n            </li>\n            <li class="kbs-legend-list-item">\n                <div class="kbs-legend-label">Save</div>\n                <div class="kbs-legend-key"><span class="key">s</span></div>\n            </li>\n            <li class="kbs-legend-list-item">\n                <div class="kbs-legend-label">View original</div>\n                <div class="kbs-legend-key"><span class="key">v</span></div>\n            </li>\n            <li class="kbs-legend-list-item">\n                <div class="kbs-legend-label">Keyboard shortcut guide</div>\n                <div class="kbs-legend-key"><span class="key">?</span></div>\n            </li>\n        </ul>\n    </div>\n\n</section>\n'}),define("bs/views/keyboard_shortcut_legend",["bs/core","bs/util/command","bs/util/keyboardshortcutsmanager","bs/views/modal","text!bs/templates/reader/keyboardshortcutlegend.html","lodash"],function(e,t,n,r,i,s){var o=r.constructor.extend({className:function(){return"keyboardshortcut-legend-view "+o.__super__.className},initialize:function(e){o.__super__.initialize.call(this,e)},render:function(){return this.el.innerHTML=i,this._rendered=!0,this.el}});return{factory:function(e){return new o(e)},constructor:o}}),define("bs/model/discoveryfeeditem",["bs/core","bs/util/interface","bs/util/xhr","bs/util/cookies","lodash"],function(e,t,n,r,i){var s=Backbone.Model.extend({initialize:function(){var e=this.get("icon")?this.get("icon"):!1;this.set("icon",e)}});return{factory:function(e,t){return new s(e,t)},constructor:s}}),define("bs/collection/discoveryfeeditems",["bs/model/discoveryfeeditem","backbone"],function(e,t){var n=Backbone.Collection.extend({model:e.constructor});return{factory:function(e,t){return new n(e,t)},constructor:n}}),define("bs/model/discoverycategory",["bs/core","bs/util/interface","bs/util/cookies","lodash","bs/collection/discoveryfeeditems"],function(e,t,n,r,i){var s=Backbone.Model.extend({initialize:function(t,n){t.title.indexOf("Wired 101 All")<0&&r.each(t.subs,function(e){e.folder=t.title}),this.set({display_breadcrumb:!!e.user.get("user_id")},{silent:!0}),this.items=i.factory(t.subs)}});return{factory:function(e,t){return new s(e,t)},constructor:s}}),define("bs/collection/discoverycategories",["bs/model/discoverycategory","backbone"],function(e,t){var n=Backbone.Collection.extend({model:e.constructor,comparator:function(e){return e.get("title")}});return{factory:function(e,t){return new n(e,t)},constructor:n}}),define("bs/model/discoveryfeed",["bs/core","bs/util/interface","bs/util/xhr","bs/util/cookies","lodash","bs/collection/discoverycategories"],function(e,t,n,r,i,s){var o=Backbone.Model.extend({url:function(){return"/api/discovery/list.json"},initialize:function(){this.categories=s.factory()},parse:function(e){var t=i.map(e.data,function(e,t){return e.title=t,e});return this.categories.set(t),e}});return{factory:function(e,t){return new o(e,t)},constructor:o}}),define("text!bs/templates/reader/discoveryfeeditem.html",[],function(){return'<div class="discovery-feed-item-meta-wrap">\n    <div class="discovery-feed-item-img-wrap">\n        <% if (icon) { %>\n            <div class="dr-feed-badge" style="background-image: url(<%= icon %>); background-size: 16px;"></div>\n        <% } %>\n    </div>\n    <div class="discover-feed-item-title-description-wrap">\n        <div class="discovery-feed-item-title <%= can_preview ? "discovery-feed-item-title-preview" : "" %>"><%= title %></div>\n        <div class="discovery-feed-item-description"><%= description %></div>\n        <div class="discovery-feed-item-feed-url"><%= feed_url %></div>\n    </div>\n</div>\n<div class="discovery-feed-item-controls">\n    <% if (subscribed) { %>\n        <button class="btn-action btn-add-feed" disabled>✔</button>\n    <% } else { %>\n        <button class="btn-action btn-add-feed">Add</button>\n    <% } %>\n</div>\n'}),define("bs/views/discoveryfeeditem",["bs/core","bs/views/base","bs/util/command","bs/util/format","lodash","text!bs/templates/reader/discoveryfeeditem.html","bs/reader/subscriptions","bs/reader/view/feeditems/feeditems"],function(e,t,n,r,i,s,o,u){var a=t.constructor.extend({events:{"click .btn-add-feed":"addFeed","click .discovery-feed-item-title-preview":"previewFeedItems"},tagName:"li",className:"discovery-feed-item",template:i.template(s),initialize:function(e){this.constructor.__super__.initialize.call(this,e),this.listenTo(this.model,"change",this.render),this.subscribe=e.subscribe||!1,this.mode=e.mode||"discovery",this.subscribe?(this.addFeed({}),this.subscribed=!0,this.model.set({subscribed:!0},{silent:!0})):this.isSubscribed()},render:function(){var e=this.model.toJSON();return e.can_preview==null&&(e.can_preview=!0),this.el.innerHTML=this.template(e),this._rendered=!0,this.el},isSubscribed:function(){var e=this.model.get("feed_url"),t=o.subscriptions.findWhere({feed_url:e});t!="undefined"?this.subscribed=!0:this.subscribed=!1},addFeed:function(t){t.folder?e.pubsub.fire("add_subscription",{feed_url:this.model.get("feed_url"),html_url:this.model.get("html_url"),feed_title:this.model.get("title"),folder:t.folder}):e.pubsub.fire("add_subscription",{feed_url:this.model.get("feed_url"),html_url:this.model.get("html_url"),feed_title:this.model.get("title")});if(o.subscriptions.size()){this.$el.find(".btn-add-feed").addClass("btn-working");var n=i.bind(function(t){t.feed_url===this.model.get("feed_url")&&(this.$el.find(".btn-add-feed").removeClass("btn-working").prop("disabled",!0).text("✔"),e.pubsub.off("add_feed","add_feed_success",n))},this);e.pubsub.on("add_feed","add_feed_success",n)}},previewFeedItems:function(){var t,n,r;if(!this.model.get("can_preview"))return;this.model.set({type:"feed"},{silent:!0}),n=o.subscriptions.findOrCreate(this.model.toJSON(),o),r={name:"main",model:n,mode:"preview",preview_mode:this.mode},t=u.factory(r),e.pubsub.fire("preview_feed",t)}});return{factory:function(e){return new a(e)},constructor:a}}),define("bs/views/discoverycategory",["bs/core","bs/views/base","bs/views/discoveryfeeditem","bs/util/command","bs/util/format","lodash"],function(e,t,n,r,i,s){var o=t.constructor.extend({events:{click:"loadCategory"},tagName:"li",className:"discovery-category",initialize:function(e){this.constructor.__super__.initialize.call(this,e),this.listenTo(this.model,"change",this.render),$(window).on("resize",s.debounce(s.bind(this.adjustSize,this),300))},loadCategory:function(){e.pubsub.fire("discovery:load_category",this.model)},render:function(e){var t=document.createDocumentFragment(),r=document.createElement("div"),i=document.createElement("ul");return r.className="discovery-category-label",r.innerHTML=this.model.get("title"),t.appendChild(r),e.renderFeeds&&(i.className="discovery-feed-list",this.model.items.each(function(e){var t=n.factory({model:e,mode:"discovery"});i.appendChild(t.render())}),t.appendChild(i)),this.el.appendChild(t),this._rendered||this.adjustSize(),this._rendered=!0,this.el},adjustSize:function(){var e=$("#site-header-container").outerHeight();this.$el.parent().height(window.innerHeight-e)}});return{factory:function(e){return new o(e)},constructor:o}}),define("bs/views/discoverybrowsecategories",["bs/core","bs/views/base","bs/views/discoverycategory","bs/views/discoveryfeeditem","bs/util/command","bs/util/format","lodash"],function(e,t,n,r,i,s,o){var u=t.constructor.extend({events:{},tagName:"div",className:"discovery-browse discovery-browse-categories-view",initialize:function(e){this.constructor.__super__.initialize.call(this,e),this.listenTo(this.model,"change",this.render),this.model.fetch(),$(window).on("resize",o.debounce(o.bind(this.adjustSize,this),300))},renderHeader:function(){var e=document.createElement("header");return e.className="discovery-browse-header",e.innerHTML='<h2 class="discovery-browse-hed">Browse</h2>',e},renderList:function(){var e=document.createElement("ul");return e.className="discovery-category-list",e},render:function(){var t=document.createDocumentFragment(),r=this.renderHeader(),i=this.renderList(),s=e.user.get("groups"),u=this.model.categories.filter(function(e){return!e.get("whitelisted")||s&&s.beta||o.isArray(s)&&o.contains(s,"beta")}),a=u.length,f=3,l=Math.ceil(a/f),c=0;if(u.length<1)return;return t.appendChild(r),o.each(u,o.bind(function(e){c%l===0&&(t.appendChild(i),i=this.renderList());var r=n.factory({model:e});i.appendChild(r.render({renderFeeds:!1})),c+=1},this)),t.appendChild(i),this.el.appendChild(t),this._rendered||this.adjustSize(),this._rendered=!0,this.el},adjustSize:function(){var e=$("#site-header-container").outerHeight();this.$el.parent().height(window.innerHeight-e)}});return{factory:function(e){return new u(e)},constructor:u}}),define("text!bs/templates/reader/discoverycategoryheader.html",[],function(){return'<h2 class="discovery-browse-hed <%= ! display_breadcrumb ? \' no-breadcrumb\' : \'\' %>">\n    <% if (display_breadcrumb) { %>\n        <span class="discovery-browse-categories" id="discovery-browse-categories">Browse</span>\n    <% } %>\n    <%= title %>\n</h2>\n<div class="discovery-category-controls">\n    <button class="btn-action btn-add-category">Add All</button>\n</div>\n'}),define("text!bs/templates/reader/discoverycategorydetails.html",[],function(){return'<% if (image_redirect_url) { %>\n    <a href="<%= image_redirect_url %>">\n<% } %>\n\n    <img src="<%= image_url %>" alt="" width="200" height="200" />\n\n<% if (image_redirect_url) { %>\n    </a>\n<% } %>\n\n<p class="discovery-category-details-desc"><%= description %></p>\n'}),define("bs/views/discoverybrowsecategory",["bs/core","bs/views/base","bs/views/discoveryfeeditem","bs/util/command","bs/util/format","lodash","text!bs/templates/reader/discoverycategoryheader.html","text!bs/templates/reader/discoverycategorydetails.html"],function(e,t,n,r,i,s,o,u){var a=t.constructor.extend({events:{"click .btn-add-category":"addCategoryFeeds","click #discovery-browse-categories":"loadBrowseCategoriesView"},tagName:"div",className:"discovery-browse discovery-browse-category-view",headerTemplate:s.template(o),detailsTemplate:s.template(u),initialize:function(e){this.constructor.__super__.initialize.call(this,e),this.listenTo(this.model,"change",this.render),this.itemViews=[],this.onboarding_subscription=e.onboarding_subscription||null,$(window).on("resize",s.debounce(s.bind(this.adjustSize,this),300))},render:function(){var e=document.createDocumentFragment(),t=document.createElement("header"),r,i=document.createElement("ul"),s=this.model.toJSON(),o=this.model.items.every(function(e){return e.get("subscribed")});return t.className="discovery-browse-header",t.innerHTML=this.headerTemplate(this.model.toJSON()),e.appendChild(t),i.className="discovery-feed-list",this.model.items.each(function(e){var t={model:e},r;this.onboarding_subscription&&this.onboarding_subscription.folder&&e.set({subscribed:!0}),t.subscribe=this.onboarding_subscription&&!this.onboarding_subscription.folder&&this.onboarding_subscription.feed_url&&this.onboarding_subscription.feed_url===e.get("feed_url"),r=n.factory(t),this.itemViews.push(r),i.appendChild(r.render())},this),this.model.get("image_url")&&(this.$el.addClass("discovery-has-details"),r=document.createElement("div"),r.className="discovery-category-details",r.innerHTML=this.detailsTemplate(s),e.appendChild(r)),e.appendChild(i),this.el.appendChild(e),this._rendered||this.adjustSize(),o&&this.$el.find(".btn-add-category").removeClass("btn-working").prop("disabled",!0).text("✔"),this._rendered=!0,this.el},adjustSize:function(){var e=$("#site-header-container").outerHeight();this.$el.parent().height(window.innerHeight-e)},addCategoryFeeds:function(){var t=this.model.get("title"),n=this.model.items.pluck("feed_url"),r,i,o;if(this.model.get("title").indexOf("Wired 101 All")>-1){r=this.model.items.groupBy("folder"),i={folders:s.map(r,function(e,t){return{folder:t,feed_url:s.map(e,function(e){return e.get("feed_url")})}})},e.pubsub.fire("batch_add_subscription",i);if(e.user.getUser()){this.$el.find(".btn-add-category").addClass("btn-working");var u=i.folders.length,a=0;o=s.bind(function(t){a+=1,a===u&&(this.$el.find(".btn-add-category").removeClass("btn-working").prop("disabled",!0).text("✔"),this.$el.find(".btn-add-feed").prop("disabled",!0).text("✔"),e.pubsub.off("add_feed","batch_add_feed_success",o))},this),e.pubsub.on("add_feed","batch_add_feed_success",o)}}else e.pubsub.fire("batch_add_subscription",{folder:t,feed_url:n}),e.user.getUser()&&(this.$el.find(".btn-add-category").addClass("btn-working"),o=s.bind(function(n){n.folder===t&&(this.$el.find(".btn-add-category").removeClass("btn-working").prop("disabled",!0).text("✔"),this.$el.find(".btn-add-feed").prop("disabled",!0).text("✔"),e.pubsub.off("add_feed","batch_add_feed_success",o))},this),e.pubsub.on("add_feed","batch_add_feed_success",o))},loadBrowseCategoriesView:function(){e.pubsub.fire("discovery:load_categories")},postShow:function(){this.onboarding_subscription&&this.onboarding_subscription.folder&&this.addCategoryFeeds()}});return{factory:function(e){return new a(e)},constructor:a}}),define("bs/model/discoveryfeedsearch",["bs/core","bs/util/interface","bs/util/xhr","bs/util/cookies","lodash","bs/collection/discoveryfeeditems"],function(e,t,n,r,i,s){var o=Backbone.Model.extend({url:function(e,t){var n=encodeURIComponent(this.get("feed_url")),i=r.get("_xsrf");return"/api/subscription/fetch.json?url="+n+"&_xsrf="+i},initialize:function(){this.items=s.factory()},parse:function(e){return i.each(e.data,function(e,t){e.title=e.title}),jQuery.isEmptyObject(e.data)?this.set("no_results",!0):(this.set("no_results",!1),this.items.set(e.data)),e}});return{factory:function(e,t){return new o(e,t)},constructor:o}}),define("text!bs/templates/reader/discoverysearchheader.html",[],function(){return'<div class="discovery-search-form-wrap">\n    <form class="discovery-search-form" id="discovery-search-form">\n        <input value="<%= feed_url %>" type="text" id="discovery-search-form-input" placeholder="Enter a Feed URL" autocomplete="off" />\n    </form>\n</div>\n\n<!-- <div class="discovery-search-browse">\n    <div class="discovery-search-browse-label" id="discovery-search-browse-label">Browse categories</div>\n</div> -->\n'}),define("bs/views/discoveryfeedsearch",["bs/core","bs/views/base","bs/views/discoveryfeeditem","bs/util/command","bs/util/format","lodash","text!bs/templates/reader/discoverysearchheader.html"],function(e,t,n,r,i,s,o){var u=t.constructor.extend({events:{"submit #discovery-search-form":"search","click #discovery-search-browse-label":"loadBrowseCategoriesView"},tagName:"div",className:"discovery-browse discovery-feed-search",headerTemplate:s.template(o),initialize:function(t){var n=this;this.constructor.__super__.initialize.call(this,t),this.itemViews=[],this.model.fetch().done(function(){n.render()}).fail(function(){console.log("fail")}).always(function(){e.pubsub.fire("discovery:feed_search_loaded")}),$(window).on("resize",s.debounce(s.bind(this.adjustSize,this),300))},renderHeader:function(){var e=document.createElement("header");return e.className="discovery-search-header",e.innerHTML=this.headerTemplate(this.model.toJSON()),e},renderSearchResults:function(){var e;return this.model.get("no_results")?(e=document.createElement("div"),e.className="discovery-search-results no-results",e.innerHTML="<p>No results found.</p>"):(e=document.createElement("ul"),e.className="discovery-search-results search-results-list",this.model.items.each(function(t){var r=n.factory({model:t,mode:"search"});this.itemViews.push(r),e.appendChild(r.render())},this)),e},render:function(){var e=document.createDocumentFragment(),t=this.model.get("no_results"),n;if(!t&&s.size(this.model.items)<1)return;return e.appendChild(this.renderHeader()),n=document.createElement("div"),n.id="discovery-search-results-wrap",n.appendChild(this.renderSearchResults()),e.appendChild(n),this.el.appendChild(e),this._rendered||this.adjustSize(),this._rendered=!0,this.el},adjustSize:function(){var e=$("#site-header-container").outerHeight();this.$el.parent().height(window.innerHeight-e)},search:function(){var t=this,n=document.getElementById("discovery-search-results-wrap"),r=document.getElementById("discovery-search-form-input"),i=r.value;return $(r).addClass("loading-show-bars"),n.innerHTML="",this.model.set("feed_url",i),this.model.fetch().done(function(){n.appendChild(t.renderSearchResults())}).fail(function(){console.log("fail")}).always(function(){$(r).removeClass("loading-show-bars"),e.pubsub.fire("discovery:feed_search_loaded")}),!1},loadBrowseCategoriesView:function(){e.pubsub.fire("discovery:load_categories")}});return{factory:function(e){return new u(e)},constructor:u}}),define("bs/views/welcomebrowseorsearch",["bs/core","bs/views/base","bs/views/discoverycategory","bs/views/discoveryfeeditem","bs/util/command","bs/util/format","lodash"],function(e,t,n,r,i,s,o){var u=t.constructor.extend({events:{},tagName:"div",className:"discovery-browse discovery-browse-categories-view",initialize:function(e){this.constructor.__super__.initialize.call(this,e),this.listenTo(this.model,"change",this.render),this.model.fetch()},renderHeader:function(){var e=document.createElement("header");return e.className="discovery-browse-header",e.innerHTML='<h2 class="discovery-browse-hed">Welcome OMG!</h2>',e},renderList:function(){var e=document.createElement("ul");return e.className="discovery-category-list",e},render:function(){var e=document.createDocumentFragment(),t=this.renderHeader(),r=this.renderList(),i=this.model.categories.length,s=3,o=Math.ceil(i/s),u=0;if(this.model.categories.length<1)return;return e.appendChild(t),this.model.categories.each(function(t){u%o===0&&(e.appendChild(r),r=this.renderList());var i=n.factory({model:t});r.appendChild(i.render({renderFeeds:!1})),u+=1},this),e.appendChild(r),this.el.appendChild(e),this._rendered=!0,this.el}});return{factory:function(e){return new u(e)},constructor:u}}),define("bs/views/welcome",["bs/core","bs/views/base","bs/util/command","bs/util/format","lodash"],function(e,t,n,r,i){var s=t.constructor.extend({events:{},tagName:"div",className:"welcome-view-wrap",initialize:function(e){this.constructor.__super__.initialize.call(this,e)},renderHeader:function(){var e=document.createElement("header");return e.className="welcome-view-header",e.innerHTML='<h2 class="welcome-view-hed">Welcome to Digg Reader!</h2>',e},renderContent:function(){var e=document.createElement("div");return e.innerHTML="<p>Digg Reader is a tool for keeping up with sites and blogs.<br />Get started by entering a site or blog you like or browse categories.</p>",e},renderArrow:function(){var e=document.createElement("div");return e.className="welcome-view-arrow",e},render:function(){var t=document.createDocumentFragment(),n=document.createElement("div"),r=this.renderHeader(),i=this.renderContent(),s=this.renderArrow();return n.className="welcome-view",n.appendChild(r),n.appendChild(i),t.appendChild(n),t.appendChild(s),e.pubsub.fire("reader:show_add_tooltip"),this.el.innerHTML="",this.el.appendChild(t),this._rendered=!0,this.el}});return{factory:function(e){return new s(e)},constructor:s}}),define("text!bs/templates/reader/digg_deeper_onboarding.html",[],function(){return'<% if (modal) { %>\n    <header class="modal-header">\n        <div class="btn-modal-close">✖</div>\n    </header>\n    <section class="modal-body" id="dr-digg-deeper-onboarding">\n        <header class="">\n            <h2 class="welcome-view-hed">Introducing Digg Deeper</h2>\n        </header>\n\n        <div class="modal-container">\n            <p>Digg now shows you the <span class="nowrap">most-shared</span> stories from your Twitter friends.</p>\n            <a href="http://blog.digg.com/post/91454524841/digg-deeper" target="_blank">Learn how it works</a></p>\n            <% if (has_twitter) { %>\n                <div class="btn btn-primary btn-enable-alerts">Turn On</div>    \n            <% } else { %>\n                <div class="btn btn-primary btn-enable-alerts">Sign In with Twitter</div>    \n            <% } %>\n        </div>\n\n    </section>\n    <footer class="modal-footer">\n</footer>\n\n<% } else { %>\n    <div class="welcome-view">\n        <header class="welcome-view-header">\n            <h2 class="welcome-view-hed">Introducing Digg Deeper</h2>\n        </header>\n\n        <div class="welcome-view-content">\n            <p>Digg now shows you the <span class="nowrap">most-shared</span> stories from your Twitter friends.<br>\n            <a href="http://blog.digg.com/post/91454524841/digg-deeper" target="_blank">Learn how it works</a></p>\n            <% if (has_twitter) { %>\n                <div class="btn btn-primary btn-enable-alerts">Turn On</div>    \n            <% } else { %>\n                <div class="btn btn-primary btn-enable-alerts">Sign In with Twitter</div>    \n            <% } %>\n        </div>\n    </div>\n<% } %>\n'}),define("text!bs/templates/deeper/stream_container_frontpage.html",[],function(){return'<header class="widget-hdr">\n    <h3 class="widget-hdr__title"><a class="widget-hdr__link" href="/deeper">Digg Deeper</a></h3>\n    <a class="widget-hdr__link--view-all" href="/deeper">View All</a>\n    <span id="alerts-sortby">\n        <select class="digg-deeper__sort-select js--digg-deeper-sort-select" dir="rtl">\n            <option value="score">Sort by: Most Shared</option>\n            <option value="date">Sort by: Time</option>\n        </select>\n    </span>\n</header>\n<div \n    id="digg-deeper" \n    class="stories-container" \n    data-tracking-section="Frontpage: Digg Deeper"\n>\n    <div class="ico-loading alerts-first-page-loading"></div>\n</div>\n'}),define("text!bs/templates/alerts/onboarding.html",[],function(){return'<div class="btn-alerts-close btn-alerts-opt-out">✖</div>\n<h3 class="alerts-hdr">Digg Deeper</h3>\n<p class="alerts-desc">Digg now shows you the <span class="nowrap">most-shared</span> stories from your Twitter friends.</p>\n<p><a href="http://blog.digg.com/post/91454524841/digg-deeper" target="_blank">Learn how it works</a></p>\n<p><button class="btn-primary btn-enable-alerts"><%= isUserLoggedIn && hasTwitter ? \'Turn On\' : \'Sign In with Twitter\' %></button></p>\n'}),define("text!bs/templates/alerts/email_onboarding.html",[],function(){return'<p class="alerts-desc first-el">You\'ll see your most-shared stories from Twitter here in a moment.</p>\n<p class="alerts-desc">Want to also get email alerts for these stories?</p>\n<p><input type="email" id="input-alerts-email" placeholder="you@domain.com" value="<%= email %>">\n<button class="btn-primary btn-enable-alerts-email">Enter</button></p>\n<p class="btn-alerts-email-skip">Skip this step</p>\n'}),define("text!bs/templates/alerts/email_onboarding_details.html",[],function(){return'<div class="email-details-container">\n\n    <p class="alerts-desc first-el">What emails would you like to receive?</p>\n\n    <div class="email-details">\n        <p><label><input type="radio" name="email-setting" value="alerts">Real-time alerts<br>\n            <span class="note">Up to 5 emails/day</span></label>\n        </p>\n        <p><label><input type="radio" name="email-setting" value="digest">Daily email summary</label></p>\n        <p><label><input type="radio" name="email-setting" value="both" checked>Both</label></p>\n    </div>\n\n    <p><button class="btn-primary btn-alerts-email-details-continue">Continue</button></p>\n\n    <input type="hidden" id="input-alerts-email" value="<%= email %>">\n\n</div>\n'}),define("bs/widgets/alerts",["bs/core","bs/util/xhr","bs/util/format","bs/util/cookies","bs/util/helpers","bs/util/storyactions_v3","bs/widgets/digg_deeper_story_modal","text!bs/templates/deeper/stream_container_frontpage.html","text!bs/templates/deeper/story.html","text!bs/templates/alerts/onboarding.html","text!bs/templates/alerts/email_onboarding.html","text!bs/templates/alerts/email_onboarding_details.html","lodash","jquery"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){function k(t,r){return t.position=r,t.formattedDate=n.secondsToFuzzyTime(t.date),t.content.title||(t.content.title=t.tweets.data[0].text),t.content.displayTitle=n.truncate(t.content.title,m),t.content.link_target="_blank",t.fblink=i.getFacebookStoryShareLink({app_id:e.config.FB_APP_ID,url:t.content.url}),t.tweetlink=i.getTweetStoryLink({url:t.content.url,title:t.content.title||t.tweets[0].text}),h.each(t.tweets.data,function(e){e.url=i.getTweetURL({twitter_screen_name:e.user.screen_name,tweet_id:e.id}),e.fuzzyTimeStamp=n.secondsToFuzzyTime(e.date)}),t.noContentPreview=!0,t.maxSharersDisplayed=6,t.feed="digg_deeper",t.showDiversityScore=!1,g(t)}function L(e){var t=p(this),n=this.scrollTop,r=this.scrollHeight,i=t.height(),s=e.type=="DOMMouseScroll"?e.originalEvent.detail*-40:e.originalEvent.wheelDelta,o=s>0,u=function(){return e.stopPropagation(),e.preventDefault(),e.returnValue=!1,!1};if(t.hasClass("no-alerts-pagination"))return!0;if(!o&&-s>r-i-n)return t.scrollTop(r),u();if(o&&s>n)return t.scrollTop(0),u()}function A(e){e=e||{};if(!e.id)throw new Error("Missing id selector for Alerts widget");this.id=e.id,this.el=document.getElementById(this.id),this.$el=p(this.el),e.elHeight&&this.setElHeight(e.elHeight)}var d="We're working on finding the best stories from your Twitter stream. While you're waiting, check out some of our most dugg stories.",v="twitter-news-optout",m=75,g=h.template(a),y=0,b,w,E=require("bs/core").user,S,x=new t.dataProvider({url:"/api/news/alerts/top.json",cache:!1}),T,N=new t.dataProvider({url:"/api/news/popular.json",data:{count:10,exclude_sponsored:10,exclude_videos:10},success:function(e){T=e.data.feed},error:function(e,t,n){}}),C=N.request();return A.prototype={alertsOnboardingTemplate:h.template(f),emailOnboardingTemplate:h.template(l),emailOnboardingDetailsTemplate:h.template(c),init:function(t){var n=r.get(v);if(!this.el)return;e.mediaQueriesMonitor.addQuery("(max-width: 480px)",h.bind(this.handlePhoneLayout,this)),!E.isLoggedIn()&&!n||!E.deepGet("apps.digg_deeper.enabled")?(e.pubsub.fire("digg_deeper:onboarding:start"),this.renderOnboarding(),E.isLoggedIn()||e.pubsub.one("site_nav_user_widget",e.pubsub.channels.user_auth,h.bind(function(){E.deepGet("apps.digg_deeper.enabled")?this.renderDiggDeeper():this.renderOnboarding()},this))):E.deepGet("apps.digg_deeper.enabled")&&this.renderDiggDeeper()},handlePhoneLayout:function(){},renderDiggDeeper:function(){this.el.className="alerts-enabled",this.el.innerHTML="",S=S||E.get("deeper_sortby")||"score",this.renderStreamContainer(),this.setStreamElHeight(),this.$el.find("#digg-deeper").show(1),this.fetch(),this.$el.on("click",".digg-story--deeper__sharer-link",h.bind(this.handleStorySharerClick,this)).on("click",".js--btn-show-digg-story-modal",h.bind(this.showDeeperModal,this)).on("click",".ico-settings",h.bind(this.handleSettingsClick,this)).on("click",".js--digg-story-action--tweet, .js--digg-story-action--facebook",s.shareStory).on("mouseover",".js--digg-deeper__sharer-img-container",h.bind(this.positionTooltip,this)),p(document).on("click",".js--digg-story__link",s.redirectStoryLink).on("click",".js--digg-story-action--digg",e.user.authorized(s.submitDigg,"Digg")).on("click",".js--digg-story-action--save",e.user.authorized(s.addReadingList,"Save"))},positionTooltip:function(e){var t=p(e.currentTarget),n=t.find(".js--digg-deeper__sharer-details"),r=t.position();n.css({top:r.top})},handleStorySharerClick:function(t){var n=p(t.currentTarget).data("screenname")||"Unknown";e.pubsub.fire("digg_deeper:stream:sharer_click",n)},showDeeperModal:function(e){e.stopPropagation(),e.preventDefault(),o.show(e,!0)},handleSettingsClick:function(t){e.pubsub.fire("digg_deeper:stream:settings_click")},setElHeight:function(e){var t=parseInt(this.$el.css("padding-top"),10),n=parseInt(this.$el.css("padding-bottom"),10);this.$el.height(e-t-n),this.$el.hasClass("alerts-enabled")&&this.setStreamElHeight()},fetch:function(){var e;e={sortby:S,full_text:!0},w!=null&&(e.position=w),x.request({data:e,success:h.bind(this.checkFeedResponse,this),error:h.bind(this.handleStreamRequestError,this)})},getNextPage:function(t){w!=="-1"&&b!==w&&(this.$el.find("#digg-deeper").append('<div class="ico-loading alerts-page-loading"></div>'),b=w,this.fetch(),e.pubsub.fire("loading_in_progress"))},handleStreamRequestError:function(e,t,n){this.renderImportFailed(d)},checkFeedResponse:function(t,n,r){var i=t.data.polling.status,s=~~t.data.polling.interval*1e3,u=t.status_message||d;i===0?(w=t.data.next_position,y++,e.pubsub.fire("digg_deeper:stream:loaded",S,y),e.pubsub.fire("loading_in_done"),o.saveStoryDetails(t.data.feed),this.renderStories(t)):i===-1&&b==null?this.renderImportFailed(u):i===1&&setTimeout(h.bind(this.fetch,this),s)},renderImportFailed:function(e){var t=this.$el.find("#digg-deeper");this.$el.find(".ico-loading").remove(),t.hide(),t.append('<div class="alerts-message">'+e+"</div>"),this.renderMostDuggStories(5),this.$el.find("#digg-deeper").fadeIn(800)},renderStreamContainer:function(){document.getElementById("digg-alerts")||(this.el.className="alerts-enabled",this.el.innerHTML=u,p(".js--digg-deeper-sort-select").find("option[value="+S+"]").attr("selected","selected"),this.$el.on("change",".js--digg-deeper-sort-select",h.bind(this.selectSort,this)).on("mouseenter",".more-shares",h.bind(this.showMoreSharersTooltip,this)).on("mouseleave",".more-shares",h.bind(this.hideMoreSharersTooltip,this)))},selectSort:function(t){S=p(".js--digg-deeper-sort-select").val(),y=0,w=null,b=null,this.$el.find("#digg-deeper").html('<div class="ico-loading alerts-first-page-loading"></div>'),e.pubsub.fire("digg_deeper:stream:sortby_selected",S),this.fetch()},setStreamElHeight:function(){var e=p(".no-marquee").size()?5:15;this.$el.find("#digg-deeper").height(this.$el.height()-this.$el.find(".widget-hdr").outerHeight(!0)+e)},renderStories:function(e){var t=e.data.feed,n=e.status_message,r=h.map(t,k),i=this.$el.find(".story-container").size(),s=this.$el.find("#digg-deeper");this.scrollPanel||(this.scrollPanel=s[0],p(document).on("DOMMouseScroll mousewheel","#digg-deeper",L)),s.find(".ico-loading").remove(),i?s.append(r.join("")):(s.hide(),s.append(r.join("")).fadeIn(800)),n&&b==null&&(s.append('<div class="alerts-message">'+n+"</div>"),C.done(h.bind(this.renderMostDuggStories,this,5))),s.append('<a href="/deeper" class="digg-deeper__btn-view-all">View All</a>')},showMoreSharersTooltip:function(e){var t=e.currentTarget;p(t).addClass("tooltip-show"),this.hideMoreSharersProxy=h.bind(this.hideMoreSharersTooltip,this),this.$el.on("mouseleave",".btn-show-more-shares",this.hideMoreSharersProxy)},hideMoreSharersTooltip:function(e){var t=e.currentTarget;p(t).removeClass("tooltip-show")},renderMostDuggStories:function(t){var r=[],s=0,o;for(;s<t;s++)o=T[s],o.position=s,o.formattedDate=n.secondsToFuzzyTime(o.date),o.content.link_target="_blank",o.fblink=i.getFacebookStoryShareLink({app_id:e.config.FB_APP_ID,content_id:o.content.content_id}),o.tweetlink=i.getTweetStoryLink({content_id:o.content.content_id,title:o.content.title||o.tweets[0].text}),o.feed="most-dugg",o.maxSharersDisplayed=1,o.noContentPreview=!0,o.showDiversityScore=!1,o.tweets.count=1,o.tweets.hideTweetDetails=!0,o.tweets.data=[{user:{name:"Top story on Digg",profile_image_url:"https://pbs.twimg.com/profile_images/529093119665397760/W5XVfjAs_400x400.jpeg",screen_name:"digg",user_id:"15163466"}}],r.push(g(o));this.$el.find("#digg-deeper").append(r.join(""))},renderOnboarding:function(){var t=e.user.get("twitter"),n=h.bind(this.beginOnboarding,this);this.el.className="onboarding",this.el.innerHTML=this.alertsOnboardingTemplate({isUserLoggedIn:e.user.isLoggedIn(),hasTwitter:t&&t.username}),p(this.el).on("click",".btn-enable-alerts",E.authorized(n,"digg_deeper",{twitterOnly:!0})).on("click",".btn-alerts-opt-out",h.bind(this.optOut,this,"Twitter alerts"))},optOut:function(t){e.pubsub.fire("digg_deeper:onboarding:opt_out",t),r.set({name:v,value:1,expires:r.expires.oneYear(),path:"/"}),h.defer(function(){window.location.reload(!0)})},beginOnboarding:function(){E.deepGet("apps.digg_deeper.enabled")?this.$el.find("#digg-deeper").size()||this.renderDiggDeeper():this.enableTwitterAlerts()},renderEmailOnboarding:function(){this.el.innerHTML=this.emailOnboardingTemplate({email:e.user.get("email")||""}),p("#input-alerts-email").focus(),p(this.el).on("click",".btn-enable-alerts-email",h.bind(this.alertsEmailDetails,this)).on("click",".btn-alerts-email-skip",h.bind(this.renderOnboardingSuccess,this,{emailOptOut:!0})).on("keyup","#input-alerts-email",h.bind(this.alertsEmailDetailsProxy,this))},renderEmailDetailsOnboarding:function(e){this.el.innerHTML=this.emailOnboardingDetailsTemplate({email:e}),p("input[name=email-setting]").last().focus(),p(this.el).on("keyup","input[name=email-setting]",h.bind(this.alertsEmailProxy,this)).on("click",".btn-alerts-email-details-continue",h.bind(this.enableAlertsEmail,this))},alertsEmailDetailsProxy:function(e){e.keyCode===13&&(e.stopPropagation(),e.preventDefault(),this.alertsEmailDetails())},alertsEmailDetails:function(e){var t=p("#input-alerts-email"),n=t.val();this.renderEmailDetailsOnboarding(n)},alertsEmailProxy:function(e){e.keyCode===13&&(e.stopPropagation(),e.preventDefault(),this.enableAlertsEmail())},enableAlertsEmail:function(){var n=p("#input-alerts-email"),r=n.val(),i=p('input[name="email-setting"]:checked').val(),s=0,o=!1;if(i==="both"||i==="digest")o=!0;if(i==="both"||i==="alerts")s=2;var u=new t.dataProvider({url:"/api/settings/email.json",type:"POST",success:h.bind(this.renderOnboardingSuccess,this),error:h.bind(this.enableTwitterAlertsError),data:{source:"onboarding",email:r,"apps.digg_deeper.alerts.email.frequency":s,"apps.digg_deeper.digest.email.enabled":o}});r?(e.pubsub.fire("digg_deeper:onboarding:email_opt_in"),u.request()):n.addClass("input-error")},renderOnboardingSuccess:function(t){if(this.onboarded)return;this.onboarded=!0,t&&t.emailOptOut&&e.pubsub.fire("digg_deeper:onboarding:opt_out","Email alerts"),e.pubsub.fire("digg_deeper:onboarding:success"),r.set({name:v,value:1,expires:r.expires.oneYear(),path:"/"}),this.el.innerHTML='<div class="ico-loading onboarding-success"></div><p class="alerts-desc">Almost there...</p>',this.renderDiggDeeper()},enableTwitterAlertsSuccess:function(){E.deepGet("apps.digg_deeper.enabled")||setTimeout(h.bind(this.renderEmailOnboarding,this),3500)},enableTwitterAlertsError:function(){this.el.className="alerts-enabled",this.el.innerHTML="<p class=\"alerts-desc\">Oops! We're having trouble Digging Deeper. Why don't you refresh the page and try again.</p>"},enableTwitterAlerts:function(){var n=new t.dataProvider({url:"/api/settings/digg_deeper.json",type:"POST",success:h.bind(this.enableTwitterAlertsSuccess,this),error:h.bind(this.enableTwitterAlertsError,this),data:{source:"onboarding",enabled:!0}});n.request(),e.pubsub.fire("digg_deeper:onboarding:opt_in"),this.el.innerHTML='<div class="ico-loading onboarding-success"></div><p class="alerts-desc">Here we go!<br>Compiling stories from your Twitter timeline...</p>'}},{factory:function(e){return new A(e)}}}),define("bs/reader/view/deeper_onboarding",["bs/core","bs/views/base","bs/views/modal","bs/util/module_factory","bs/util/format","text!bs/templates/reader/digg_deeper_onboarding.html","bs/widgets/alerts","lodash"],function(e,t,n,r,i,s,o,u){var a={template:u.template(s),tagName:"div",className:function(){return this.constructor.__super__.className+" "+"digg-deeper-view"},initialize:function(e){this.constructor.__super__.initialize.call(this,e),this.modal=!!e.modal,this.onboardingStarted=!!e.onboarding_started,this.optOutKey=e.optout_key||null,this.optOutKey&&(this.postHide=u.bind(function(){window.localStorage.setItem(this.optOutKey,1)},this))},render:function(){var t=e.user.get("twitter");return this.el.innerHTML=this.template({modal:this.modal,has_twitter:t&&t.username}),this._rendered=!0,this.el}},f=u.extend({postShow:function(){var t;this.alerts=o.factory({id:"dr-digg-deeper-onboarding"}),t=u.bind(this.alerts.beginOnboarding,this.alerts),this.onboardingStarted?(this.alerts.el.innerHTMl='<div class="ico-loading"></div>',this.alerts.enableTwitterAlerts(),this.$el.find(".btn-modal-close").remove()):(this.$el.find(".btn-primary").after('<p class="btn-alerts-opt-out btn-alerts-no-thanks">No, Thanks</p>'),this.$el.on("click",".btn-alerts-no-thanks",u.bind(this.hide,this))),e.pubsub.on("reader","digg_deeper:onboarding:opt_in",u.bind(function(){this.$el.find(".btn-modal-close").remove(),this.$el.find(".btn-alerts-no-thanks").remove()},this)),$(this.el).on("click",".btn-enable-alerts",e.user.authorized(t,"digg_deeper",{twitterOnly:!0})).on("click",".btn-alerts-opt-out",u.bind(this.alerts.optOut,this.alerts,"Twitter alerts")),e.pubsub.on("reader","digg_deeper:onboarding:success",u.bind(function(){this.hide()},this))}},a),l=n.constructor.extend(f),c=u.extend({postShow:function(){var t;this.alerts=o.factory({id:"dr-digg-deeper-onboarding"}),t=u.bind(function(){e.pubsub.fire("digg_deeper_onboarding",!0,!0)},this),$(this.el).on("click",".btn-enable-alerts",e.user.authorized(t,"digg_deeper",{twitterOnly:!0}))}},a),h=t.constructor.extend(c);return{factory:function(e){return e.modal?new l(e):new h(e)}}}),define("text!bs/templates/reader/readerapp.html",[],function(){return'<div class="col-left">\n    <nav id="view-region-nav" class="view-region-nav">\n        <div id="view-region-nav">\n            <ul id="dr-persistent-nav" class="dr-list dr-persistent-nav">\n                <li class="dr-list-item dr-nav-all" id="dr-nav-all" data-folder="digg.com/root" data-feed-url="digg.com/root"><div class="dr-label dr-feed-label">All</div></li>\n                <li class="dr-list-item dr-nav-popular" id="dr-nav-popular"><div class="dr-label dr-feed-label">Popular</div></li>\n                <li class="dr-list-item dr-nav-digg-deeper" id="dr-nav-digg-deeper"><div class="dr-label dr-feed-label">Digg Deeper</div></li>\n                <li class="dr-list-item dr-nav-diggs" id="dr-nav-diggs"><div class="dr-label dr-feed-label">Diggs</div></li>\n                <li class="dr-list-item dr-nav-saved" id="dr-nav-saved"><div class="dr-label dr-feed-label">Saved</div></li>\n            </ul>\n\n            <div id="dr-subscription-list"></div>\n        </div>\n\n        <div id="dr-tags"></div>\n    </nav>\n\n    <div id="view-add" class="view-add"></div>\n</div>\n\n<div class="col-right">\n    <section id="view-region-main-container" class="view-region-main-container"></section>\n    <div id="main-region-loading" class="main-region-loading"></div>\n</div>\n\n<div id="view-region-modal"></div>\n<div id="view-keyboard-shortcut-legend-modal"></div>\n'}),define("bs/reader/view/app",["bs/core","bs/widgets/usersettings","bs/util/command","bs/util/format","bs/util/cookies","bs/util/viewmanager","bs/util/storyactions_v3","bs/reader/subscriptions","bs/views/viewtypeselector","bs/reader/view/nav","bs/reader/view/feeditems/feeditems","bs/views/editfeed","bs/views/confirm","bs/views/addfolder","bs/views/addbutton","bs/views/main_region_message","bs/views/keyboard_shortcut_legend","bs/model/discoveryfeed","bs/views/discoverybrowsecategories","bs/views/discoverybrowsecategory","bs/model/discoveryfeedsearch","bs/views/discoveryfeedsearch","bs/views/welcomebrowseorsearch","bs/views/welcome","bs/reader/view/deeper_onboarding","bs/views/base","text!bs/templates/reader/readerapp.html","lodash","backbone"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L){function D(){var e=$("#site-header-container").outerHeight();$(".col-left, .col-right").height($(window).height()-e-1)}function P(){$(".reader-nav-item").removeClass("show-tooltip"),H=!1,$(document).off("click",P)}function B(e){var t=$(this),n="show-tooltip";if(!H&&t.parents(".reader-nav-settings").length===0){if(!t.hasClass(n))$(".reader-nav-item").removeClass(n),t.addClass(n),H=!0,$(document).on("click",P);else{if(t.hasClass("reader-nav-settings"))return!0;P()}return!1}}var A,O,M=a.factory({name:"view-type-selector",model:u}),_=Backbone.Router.extend({routes:{"":"loadAllFeed","feed/:feed_url":"loadFeed","folder/:folder":"loadFolder",browse:"loadDiscoveryBrowseCategoriesView","browse/":"loadDiscoveryBrowseCategoriesView","browse/:category":"loadDiscoveryBrowseCategoryView","search/:feed_url":"loadDiscoveryFeedSearchView","add/:feed_url":"loadDiscoveryFeedSearchView"},loadAllFeed:function(){var e=u.subscriptions.findWhere({label:"digg.com/root"}),t=e.get("feeds"),n={feed_url:"digg.com/all"};this.gatekeeperStatus.importDataWasEmpty||t.size()===0?this.loadWelcomeView():this.loadFeedView(n)},loadFeed:function(e){var t={feed_url:decodeURIComponent(e)};this.loadFeedView(t)},loadFolder:function(e){var t={folder:e};this.loadFeedView(t)},initialize:function(e){this.viewManager=e.viewManager,this.gatekeeperStatus=e.gatekeeperStatus,this.current_feed_url=!1,this.current_folder=!1},loadFeedView:function(t){var n,r,i,s,o;t.viewType&&(t.feed_url=this.current_feed_url,t.folder=this.current_folder),t.feed_url==="digg.com/all"?(this.current_folder=!1,this.current_feed_url="digg.com/all",r=u.subscriptions.findWhere({title:t.feed_url})):t.folder?(this.current_folder=t.folder,this.current_feed_url=!1,r=u.subscriptions.findWhere({label:t.folder})):(this.current_folder=!1,this.current_feed_url=t.feed_url,r=u.subscriptions.findWhere({feed_url:t.feed_url}));if(!r){s=v.factory({model:{message:"There was a problem loading this feed.",type:"error"}}),this.viewManager.load("main",s);return}if(r.get("title")==="digg.com/deeper"){n=e.user.get("apps");if(!n.digg_deeper||!n.digg_deeper.enabled){e.pubsub.fire("digg_deeper_onboarding");return}}r.set({next_position:!1},{silent:!0}),r.items.reset(null,{silent:!0}),o={name:"main",model:r,viewManager:this.viewManager},t.parentFolder&&(o.parentFolder=t.parentFolder),this.feedView=l.factory(o),this.viewManager.update("view-type-selector",{className:r.get("view")+" "+r.get("show")}),this.viewManager.load("main",this.feedView),t.feed_url==="digg.com/all"?(this.navigate("/",{trigger:!1}),$("#dr-nav-all").addClass("dr-feed-selected")):t.folder?this.navigate("folder/"+encodeURIComponent(t.folder),{trigger:!1}):(i=r.get("title"),i.indexOf("digg.com/")>-1&&$("#dr-persistent-nav").find(".dr-feed-selected").removeClass("dr-feed-selected"),i.indexOf("digg.com/all")>-1?$("#dr-nav-all").addClass("dr-feed-selected"):i.indexOf("digg.com/deeper")>-1?$("#dr-nav-digg-deeper").addClass("dr-feed-selected"):i.indexOf("digg.com/popular")>-1?$("#dr-nav-popular").addClass("dr-feed-selected"):i.indexOf("digg.com/diggs")>-1?$("#dr-nav-diggs").addClass("dr-feed-selected"):i.indexOf("digg.com/saved")>-1&&$("#dr-nav-saved").addClass("dr-feed-selected"),this.navigate("feed/"+encodeURIComponent(t.feed_url),{trigger:!1}))},loadDiscoveryBrowseCategoriesView:function(e){var t,n;t=g.factory(),n=y.factory({name:"main",model:t}),this.viewManager.load("main",n),this.navigate("browse/",{trigger:!1})},loadDiscoveryBrowseCategoryView:function(e){var t,n,s=i.get("reader_onboarding_subscription");s&&(i.remove({name:"reader_onboarding_subscription",path:"/"}),s=JSON.parse(s)),!e||typeof e=="string"?(n=r.slugify(e),e=g.factory(),e.on("change",k.bind(function(){var i=e.categories.find(function(e){return r.slugify(e.get("title"))===n});t=b.factory({name:"main",model:i,onboarding_subscription:s}),this.viewManager.load("main",t),this.navigate("browse/"+r.slugify(i.get("title")),{trigger:!1})},this)),e.fetch()):(t=b.factory({name:"main",model:e}),this.viewManager.load("main",t),this.navigate("browse/"+r.slugify(e.get("title")),{trigger:!1}))},loadDiscoveryFeedSearchView:function(e){var t,n;typeof e=="string"&&(e={feed_url:decodeURIComponent(e)}),t=w.factory({feed_url:e.feed_url}),n=E.factory({name:"main",model:t}),this.viewManager.load("main",n),this.navigate("search/"+encodeURIComponent(e.feed_url),{trigger:!1})},loadWelcomeBrowseOrSearchView:function(e){var t,n;t=g.factory(),n=S.factory({name:"main",model:t}),this.viewManager.load("main",n)},loadWelcomeView:function(e){var t;t=x.factory({name:"main"}),this.viewManager.load("main",t)}});$(window).on("resize",k.debounce(D,300));var H=!1;$("#reader-nav").on("click",".reader-nav-item-tooltip",B).on("click",".reader-nav-shortcuts",function(){e.pubsub.fire("display_keyboard_shortcut_modal")}).on("click",".reader-nav-mark-as-read",function(){e.pubsub.fire("mark_all_as_read")});var j=N.constructor.extend({events:{},tagName:"div",readerappTemplate:k.template(C),initialize:function(t){this.gatekeeperStatus=t.gatekeeperStatus,this.viewManager=t.viewManager,this.constructor.__super__.initialize.call(this,t);var r=n.factory(this,"showKeyboardShortcutModal"),i=n.factory(this,"refresh");this.keyboardShortcuts.add("r",i),this.keyboardShortcuts.add({key:"slash",shiftKey:!0},r),$(document).on("click",".js--digg-story__link",o.redirectStoryLink).on("click",".js--digg-story-action--digg",e.user.authorized(o.submitDigg,"Digg")).on("click",".js--digg-story-action--save",e.user.authorized(o.addReadingList,"Save"))},refresh:function(){var e=$("#nav-notif");this.navView.$el.empty(),this.navView.refresh(),e.size()&&(e.remove(),$(".nav-notif-enabled").removeClass("nav-notif-enabled")),this.reader.feedView&&this.reader.feedView.refresh&&this.reader.feedView.refresh()},render:function(e){return this.el.innerHTML=C,this._rendered=!0,this.el},showKeyboardShortcutModal:function(){e.pubsub.fire("display_keyboard_shortcut_modal")},loadNav:function(){this.navView=f.factory({name:"nav",viewManager:this.viewManager}),this.viewManager.load("nav",this.navView)},postShow:function(){D(),this.reader=new _({viewManager:this.viewManager,gatekeeperStatus:this.gatekeeperStatus}),this.viewManager.addRegion({name:"main",el:document.getElementById("view-region-main-container"),scrollable:!0}),this.viewManager.addRegion({name:"nav",el:document.getElementById("view-region-nav"),scrollable:!0}),e.user.get("show_unread_counts")&&this.viewManager.update("nav",{className:["view-region-nav","dr-show-unread-counts","scrollable"].join(" ")}),this.viewManager.addRegion({name:"tags",el:document.getElementById("dr-tags")}),this.viewManager.addRegion({name:"view-type-selector",el:document.getElementById("view-region-view-type-selector")}),this.viewManager.addRegion({name:"view-modal",el:document.getElementById("view-region-modal")}),this.viewManager.addRegion({name:"view-keyboard-shortcut-legend-modal",el:document.getElementById("view-keyboard-shortcut-legend-modal")}),this.viewManager.addRegion({name:"view-add",el:document.getElementById("view-add")}),e.pubsub.on("reader","loading_in_progress",function(){var e=$("#main-region-loading");e.fadeIn(function(){setTimeout(function(){e.fadeOut()},800)})},this),e.pubsub.on("feed_view","feed_selected",k.bind(this.reader.loadFeedView,this.reader)),e.pubsub.on("feed_view","scroll_feed_view",function(e,t){var n=document.getElementById("view-region-main-container"),r=document.getElementsByClassName("feed-stream-header")[0];e==="bottom"&&(e=n.offsetHeight),n.scrollTop=e-(t?0:r.offsetHeight)},this),e.pubsub.on("feed_view","view_type_changed",k.bind(this.reader.loadFeedView,this.reader)),e.pubsub.on("feed_view","show_type_changed",function(e){this.viewManager.update("view-type-selector",{className:e.viewType+" "+e.showType}),this.viewManager.reload("main",{showType:e.showType})},this),e.pubsub.on("feed_view","do_show_type_change",function(e){M.setShowType(e)}),e.pubsub.on("reader","display_edit_stream_ui",function(e,t){var n=c.factory({model:e,parentFolder:t});this.viewManager.load("view-modal",n)},this),e.pubsub.on("reader","update_feed_name",function(e,t){e.get("type")==="folder"?u.renameFolder({folder:e.get("label"),folder_name:t}):u.renameFeed({feed_url:e.get("feed_url"),feed_title:t})},this),e.pubsub.on("reader","display_app_message",function(e){var t=$("#reader-app-msg-container");t.removeClass().addClass(e.className).html(e.msg).show(),e.flash&&k.delay(function(){$("#reader-app-msg-container").fadeOut()},e.flash)}),e.pubsub.on("reader","display_add_folder_ui",function(){var e=p.factory({name:"add_folder"});this.viewManager.load("view-modal",e)},this),e.pubsub.on("reader","add_subscription",function(e){u.addSubscription(e)},this),e.pubsub.on("reader","batch_add_subscription",function(e){e.folders&&k.isArray(e.folders)?k.each(e.folders,function(e){u.batchAddSubscription(e)}):u.batchAddSubscription(e)},this),e.pubsub.on("reader","add_folder",function(e){u.addSubscription({folder:e})},this),e.pubsub.on("reader","remove_feed",function(t,n){t.get("type")==="folder"?confirm("Are you sure you want to remove '"+t.get("label")+"' and all its subscriptions?")&&(u.deleteSubscription({folder:t.get("label")}),e.pubsub.fire("display_app_message",{msg:"You removed '"+t.get("label")+"'",className:"success",flash:3e3})):confirm("Are you sure you want to remove '"+t.get("title")+"' from your subscriptions?")&&(u.deleteSubscription({feed_url:t.get("feed_url"),folder:n}),e.pubsub.fire("display_app_message",{msg:"You unsubscribed from '"+t.get("title")+"'",className:"success",flash:3e3}))},this),e.pubsub.on("reader","display_keyboard_shortcut_modal",function(){var e=m.factory({name:"keyboard_shortcut_legend"}),t=$("#view-keyboard-shortcut-legend-modal").find(".modal"),n=t.css("display");n!=="block"?this.viewManager.load("view-keyboard-shortcut-legend-modal",e):t.find(".btn-modal-close").click()},this),e.pubsub.on("reader","discovery:load_categories",k.bind(this.reader.loadDiscoveryBrowseCategoriesView,this.reader)),e.pubsub.on("reader","discovery:load_category",k.bind(this.reader.loadDiscoveryBrowseCategoryView,this.reader)),e.pubsub.on("reader","discovery:load_search",k.bind(this.reader.loadDiscoveryFeedSearchView,this.reader)),e.pubsub.on("reader","load_search_results",k.bind(function(){var e=window.location.pathname.substr(1).split("/"),t=e[e.length-1];this.reader.loadDiscoveryFeedSearchView(t)},this)),e.pubsub.on("reader","hide_reader_nav_tooltips",function(){P()}),e.pubsub.on("reader","pause_api_sync:start",function(){u.clearNextFetch()}),e.pubsub.on("reader","pause_api_sync:end",function(){k.defer(k.bind(u.setNextFetch,u))}),e.pubsub.on("reader","preview_feed",k.bind(function(e){this.viewManager.load("main",e)},this)),e.pubsub.on("reader","digg_deeper_onboarding",k.bind(function(e,t,n){var r=T.factory({name:"digg_deeper_onboarding",modal:e,onboarding_started:t,optout_key:n||!1}),i=e?"view-modal":"main";this.viewManager.load(i,r)},this)),e.pubsub.on("reader","digg_deeper:onboarding:success",k.bind(function(){e.user.refresh(function(){$("#dr-nav-digg-deeper").find(".dr-feed-label").click()})},this)),this.loadNav(),$(document).on("click",".unread-feeds-changed",k.bind(function(){$("#reader-app-msg-container").removeClass().html(""),this.navView.$el.empty(),this.navView.refresh()},this));var n=d.factory();this.viewManager.load("view-type-selector",M),this.viewManager.update("view-type-selector",{className:[M.getViewType(),M.getShowType()].join(" ")}),this.viewManager.load("view-add",n);if(this.gatekeeperStatus.partialImport){var r=h.factory({header_text:"Welcome to Digg Reader!",message_text:"Some of your feeds have finished importing and are ready to browse. <br />We are still working on the others.",confirm_button_text:"OK"});this.viewManager.load("view-modal",r)}t.init(),O="digg_reader_deeper_onboarding",A=e.user.get("apps"),!A.digg_deeper.enabled&&!window.localStorage.getItem(O)&&e.pubsub.fire("digg_deeper_onboarding",!0,!1,O),Backbone.history.start({root:"/reader",pushState:!0})}});return{factory:function(e){return new j(e)},constructor:j}}),require(["bs/core","bs/util/helpers","bs/util/viewmanager","bs/reader/subscriptions","bs/reader/view/gatekeeper","bs/reader/view/app"],function(e,t,n,r,i,s){function u(){var t=r.progress,n=i.factory({name:"gatekeeper",model:t});e.pubsub.on("reader","gatekeeper:allgood",a),o.load("readerapp",n)}function a(e){var t=s.factory({name:"readerapp",viewManager:o,gatekeeperStatus:e});o.load("readerapp",t)}var o=n.factory();o.addRegion({name:"readerapp",el:document.getElementById("view-region-readerapp")}),e.pubsub.one("reader",e.pubsub.channels.user_auth,u),e.user.isLoggedIn()}),define("bs/reader",function(){})})();
